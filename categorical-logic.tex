\documentclass[article,10pt,oneside]{memoir}
\input{preambles}
\title{categorical logic}
\author{Frank Tsai}
\date{\today}
%\thanks{}
\begin{document}
\maketitle
\tableofcontents

\section{Introduction}
\label{sec:introduction}

To define group identity and group multiplication in a category, we need a terminal object and binary products, implying the existence of all finite products.
Indeed, internal groups can be defined in a category with finite products.
Below is the usual presentation of the theory of groups.
\begin{mathpar}
  \vdash e : G \and x : G \vdash x\inv : G \and x, y : G \vdash m(x, y) : G \and x : G \vdash m(e, x) = x : G%
  \and x : G \vdash m(x, e) = x : G \and x : G \vdash m(x, x\inv) = e : G \and x : G \vdash m(x\inv, x) = e : G%
  \and x, y, z : G \vdash m(m(x,y),z) = m(x,m(y,z)) : G
\end{mathpar}
The axioms of the theory of groups can be expressed in terms of the following commutative diagrams.
\begin{mathpar}
  % https://q.uiver.app/#q=WzAsNCxbNCwwLCJHIl0sWzIsMCwiRyBcXHRpbWVzIEciXSxbMiwxLCJHIl0sWzAsMCwiRyJdLFswLDEsImUgXFx0aW1lcyBcXGlkX3tHfSIsMl0sWzEsMiwibSJdLFswLDIsIiIsMCx7ImxldmVsIjoyLCJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzMsMSwiXFxpZF97R30gXFx0aW1lcyBlIl0sWzMsMiwiIiwwLHsibGV2ZWwiOjIsInN0eWxlIjp7ImhlYWQiOnsibmFtZSI6Im5vbmUifX19XV0=
  \begin{tikzcd}
    G && {G \times G} && G \\
    && G
    \arrow["{(e,\id_{G})}"', from=1-5, to=1-3]
    \arrow["m", from=1-3, to=2-3]
    \arrow[Rightarrow, no head, from=1-5, to=2-3]
    \arrow["{(\id_{G}, e)}", from=1-1, to=1-3]
    \arrow[Rightarrow, no head, from=1-1, to=2-3]
  \end{tikzcd} \and%
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJHIl0sWzIsMCwiRyBcXHRpbWVzIEciXSxbNCwwLCJHIl0sWzIsMSwiRyJdLFswLDEsIihcXGlkX3tHfSwoKVxcaW52KSJdLFsyLDEsIigoKVxcaW52LCBcXGlkX3tHfSkiLDJdLFsxLDMsIm0iXSxbMCwzLCIiLDIseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsyLDMsIiIsMix7ImxldmVsIjoyLCJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV1d
  \begin{tikzcd}
    G && {G \times G} && G \\
    && G
    \arrow["{(\id_{G},()\inv)}", from=1-1, to=1-3]
    \arrow["{(()\inv, \id_{G})}"', from=1-5, to=1-3]
    \arrow["m", from=1-3, to=2-3]
    \arrow[Rightarrow, no head, from=1-1, to=2-3]
    \arrow[Rightarrow, no head, from=1-5, to=2-3]
  \end{tikzcd} \and%
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJHIFxcdGltZXMgRyBcXHRpbWVzIEciXSxbMCwyLCJHIFxcdGltZXMgRyJdLFsyLDAsIkcgXFx0aW1lcyBHIl0sWzIsMiwiRyJdLFsxLDMsIm0iLDJdLFsyLDMsIm0iXSxbMCwxLCJcXGlkX3tHfSBcXHRpbWVzIG0iLDJdLFswLDIsIm0gXFx0aW1lcyBcXGlkX3tHfSJdXQ==
  \begin{tikzcd}
    {G \times G \times G} && {G \times G} \\
    \\
    {G \times G} && G
    \arrow["m"', from=3-1, to=3-3]
    \arrow["m", from=1-3, to=3-3]
    \arrow["{\id_{G} \times m}"', from=1-1, to=3-1]
    \arrow["{m \times \id_{G}}", from=1-1, to=1-3]
  \end{tikzcd}
\end{mathpar}
The first diagram, for instance, says that for any generalized element $g$ of $G$, $m(g,e) = g$.

For any two categories $\iC$ and $\iD$ with finite products, a finite-product preserving functor $\iC \to \iD$ maps an internal group of $\iC$ to an internal group of $\iD$.
In fact, there is a generic category $\cG$ such that finite-product preserving functors $\cG \to \iC$ correspond to internal groups of $\iC$.
When $\iC = \CSet$, an internal group is just a group in the usual sense.

The category $\CFin\op$, intuitively speaking, demands no operations and axioms, so a finite-product preserving functor $\iota : \CFin\op \to \iC$ corresponds to an object of $\iC$.
When $\iC = \cG$, the (unique) functor $\iota$ correspond to the generic group object.
Then the composite $\CFin\op \xto{\iota} \cG \xto{G} \CSet$ is the underlying set of the group $G$, so precomposition with $\iota$ yields the forgetful functor $U : \CGrp \to \CSet$.
\[
  \CGrp \eqv \Mod_{\CSet}(\cG) \xto{\iota^{*}} \Mod_{\CSet}(\CFin\op) \eqv \CSet
\]

The forgetful functor encodes a great deal of information about groups.
Let us consider a natural transformations $\alpha : U \To U$.
For any two groups $G$ and $G'$ and any group homomorphism $f : G \to G'$, the following diagram commutes.
% https://q.uiver.app/#q=WzAsNCxbMCwwLCJVRyJdLFsyLDAsIlVHIl0sWzAsMiwiVUcnIl0sWzIsMiwiVUcnIl0sWzAsMSwiXFxhbHBoYV97R30iXSxbMiwzLCJcXGFscGhhX3tHJ30iLDJdLFswLDIsIlVmIiwyXSxbMSwzLCJVZiJdXQ==
\[\begin{tikzcd}
    UG && UG \\
    \\
    {UG'} && {UG'}
    \arrow["{\alpha_{G}}", from=1-1, to=1-3]
    \arrow["{\alpha_{G'}}"', from=3-1, to=3-3]
    \arrow["Uf"', from=1-1, to=3-1]
    \arrow["Uf", from=1-3, to=3-3]
  \end{tikzcd}\]
This means that the data of $\alpha$ is just an (implicit) $1$-ary group operation.
In general, a natural transformation $U^{m} \To U^{n}$ encodes an $n$-tuple of $m$-ary group operation.

Now, suppose that $\cT$ is a geometric theory and $f : \cE \to \cF$ is a geometric morphism between Grothendieck topoi.
Then a model of $\cT$ in $\cF$ yields a model of $\cT$ in $\cE$ via the inverse image functor $f^{*} : \cF \to \cE$ since it is cocontinuous and left exact (preserves the interpretation of $\bigvee$, $\wedge$, and other connectives).
It is natural to wonder whether there is a Grothendieck topos $\cC_{\cT}$ such that each geometric morphism $\cE \to \cC_{\cT}$ corresponds to a model of $\cT$ in $\cE$.
The answer to this question is yes.
Every geometric theory is classified by a category of sheaves over a syntactic site.

% \section{Yoneda and cantor}
% \label{sec:yoneda-and-cantor}

% \begin{cons}[Archetypal Grothendieck construction]\label{cons:archetypal-grothendieck-construction}
%   Let $X$ be a set.
%   There is a bijection between the powerset $P(X)$ and the set of all truth functionals over $X$.
%   \[
%     \Theta : P(X) \otto 2^{X} : \Psi
%   \]
%   \begin{itemize}
%   \item[$\Theta$:] For each subset $S \subseteq X$, $\Theta(S)$ is the characteristic function of $X$, mapping elements in $S$ to $1$ and everything else to $0$.
%   \item[$\Psi$:] For each truth functional $\phi : X \to 2$, $\Psi(\phi)$ is the inverse image $\phi\inv(1)$.
%   \end{itemize}
% \end{cons}

% \begin{rmk}
%   The map $\Psi$ in \cref{cons:archetypal-grothendieck-construction} can be described as a pullback.
%   % https://q.uiver.app/#q=WzAsNCxbMiwwLCIxIl0sWzIsMiwiMiJdLFswLDIsIlgiXSxbMCwwLCJcXHZhcnBoaVxcaW52KDEpIl0sWzAsMSwidCIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMiwxLCJcXHZhcnBoaSIsMl0sWzMsMiwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFszLDBdLFszLDEsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
%   \[\begin{tikzcd}
%       {\varphi\inv(1)} && 1 \\
%       \\
%       X && 2
%       \arrow["t", tail, from=1-3, to=3-3]
%       \arrow["\varphi"', from=3-1, to=3-3]
%       \arrow[tail, from=1-1, to=3-1]
%       \arrow[from=1-1, to=1-3]
%       \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
%     \end{tikzcd}\]
%   Indeed, $\varphi\inv(1)$ is the largest (w.r.t. inclusion) subset of $X$ so that $\varphi$ evaluates to $1$ everywhere.
% \end{rmk}

% \begin{rmk}
%   In $\CSet$, we make the foundational commitment that $\CSet(A, B)$ is a set and that the powerset $P(A)$ is in fact a set.
%   As it turns out, assuming either one is sufficient to construct the other.
% \end{rmk}

% \begin{rmk}
%   The set $P(X)$ has a canonical poset structure given by the set inclusion relation.
%   In fact, $P(X)$ equipped with set inclusion is a complete Boolean algebra.
%   Thus, the powerset functor $P : \CSet\op \to \CSet$ may be equally regarded as a functor $P : \CSet\op \to \CPos$, sending each set to its powerset ordered by inclusion.
% \end{rmk}

% \begin{rmk}
%   The two point set has a unique nontrivial poset structure $\Set{0 \leq 1}$.
%   We can define a poset structure on truth functionals by transporting the poset structure defined on the powersets along the Grothendieck construction.
%   \[
%     \chi_{X} \leq \chi_{Y} \text{ iff } X \subseteq Y
%   \]
%   This is the usual pointwise poset structure.
% \end{rmk}

% We can classify subsets of a given set $X$.
% We can classify $X$-indexed families (i.e., functions $f : Y \to X$), too.
% These families assemble into the slice construction $\CSet/X$.

% \begin{cons}[Discrete Grothendieck construction]
%   Let $X$ be a set construed as a discrete category.
%   There is an equivalence of categories.
%   \[
%     \Theta : \CSet/X \otto \CSet^{X} : \Psi
%   \]
%   \begin{itemize}
%   \item[$\Theta$:] For each function $f : Y \to X$, $\Theta(f)$ is the functor that sends each $x \in X$ to the inverse image $f\inv(x)$.
%   \item[$\Psi$:] For each functor $\varphi : X \to \CSet$, $\Psi(\varphi)$ is the canonical map $\coprod_{x \in X}\varphi(x) \to X$
%   \end{itemize}
% \end{cons}

% \begin{rmk}
%   Indeed, $\Psi$ can be phrased in terms of pullback.
%   % https://q.uiver.app/#q=WzAsNCxbMiwwLCJcXENTZXRfeyp9Il0sWzIsMiwiXFxDU2V0Il0sWzAsMiwiWCJdLFswLDAsIlxcY29wcm9kX3t4IFxcaW4gWH1cXHZhcnBoaSh4KSJdLFswLDFdLFsyLDEsIlxcdmFycGhpIiwyXSxbMywyXSxbMywwXSxbMywxLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=
%   \[\begin{tikzcd}
%       {\coprod_{x \in X}\varphi(x)} && {\CSet_{*}} \\
%       \\
%       X && \CSet
%       \arrow[from=1-3, to=3-3]
%       \arrow["\varphi"', from=3-1, to=3-3]
%       \arrow[from=1-1, to=3-1]
%       \arrow[from=1-1, to=1-3]
%       \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
%     \end{tikzcd}\]
%   $\coprod_{x \in X}\varphi(x) \to X$ is the ``largest'' family so that $\varphi$ produces a witness everywhere.
% \end{rmk}

\section{Hyperdoctrine}
\label{sec:hyperdoctrine}

\begin{defn}
  A \emph{(primitive) doctrine} is a functor $\cT : \iC\op \to \CPos$, where $\CPos$ is a suitable category of posets.
\end{defn}

In a doctrine $\cT : \iC\op \to \CPos$, the category $\iC$ is the category of contexts and context morphisms.
The functor maps each context $\Gamma$ to the Lindenbaum-Tarski algebra over $\Gamma$.
Each context morphism $f : \Gamma \to \Delta$ induces contravariantly a substitution operation $f^{*} : \cT(\Delta) \to \cT(\Gamma)$ satisfying the expected equations: $\id^{*} = \id$ and $g^{*}f^{*} = (fg)^{*}$.

The mathematical intuition of such a construct is explained in the following example.
\begin{eg}
  Consider the powerset doctrine, denoted as $\cP : \CSet\op \to \CPos$, obtained via the contravariant powerset functor $P : \CSet\op \to \CSet$ by equipping the subobject classifier $\Set{f, t}$ of $\CSet$ with the only nontrivial poset structure.

  Let $S$ be a set, $P(S)$ is the powerset of $S$ ordered by inclusion.
  And given a function $f : S^{n} \to S^{m}$, the substitution by $f$ is the inverse image function $f^{*} : P(S^{m}) \to P(S^{n})$.
  If we write $\varphi$ explicitly as $\varphi(x_{1},\ldots,x_{m})$, then $f^{*}\varphi$ is the formula $\varphi(\pi_{1}f(x_{1},\ldots,x_{n}),\ldots,\pi_{m}f(x_{1},\ldots,x_{n}))$.
  In fact, this is the pullback of $\varphi$ along $f$.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJmXnsqfVxcdmFycGhpIl0sWzAsMiwiU157bn0iXSxbMiwyLCJTXnttfSJdLFsyLDAsIlxcdmFycGhpIl0sWzEsMiwiZiIsMl0sWzMsMiwiIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFswLDEsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMCwzXSxbMCwyLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=
  \[\begin{tikzcd}
      {f^{*}\varphi} && \varphi \\
      \\
      {S^{n}} && {S^{m}}
      \arrow["f"', from=3-1, to=3-3]
      \arrow[tail, from=1-3, to=3-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
  Substitution satisfies the expected equations expressed in terms of the following pullback diagrams.
  \begin{mathpar}
    % https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXHZhcnBoaSJdLFswLDIsIlNee259Il0sWzIsMiwiU157bn0iXSxbMiwwLCJcXHZhcnBoaSJdLFsxLDIsIiIsMix7ImxldmVsIjoyLCJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzMsMiwiIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFswLDEsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMCwzLCIiLDAseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFswLDIsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
    \begin{tikzcd}
      \varphi && \varphi \\
      \\
      {S^{n}} && {S^{n}}
      \arrow[Rightarrow, no head, from=3-1, to=3-3]
      \arrow[tail, from=1-3, to=3-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[Rightarrow, no head, from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd} \and%
    % https://q.uiver.app/#q=WzAsNixbMiwyLCJTXntuX3syfX0iXSxbNCwyLCJTXnttX3szfX0iXSxbMCwyLCJTXntuX3sxfX0iXSxbMiwwLCJmXnsqfVxcdmFycGhpIl0sWzQsMCwiXFx2YXJwaGkiXSxbMCwwLCIoZmcpXnsqfVxcdmFycGhpIl0sWzIsMCwiZyIsMl0sWzAsMSwiZiIsMl0sWzUsMiwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFszLDAsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbNCwxLCIiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzMsNF0sWzUsM10sWzMsMSwiIiwwLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV0sWzUsMCwiIiwwLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
    \begin{tikzcd}
      {(fg)^{*}\varphi} && {f^{*}\varphi} && \varphi \\
      \\
      {S^{n_{1}}} && {S^{n_{2}}} && {S^{m_{3}}}
      \arrow["g"', from=3-1, to=3-3]
      \arrow["f"', from=3-3, to=3-5]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[tail, from=1-3, to=3-3]
      \arrow[tail, from=1-5, to=3-5]
      \arrow[from=1-3, to=1-5]
      \arrow[from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-3, to=3-5]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}
  \end{mathpar}
\end{eg}

The choice of the codomain of a doctrine depends on what logical connectives we wish to interpret.
We may also demand that the domain has finite products, finite limits, etc.
\begin{multicols}{2}
  \begin{itemize}
  \item $\top$ is interpreted as the top element.
  \item $\bot$ is interpreted as the bottom element.
  \item $\neg \varphi$ is interpreted as the largest element $\overline{\varphi}$ such that $\overline{\varphi} \cap \varphi \leq 0$.
  \item $\varphi \wedge \psi$ is interpreted as the meet $\varphi \cap \psi$.
  \item $\varphi \vee \psi$ is interpreted as the join $\varphi \cup \psi$.
  \item $\varphi \imp \psi$ is interpreted as the exponential $\psi^{\varphi}$, i.e., the largest element such that $\psi^{\varphi} \cap \varphi \leq \psi$.
  \item $\exists x.\,\varphi$ is interpreted as the left adjoint to the inverse image $\pi_{x}^{*}$.
  \item $\forall x.\,\varphi$ is interpreted as the right adjoint to the inverse image $\pi_{x}^{*}$.
  \end{itemize}
\end{multicols}
The interpretation of existential quantifier is required to satisfy the Beck-Chevalley and the Frobenius conditions, corresponding to natural logical laws.
We do not spell out the details here.

\begin{rmk}
  Let us assume that the category of contexts has at least finite products.
\end{rmk}
\begin{defn}\label{def:morphism-of-doctrine}
  A \emph{morphism} of doctrines $\cS \to \cT$ consists of the following data. 
  \begin{itemize}
  \item A finite-product preserving functor $M : \iC \to \iD$.
  \item A natural transformation $\lambda : \cS \To \cT \circ M\op$.
  \end{itemize}
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJcXGlDXFxvcCJdLFsyLDAsIlxcaURcXG9wIl0sWzEsMSwiXFxDUG9zIl0sWzAsMSwiTVxcb3AiXSxbMCwyLCJcXGNDIiwyXSxbMSwyLCJcXGNEIl0sWzQsMSwiXFxsYW1iZGEiLDEseyJzaG9ydGVuIjp7InNvdXJjZSI6MTAsInRhcmdldCI6MTB9fV1d
  \[\begin{tikzcd}
      \iC\op && \iD\op \\
      & \CPos
      \arrow["M\op", from=1-1, to=1-3]
      \arrow[""{name=0, anchor=center, inner sep=0}, "\cS"', from=1-1, to=2-2]
      \arrow["\cT", from=1-3, to=2-2]
      \arrow["\lambda"{description}, shorten <=4pt, shorten >=4pt, Rightarrow, from=0, to=1-3]
    \end{tikzcd}\]
\end{defn}

Let us unpack \cref{def:morphism-of-doctrine}.
Let $\Gamma := (x : A, y : B) \in \iC$ be a context.
Then $M$ essentially maps this context to $(x : MA, y : MB) \in \iD$.
Each component of the natural transformation $\lambda$ is an entailment preserving function.
Thus, a sequent $\varphi \vdash_{\Gamma} \psi$ in $S(\Gamma)$ is mapped to a sequent $\lambda_{\Gamma}\varphi \vdash_{M\Gamma} \lambda_{\Gamma}\psi$ in $\cT(M\Gamma)$.
Naturality demands that this data is compatible with substitutions.

\begin{eg}
  Let us consider a morphism of doctrines $(M, \lambda) : \cT \to \cP$, where $\cT : \CFin \to \CPos$ (note that $(\CFin\op)\op = \CFin$) and $\cP : \CSet\op \to \CPos$ is the powerset doctrine.
  We know that a finite-product preserving functor $\CFin\op \to \CSet$ corresponds to a set.
  This is the underlying set of the given single-sorted theory $\cT$ (encoded as a doctrine).
  The component $\lambda_{\Gamma}$ maps a sequent $\varphi \vdash_{\Gamma} \psi$ to the inclusion $\lambda_{\Gamma}\varphi \subseteq_{M\Gamma} \lambda_{\Gamma}\psi$.
  This data is just a $\cT$-model in $\CSet$ in the usual sense.
\end{eg}

\begin{rmk}
  It makes sense to talk about the models of a given theory $\cT : \iC\op \to \CPos$ in a (Grothendieck) topos $\cE$ whose subobject classifier $\Omega$ is an internal poset of the appropriate kind.
\end{rmk}

\subsection{The category of elements of a doctrine}
\label{sec:the-category-of-elements-of-a-doctrine}

The category of elements of a doctrine $\cT : \iC\op \to \CPos$ consists of the following data.
\begin{itemize}
\item[] \textbf{(Objects)}: An object is a pair $(\Gamma, \varphi)$ where $\Gamma \in \iC$ and $\varphi \in \cT(\Gamma)$.
\item[] \textbf{(Morphisms)}: A morphism $(\Gamma, \varphi) \to (\Delta, \psi)$ is a context morphism $f : \Gamma \to \Delta$ such that $f^{*}\psi = \varphi$.
\end{itemize}

% The powerset doctrine factors through the contravariant powerset functor in a canonical way because every powerset has a canonical poset structure given by the inclusion relation.
% % https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXGlEIl0sWzIsMCwiXFxDU2V0XFxvcCJdLFsxLDIsIlxcQ1BvcyJdLFszLDIsIlxcQ1NldCJdLFswLDIsIlxcY0QiLDJdLFswLDEsIk0iXSxbMSwzLCJcXGNQIl0sWzIsM10sWzEsMiwiIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzQsMSwiXFxsYW1iZGEiLDAseyJzaG9ydGVuIjp7InNvdXJjZSI6MTAsInRhcmdldCI6MTB9fV1d
% \[\begin{tikzcd}
%     \iU\op && \CSet\op \\
%     \\
%     & \CPos && \CSet
%     \arrow[""{name=0, anchor=center, inner sep=0}, "\cU"', from=1-1, to=3-2]
%     \arrow["M", from=1-1, to=1-3]
%     \arrow["\cP", from=1-3, to=3-4]
%     \arrow[from=3-2, to=3-4]
%     \arrow[dashed, from=1-3, to=3-2]
%     \arrow["\lambda", shorten <=5pt, shorten >=5pt, Rightarrow, from=0, to=1-3]
%   \end{tikzcd}\]
% Thus, we may identify a model of a doctrine as a natural transformation (of some kind) between presheaves.
% % https://q.uiver.app/#q=WzAsMyxbMCwwLCJcXGlEXFxvcCJdLFsyLDAsIlxcQ1NldFxcb3AiXSxbMiwyLCJcXENTZXQiXSxbMCwxXSxbMSwyXSxbMCwyLCJcXGNEIiwyXSxbNSwxLCJcXGxhbWJkYSIsMix7InNob3J0ZW4iOnsic291cmNlIjoxMCwidGFyZ2V0IjoxMH19XV0=
% \[\begin{tikzcd}
%     \iU\op && \CSet\op \\
%     \\
%     && \CSet
%     \arrow[from=1-1, to=1-3]
%     \arrow[from=1-3, to=3-3]
%     \arrow[""{name=0, anchor=center, inner sep=0}, "\cU"', from=1-1, to=3-3]
%     \arrow["\lambda"', shorten <=3pt, shorten >=3pt, Rightarrow, from=0, to=1-3]
%   \end{tikzcd}\]
% Given a natural transformation $\lambda : \cU \To \tilde{\cU}$ between presheaves, we may think of $\cU$ as a presheaf of ``witnesses'' and $\tilde{\cU}$ as a presheaf of ``types.''
% By the Yoneda lemma, each type $A \in \tilde{\cU}(\Gamma)$ can be identified with a natural transformation $A : \iU(\blank, \Gamma) \To \cU$.
% If we additionally require that the pullback of $A$ along $\lambda$ is representable, then the two projections correspond to a term $\Gamma.A \to \Gamma$ in the theory $\iU$ and a witness $t \in \cU(\Gamma.A)$, respectively.
% % https://q.uiver.app/#q=WzAsNCxbMiwwLCJcXGNVIl0sWzIsMiwiXFx0aWxkZXtcXGNVfSJdLFswLDIsIlxceW9uXFxHYW1tYSJdLFswLDAsIlxceW9uXFxHYW1tYS5BIl0sWzAsMSwiXFxsYW1iZGEiXSxbMiwxLCJBIiwyXSxbMywyXSxbMywwLCJ0Il0sWzMsMSwiIiwxLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
% \[\begin{tikzcd}
%     {\yon\Gamma.A} && \cU \\
%     \\
%     \yon\Gamma && {\tilde{\cU}}
%     \arrow["\lambda", from=1-3, to=3-3]
%     \arrow["A"', from=3-1, to=3-3]
%     \arrow[from=1-1, to=3-1]
%     \arrow["t", from=1-1, to=1-3]
%     \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
%   \end{tikzcd}\]

% \section{Calculus of fractions and orthogonality}
% \label{sec:calculus-of-fractions-and-orthogonality}
% \todo{Ivan's notes: topics in category theory 2018}

% \begin{defn}
%   Let $\iC$ be a category and $\cW$ be a class of morphisms (to be inverted) of $\iC$.
%   The \emph{localization of $\iC$ with respect to $\cW$} is a category $\iC[\cW\inv]$ equipped with a localization functor $L : \iC \to \iC[\cW\inv]$ such that
%   \begin{itemize}
%   \item $Lw$ is an isomorphism for all $w \in \cW$.
%   \item $L$ is universal with respect to this property, i.e., if $F : \iC \to \iD$ is a functor that maps each$w \in \cW$ to an isomorphism, then there is a unique functor $i : \iC[\cW\inv] \to \iD$ so that $iL \iso F$.
%   \end{itemize}
% \end{defn}

% \begin{thm}
%   $\iC[\cW\inv]$ and $L$ exist for any category $\iC$ and any class of morphisms $\cW$.
% \end{thm}
% \begin{proof}
%   Since $\cW$ are morphisms to be inverted, we formally add their inverses.
%   Let $\iG$ be a graph whose vertices are objects of $\iC$ and morphisms are morphisms of $\iC$ and formal inverses of $w \in \cW$.
%   Now, take the free category $F\iG$ generated the graph $\iG$.
%   Explicitly, the morphisms of $F\iG$ are tuples of morphisms of $\iC \cup \cW\inv$.
%   To enforce invertibility and universal property, we quotient the category $F\iG$ by the relation $\sim$ generated by the following equations
%   \begin{itemize}
%   \item $()_{c} = (\id_{c})$.
%   \item $(g, f) = (gf)$ whenever the composition makes sense.
%   \item $(w, w\inv) = ()_{\cod(w)}$.
%   \item $(w\inv, w) = ()_{\dom(w)}$.
%   \end{itemize}
%   We take $\iC[\cW\inv] := F\iG/\sim$, and $L : \iC \to \iC[\cW\inv]$ is defined as the composite $\iC \into F\iG \epi \iC[\cW\inv]$.
%   By construction, $Lw$ is an isomorphism for all $w \in \cW$.
%   The universality of this construction is inherited from the universal property of the quotient category construction.
% \end{proof}

% \begin{defn}
%   An object $c$ is \emph{orthogonal} to a morphism $m : d \to d'$ if for each morphism $f : d \to c$, there is a unique morphism $f' : d' \to c$ so that the following diagram commutes.
%   % https://q.uiver.app/#q=WzAsMyxbMCwwLCJkIl0sWzIsMCwiZCciXSxbMSwxLCJjIl0sWzAsMSwibSJdLFswLDIsImYiLDJdLFsxLDIsImYnIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
%   \[\begin{tikzcd}
%       d && {d'} \\
%       & c
%       \arrow["m", from=1-1, to=1-3]
%       \arrow["f"', from=1-1, to=2-2]
%       \arrow["{f'}", dashed, from=1-3, to=2-2]
%     \end{tikzcd}\]
%   For a class $\cM$ of morphisms in a category $\iC$, we write $\cM^{\bot}$ for the full subcategory of $\iC$ spanned by objects orthogonal to each $m \in \cM$.
% \end{defn}

\section{Sheaves}
\label{sec:sheaves}

\begin{defn}
  Let $X$ be a topological space.
  A \emph{sheaf} (of sets) is a presheaf $F : \cO(X)\op \to \CSet$ satisfying the \emph{sheaf condition}: For any open cover $U = \bigcup_{i}U_{i}$, the following diagram is an equalizer.
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJGKFUpIl0sWzIsMCwiXFxwcm9kX3tpfUYoVV97aX0pIl0sWzQsMCwiXFxwcm9kX3tpLGp9RihVX3tpfSBcXGNhcCBVX3tqfSkiXSxbMCwxXSxbMSwyLCJwIiwwLHsib2Zmc2V0IjotMX1dLFsxLDIsInEiLDIseyJvZmZzZXQiOjF9XV0=
  \[\begin{tikzcd}
      {F(U)} && {\prod_{i}F(U_{i})} && {\prod_{i,j}F(U_{i} \cap U_{j})}
      \arrow[from=1-1, to=1-3]
      \arrow["p", shift left, from=1-3, to=1-5]
      \arrow["q"', shift right, from=1-3, to=1-5]
    \end{tikzcd}\]
  The morphisms $p$ and $q$ are the canonical ones specified by morphisms of the form $F(U_{i} \cap U_{j} \subseteq U_{k})$ composed with an appropriate projection.
  % https://q.uiver.app/#q=WzAsNyxbMCwyLCJGKFUpIl0sWzIsMiwiXFxwcm9kX3tpfUYoVV97aX0pIl0sWzQsMiwiXFxwcm9kX3tpLGp9RihVX3tpfSBcXGNhcCBVX3tqfSkiXSxbMiwwLCJGKFVfe2l9KSJdLFsyLDQsIkYoVV97an0pIl0sWzQsMCwiRihVX3tpfSBcXGNhcCBVX3tqfSkiXSxbNCw0LCJGKFVfe2l9IFxcY2FwIFVfe2p9KSJdLFswLDFdLFsxLDIsInAiLDAseyJvZmZzZXQiOi0xfV0sWzEsMiwicSIsMix7Im9mZnNldCI6MX1dLFsxLDMsIlxccGlfe2l9Il0sWzAsMywiRihVX3tpfSBcXHN1YnNldGVxIFUpIl0sWzEsNCwiXFxwaV97an0iLDJdLFswLDQsIkYoVV97an0gXFxzdWJzZXRlcSBVKSIsMl0sWzIsNSwiXFxwaV97aSxqfSIsMl0sWzIsNiwiXFxwaV97aSxqfSJdLFszLDUsIkYoVV97aX0gXFxjYXAgVV97an0gXFxzdWJzZXRlcSBVX3tpfSkiXSxbNCw2LCJGKFVfe2l9IFxcY2FwIFVfe2p9IFxcc3Vic2V0ZXEgVV97an0pIiwyXV0=
  \[\begin{tikzcd}
      && {F(U_{i})} && {F(U_{i} \cap U_{j})} \\
      \\
      {F(U)} && {\prod_{i}F(U_{i})} && {\prod_{i,j}F(U_{i} \cap U_{j})} \\
      \\
      && {F(U_{j})} && {F(U_{i} \cap U_{j})}
      \arrow[from=3-1, to=3-3]
      \arrow["p", shift left, from=3-3, to=3-5]
      \arrow["q"', shift right, from=3-3, to=3-5]
      \arrow["{\pi_{i}}", from=3-3, to=1-3]
      \arrow["{F(U_{i} \subseteq U)}", from=3-1, to=1-3]
      \arrow["{\pi_{j}}"', from=3-3, to=5-3]
      \arrow["{F(U_{j} \subseteq U)}"', from=3-1, to=5-3]
      \arrow["{\pi_{i,j}}"', from=3-5, to=1-5]
      \arrow["{\pi_{i,j}}", from=3-5, to=5-5]
      \arrow["{F(U_{i} \cap U_{j} \subseteq U_{i})}", from=1-3, to=1-5]
      \arrow["{F(U_{i} \cap U_{j} \subseteq U_{j})}"', from=5-3, to=5-5]
    \end{tikzcd}\]
\end{defn}

\begin{defn}
  Let $X$ be a topological space.
  We define the category of sheaves $\Sh(X)$ as the full subcategory of $\Psh(\cO(X))$ spanned by sheaves.
\end{defn}

\begin{thm}
  For any topological space $X$, there is an isomorphism
  \[
    \Theta : \cO(X) \otto \Sub_{\Sh(X)}(1) : \Psi
  \]
\end{thm}
\begin{proof}
  We construct the two order-preserving functions as follows:
  \begin{itemize}
  \item[($\Theta$)] For each open set $O$, $\Theta(O)$ is the represented subsheaf $\Hom(\blank, O)$ of the terminal sheaf $1$.
  \item[($\Psi$)] For each subsheaf $F$ of the terminal sheaf, $\Psi(F)$ is the open set $\bigcup\Set{O \in \cO(X) \mid F(O) = 1}$, i.e., it is the union of all open sets $O$ so that $F(O)$ is the singleton set.
  \end{itemize}
\end{proof}

\begin{defn}
  Let $X$ and $Y$ be topological spaces.
  A continuous map $p : Y \to X$ is called a \emph{bundle over} $X$.
  A \emph{cross section} of a bundle $p : Y \to X$ is a continuous map $s : X \to Y$ so that $ps = \id$, i.e., a morphism from the identity bundle $\id : X \to X$ to $p : Y \to X$ in the slice category $\CTop/X$.
\end{defn}

\begin{rmk}
  Let $U \subseteq X$ be an open set of the topological space $X$, and $p : Y \to X$ be a bundle over $X$.
  The pullback yields a bundle over $U$.
  % https://q.uiver.app/#q=WzAsNCxbMCwyLCJVIl0sWzIsMiwiWCJdLFsyLDAsIlkiXSxbMCwwLCJwXFxpbnYgVSJdLFsyLDEsInAiXSxbMCwxLCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzMsMCwicFxcdmVydF97VX0iLDJdLFszLDIsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMywxLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XSxbMCwyLCJzIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
  \[\begin{tikzcd}
      {p\inv U} && Y \\
      \\
      U && X
      \arrow["p", from=1-3, to=3-3]
      \arrow[tail, from=3-1, to=3-3]
      \arrow["{p\vert_{U}}"', from=1-1, to=3-1]
      \arrow[tail, from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
      \arrow["s"{description}, dashed, from=3-1, to=1-3]
    \end{tikzcd}\]
  We call $s$ a \emph{cross section} of $p$ over $U$ if $s \circ p\vert_{U}$ is the inclusion.
\end{rmk}

\begin{rmk}
  We have an assignment $\Gamma_{p} : \cO(X) \to \CSet$ defined by sending open sets $U$ to the set of all cross sections of $p$ over $U$.
  This can be extended to a contravariant functor as for any open set $U' \subseteq U$ and any cross section $s$, we can define a cross section of $p$ over $U'$ by composition.
  % https://q.uiver.app/#q=WzAsNixbMiwyLCJVIl0sWzQsMiwiWCJdLFs0LDAsIlkiXSxbMiwwLCJwXFxpbnYgVSJdLFswLDAsInBcXGludiBVJyJdLFswLDIsIlUnIl0sWzIsMSwicCJdLFswLDEsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMywwLCJwXFx2ZXJ0X3tVfSIsMl0sWzMsMiwiIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFszLDEsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dLFswLDIsInMiLDEseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbNSwwLCIiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzQsNSwicFxcdmVydF97VSd9IiwyXSxbNCwzLCIiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzUsMiwiIiwyLHsiY3VydmUiOi0yLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbNCwwLCIiLDIseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=
  \[\begin{tikzcd}
      {p\inv U'} && {p\inv U} && Y \\
      \\
      {U'} && U && X
      \arrow["p", from=1-5, to=3-5]
      \arrow[tail, from=3-3, to=3-5]
      \arrow["{p\vert_{U}}"', from=1-3, to=3-3]
      \arrow[tail, from=1-3, to=1-5]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-3, to=3-5]
      \arrow["s"{description}, dashed, from=3-3, to=1-5]
      \arrow[tail, from=3-1, to=3-3]
      \arrow["{p\vert_{U'}}"', from=1-1, to=3-1]
      \arrow[tail, from=1-1, to=1-3]
      \arrow[curve={height=-12pt}, dashed, from=3-1, to=1-5]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
\end{rmk}

\section{Elementary topoi}
\label{sec:elementary-topoi}

\begin{defn}[Elementary form]\label{def:topos}
  An (elementary) \emph{topos} $\cE$ is a category with
  \begin{enumerate}
  \item\label{def:topos-pullbacks} Pullbacks;
  \item\label{def:topos-terminal} A terminal object $1$;
  \item\label{def:topos-exponential} To each object $a$ an object $Pa$ and a morphism $\in_{a} : Pa \times a \to P1$ so that for any $f : b \times a \to P1$, there is a unique morphism $g : b \to Pa$ so that $g \times \id$ factors $f$ through $\in_{a}$.
    % https://q.uiver.app/#q=WzAsNSxbMiwxLCJhIFxcdGltZXMgUGEiXSxbMSwyLCJcXE9tZWdhIl0sWzAsMSwiYiBcXHRpbWVzIGEiXSxbMCwwLCJiIl0sWzIsMCwiUGEiXSxbMCwxLCJcXGluX3thfSJdLFsyLDEsImYiLDJdLFsyLDAsImcgXFx0aW1lcyBcXGlkIl0sWzMsNCwiZyIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==
    \[\begin{tikzcd}
	b && Pa \\
	{b \times a} && {Pa \times a} \\
	& \Omega
	\arrow["{\in_{a}}", from=2-3, to=3-2]
	\arrow["f"', from=2-1, to=3-2]
	\arrow["{g \times \id}", from=2-1, to=2-3]
	\arrow["g", dashed, from=1-1, to=1-3]
      \end{tikzcd}\]
  \end{enumerate}
\end{defn}

\begin{rmk}
  The power object $P1$ is the subobject classifier.
\end{rmk}

\begin{rmk}
  We can phrase \cref{def:topos} in a nonelementary way.
  Conditions \ref{def:topos-pullbacks} and \ref{def:topos-terminal} demand that $\cE$ is finitely complete, while condition \ref{def:topos-exponential} demands that $\cE$ has power objects, and thus all exponentials (c.f., \cref{thm:topos-has-exponentials}).
  In other words, a topos is a category with finite limits, exponentials, and a subobject classifier.
\end{rmk}

\begin{rmk}
  The assignment $P : \ob\cE \to \ob\cE$ can be uniquely extended to a functor.
  Extending $P$ to a functor means that for any $c$, the following isomorphism has to be natural in $a$.
  \[
    \cE(c, Pa) \iso \cE(c \times a, \Omega)
  \]
  That is, for any $h : a \to b$, the following diagram must commute.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXGNFKFBiLFBhKSJdLFsyLDAsIlxcY0UoUGIgXFx0aW1lcyBhLCBcXE9tZWdhKSJdLFsyLDIsIlxcY0UoUGIgXFx0aW1lcyBiLCBcXE9tZWdhKSJdLFswLDIsIlxcY0UoUGIsIFBiKSJdLFswLDEsIlxcaXNvIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzMsMiwiXFxpc28iLDMseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMiwxLCJcXGJsYW5rIFxcY2lyYyAoXFxpZCBcXHRpbWVzIGgpIiwyXSxbMywwLCJQaCBcXGNpcmMgXFxibGFuayJdXQ==
  \[\begin{tikzcd}
      {\cE(Pb,Pa)} && {\cE(Pb \times a, \Omega)} \\
      \\
      {\cE(Pb, Pb)} && {\cE(Pb \times b, \Omega)}
      \arrow["\iso"{marking, allow upside down}, draw=none, from=1-1, to=1-3]
      \arrow["\iso"{marking, allow upside down}, draw=none, from=3-1, to=3-3]
      \arrow["{\blank \circ (\id \times h)}"', from=3-3, to=1-3]
      \arrow["{Ph \circ \blank}", from=3-1, to=1-1]
    \end{tikzcd}\]
  The transpose of $\id_{Pb}$ is $\in_{b}$.
  Thus, $Ph$ must be the transpose of $\in_{b}(\id \times h)$.
  Namely, it is the unique morphism given by the universal property of power objects.
  % https://q.uiver.app/#q=WzAsMyxbMCwyLCJQYSBcXHRpbWVzIGEiXSxbMiwyLCJcXE9tZWdhIl0sWzAsMCwiUGIgXFx0aW1lcyBhIl0sWzAsMSwiXFxpbl97YX0iLDJdLFsyLDEsIlxcaW5fe2J9KFxcaWQgXFx0aW1lcyBoKSJdLFsyLDAsIlBoIFxcdGltZXMgXFxpZCIsMix7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==
  \[\begin{tikzcd}
      {Pb \times a} \\
      \\
      {Pa \times a} && \Omega
      \arrow["{\in_{a}}"', from=3-1, to=3-3]
      \arrow["{\in_{b}(\id \times h)}", from=1-1, to=3-3]
      \arrow["{Ph \times \id}"', dashed, from=1-1, to=3-1]
    \end{tikzcd}\]
\end{rmk}

\begin{rmk}
  Indeed, the power object functor $P : \cE\op \to \cE$ is monadic.
  As monadic functors create limits and $\cE$ has finite limits by definition, $\cE\op$ has finite limits.
  Thus, $\cE$ is finitely cocomplete.
\end{rmk}

\begin{eg}
  When $\cE = \CSet$, the functor $P : \CSet\op \to \CSet$ is just the usual (contravariant) powerset functor.
\end{eg}

\begin{rmk}
  Given a topos $\cE$, we can view a subobject of $a$ as
  \begin{enumerate}
  \item An equivalence class of monos: $a' \mono a$.
  \item A characteristic morphism: $a \to \Omega$.
  \item A global element of a power object: $1 \to Pa$.
  \end{enumerate}
  This is due to the following isomorphisms.
  \[
    \Sub_{\cE}(a) \iso \cE(a, \Omega) \iso \cE(1, Pa)
  \]
\end{rmk}

\begin{defn}
  Let $\cE$ be a topos.
  Let $r : s \mono a \times b$ be a subobject with the corresponding characteristic morphism $\varphi : a \times b \to \Omega$ and global element $[\varphi] : b \to Pa$.
  We say that $s$ is an \emph{extension} of the predicate $\varphi$ and the element $[\varphi]$ \emph{names} the predicate $\varphi$.
\end{defn}

\begin{eg}
  In $\CSet$, a relation $R \subseteq X \times Y$ can be equally viewed as a truth functional (predicate) $\varphi : X \times Y \to 2$.
  The name of this predicate is a function $[\varphi] : Y \to PX$ that maps each $y \in Y$ to a subset of $X$ for which $R(x, y)$ holds for all $x$ in that subset.
\end{eg}

\begin{eg}\label{eg:singleton-predicate}
  The diagonal map $\Delta_{a} : a \to a \times a$ is always a monomorphism.
  Thus, in a topos, $\Delta_{a}$ is classified by the equality predicate $\delta_{a} : a \times a \to \Omega$, which is named by the global element $[\delta_{a}] : a \to Pa$.
  As it turns out, the name $[\delta_{a}]$ is a monomorphism itself.
  Thus, it is classified by a predicate $\sigma_{a} : Pa \to \Omega$, called the \emph{singleton} predicate.
\end{eg}

\begin{thm}\label{thm:topos-has-exponentials}
  Every topos has exponentials.
\end{thm}
\begin{proof}
  The main idea is that every function can be identified with a graph in $\CSet$, so a reasonable guess is to take $B^{A}$ as a subobject of $P(A \times B)$.
  Let $r : P(A \times B) \times A \to PB$ be the name of the subobject $\in_{A \times B} \mono P(A \times B) \times A \times B$.
  Take the pullback of the singleton map along $r$.
  % https://q.uiver.app/#q=WzAsNCxbMCwyLCJQKEEgXFx0aW1lcyBCKSBcXHRpbWVzIEEiXSxbMiwyLCJQQiJdLFsyLDAsIkIiXSxbMCwwLCJRIl0sWzAsMSwiciIsMl0sWzIsMSwiXFxTZXR7fSIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMywyXSxbMywwLCJxIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFszLDEsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
  \[\begin{tikzcd}
      Q && B \\
      \\
      {P(A \times B) \times A} && PB
      \arrow["r"', from=3-1, to=3-3]
      \arrow["{\Set{}}", tail, from=1-3, to=3-3]
      \arrow[from=1-1, to=1-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
  In $\CSet$, $Q$ consists of pairs $(G, a)$ so that $\Set{b \in B \mid (a, b) \in G}$ is a singleton set.
  This means the ``function'' is defined at $a$ in a unique way.
  A function must satisfy this for all $a$, so let $q : P(A \times B) \to PB$ be the name of the classifying map $\chi_{Q}$, and $t_{A} : 1 \to PA$ be the name of the maximal subobject in $\Sub(1 \times A)$.
  Take the following pullback.
  % https://q.uiver.app/#q=WzAsNCxbMiwwLCIxIl0sWzIsMiwiUEEiXSxbMCwyLCJQKEEgXFx0aW1lcyBCKSJdLFswLDAsIkJee0F9Il0sWzIsMSwicSIsMl0sWzAsMSwidF97QX0iXSxbMywyLCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzMsMF1d
  \[\begin{tikzcd}
      {B^{A}} && 1 \\
      \\
      {P(A \times B)} && PA
      \arrow["q"', from=3-1, to=3-3]
      \arrow["{t_{A}}", tail, from=1-3, to=3-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
  In $\CSet$, $B^{A}$ is precisely the set of all graphs from $A$ to $B$.
  It remains to verify that $B^{A}$ has the universal property of exponentials.
  Note that the following diagram is a pullback square.
  % https://q.uiver.app/#q=WzAsNCxbMiwwLCJCIl0sWzIsMiwiUEIiXSxbMCwyLCJBIFxcdGltZXMgUChBIFxcdGltZXMgQikiXSxbMCwwLCJBIFxcdGltZXMgQl57QX0iXSxbMiwxLCJyIiwyXSxbMCwxLCJcXFNldHt9Il0sWzMsMiwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFszLDBdLFszLDEsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
  \[\begin{tikzcd}
      {A \times B^{A}} && B \\
      \\
      {A \times P(A \times B)} && PB
      \arrow["r"', from=3-1, to=3-3]
      \arrow["{\Set{}}", from=1-3, to=3-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
  The projection $A \times B^{A} \to B$ defines the evaluation map.
  Now, for any morphism $A \times C \to B$, we construct a morphism $A \times C \to A \times P(A \times B)$.
  First, to construction a morphism $C \to P(A \times B)$, it suffices to construct a morphism $A \times C \to PB$.
  Take $\Set{} \circ f$, and let $g : C \to P(A \times B)$ be its transpose.
  In $\CSet$, $g$ is defined by $c \mapsto \Set{(a, f(a, c))}$.
  Then $\id_{A} \times g$ makes the outer square of the following diagram commute.
  Thus, we have proven the required universal property.
  % https://q.uiver.app/#q=WzAsNSxbMywxLCJCIl0sWzMsMywiUEIiXSxbMSwzLCJBIFxcdGltZXMgUChBIFxcdGltZXMgQikiXSxbMSwxLCJBIFxcdGltZXMgQl57QX0iXSxbMCwwLCJBIFxcdGltZXMgQyJdLFsyLDEsInIiLDJdLFswLDEsIlxcU2V0e30iXSxbMywyLCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzMsMCwiXFxldiJdLFszLDEsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dLFs0LDAsImYiLDAseyJjdXJ2ZSI6LTJ9XSxbNCwyLCJcXGlkX3tBfSBcXHRpbWVzIGciLDIseyJjdXJ2ZSI6Mn1dLFs0LDMsIlxcaWRfe0F9IFxcdGltZXMgXFxmaGF0IiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
  \[\begin{tikzcd}
      {A \times C} \\
      & {A \times B^{A}} && B \\
      \\
      & {A \times P(A \times B)} && PB
      \arrow["r"', from=4-2, to=4-4]
      \arrow["{\Set{}}", from=2-4, to=4-4]
      \arrow[tail, from=2-2, to=4-2]
      \arrow["\ev", from=2-2, to=2-4]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-2, to=4-4]
      \arrow["f", curve={height=-12pt}, from=1-1, to=2-4]
      \arrow["{\id_{A} \times g}"', curve={height=12pt}, from=1-1, to=4-2]
      \arrow["{\id_{A} \times \fhat}"{description}, dashed, from=1-1, to=2-2]
    \end{tikzcd}\]
\end{proof}

\begin{thm}
  In a topos, every monomorphism is an equalizer and every mono and epi morphism is an isomorphism.
\end{thm}
\begin{proof}
  The second statement follows from the first.
  Let $\Omega_{t}$ be the equalizer of $\id_{\Omega}$ and $t!_{\Omega}$.
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJcXE9tZWdhX3t0fSJdLFsyLDAsIlxcT21lZ2EiXSxbNCwwLCJcXE9tZWdhIl0sWzEsMiwidCFfe1xcT21lZ2F9IiwwLHsib2Zmc2V0IjotMX1dLFsxLDIsIlxcaWRfe1xcT21lZ2F9IiwyLHsib2Zmc2V0IjoxfV0sWzAsMSwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dXQ==
  \[\begin{tikzcd}
      {\Omega_{t}} && \Omega && \Omega
      \arrow["{t!_{\Omega}}", shift left, from=1-3, to=1-5]
      \arrow["{\id_{\Omega}}"', shift right, from=1-3, to=1-5]
      \arrow[tail, from=1-1, to=1-3]
    \end{tikzcd}\]
  It's easy to verify that $A \mono B$ is the equalizer of $\chi_{A}$ and $t!_{\Omega}\chi_{A}$.
  Note that $!_{\Omega}\chi_{A} = !_{B}$ because $1$ is the terminal object.
\end{proof}

\begin{rmk}
  $\Omega_{t}$ classifies maximal subobjects.
  In $\CSet$, $\Omega_{t}$ coincides with the terminal object $1$, so $t_{t} : 1 \to \Omega_{t}$ can only be pulled back along the unique map $! : A \to \Omega_{t}$, giving the maximal subobject $A \subseteq A$.
\end{rmk}

\begin{cor}
  Every topos is balanced.
\end{cor}

\begin{defn}
  Let $\cE$ and $\cF$ be topoi.
  A \emph{logical functor} $F : \cE \to \cF$ is a functor that preserves finite limits, the subobject classifier, and exponentials.
\end{defn}

\begin{defn}
  Let $\cE$ and $\cF$ be topoi.
  A \emph{geometric morphism} $f : \cF \to \cE$ consists of a pair of functors
  % https://q.uiver.app/#q=WzAsMixbMCwwLCJcXGNGIl0sWzIsMCwiXFxjRSJdLFswLDEsImZfeyp9IiwyLHsiY3VydmUiOjJ9XSxbMSwwLCJmXnsqfSIsMix7ImN1cnZlIjoyfV0sWzMsMiwiIiwyLHsibGV2ZWwiOjEsInN0eWxlIjp7Im5hbWUiOiJhZGp1bmN0aW9uIn19XV0=
  \[\begin{tikzcd}
      \cF && \cE
      \arrow[""{name=0, anchor=center, inner sep=0}, "{f_{*}}"', curve={height=12pt}, from=1-1, to=1-3]
      \arrow[""{name=1, anchor=center, inner sep=0}, "{f^{*}}"', curve={height=12pt}, from=1-3, to=1-1]
      \arrow["\dashv"{anchor=center, rotate=-90}, draw=none, from=1, to=0]
    \end{tikzcd}\]
  such that $f^{*}$ preserves finite limits.
  The functor $f_{*}$ is called the \emph{direct image} of $f$ and $f^{*}$ is the \emph{inverse image} of $f$.
  If $f$ and $g$ are geometric morphism, a \emph{geometric transformation} $\alpha : f \to g$ is a natural transformation $f^{*} \To g^{*}$.
\end{defn}

\begin{defn}
  We write $\CTopoi$ for the 2-category of topoi, geometric morphisms, and geometric transformations.
\end{defn}

\begin{eg}\label{eg:geometric-morphisms-between-presheaves}
  Let $F : \iC \to \iD$ be a functor between small categories.
  The functor $f^{*}$ defined by precomposition has a left and right adjoints.
  The right Kan extension is the direct image, while $f^{*}$ is the inverse image.
  % https://q.uiver.app/#q=WzAsMixbMCwwLCJcXFBzaChcXGlEKSJdLFsyLDAsIlxcUHNoKFxcaUMpIl0sWzAsMSwiZl57Kn0iLDAseyJvZmZzZXQiOi0yfV0sWzEsMCwiXFxyYW5fe2Z9IiwwLHsib2Zmc2V0IjotMn1dLFsyLDMsIiIsMix7ImxldmVsIjoxLCJzdHlsZSI6eyJuYW1lIjoiYWRqdW5jdGlvbiJ9fV1d
  \[\begin{tikzcd}
      {\Psh(\iD)} && {\Psh(\iC)}
      \arrow[""{name=0, anchor=center, inner sep=0}, "{f^{*}}", shift left=2, from=1-1, to=1-3]
      \arrow[""{name=1, anchor=center, inner sep=0}, "{\ran_{f}}", shift left=2, from=1-3, to=1-1]
      \arrow["\dashv"{anchor=center, rotate=-90}, draw=none, from=0, to=1]
    \end{tikzcd}\]
  Thus, the assignment $\iC \mapsto \Psh(\iC)$ can be extended to a pseudofunctor $\CCat \to \CTopoi$.
\end{eg}

\begin{defn}
  A geometric morphism $f : \cF \to \cE$ is \emph{essential} if the inverse image $f^{*} : \cE \to \cF$ has a left adjoint.
  We write $f_{!}$ for the left adjoint of $f^{*}$.
\end{defn}

\todo{It appears a lot of the ``dirty work'' we did for algebraic theories can be nicely explained by examples in Elephant A.4.1.}
\todo{This appears to be a connection between geometry and algebra.}

\begin{lem}
  Let $\iC$ and $\iD$ be small categories such that $\iD$ is Cauchy-complete.
  Then every essential geometric morphism $f : \Psh(\iC) \to \Psh(\iD)$ is induced by a functor $\iC \to \iD$.
\end{lem}
\begin{proof}
  Let $g : \iC \to \iD$ be a functor.
  By \cref{eg:geometric-morphisms-between-presheaves}, this functor induces an essential geometric morphism defined by precomposition.

  Conversely, let $f$ be an essential geometric morphism.
  We want to show that $f$ is induced by a functor $g : \iC \to \iD$ by precomposition.
  Note that representable functors are tiny in the presheaf category and $f^{*}$ preserves colimits.
  Owing to the following natural isomorphism,
  \[
    \Psh(\iD)(f_{!}\iC(\blank, c), \blank) \iso \Psh(\iC)(\iC(\blank,c), f^{*}\blank)
  \]
  we see that $\Psh(\iD)(f_{!}\iC(\blank, c), \blank)$ preserves sifted colimits.
  Thus, $f_{!}\iC(\blank,c)$ is perfectly presentable and therefore it is a retract of a representable.
  Since $\iD$ is Cauchy-complete, $f_{!}\iC(\blank, c)$ is representable.
  Thus, $f_{!}$ restricts along the Yoneda embedding to a functor $f_{0} : \iC \to \iD$.
  Indeed, $f$ is induced by $f_{0}$.
  \begin{align}
    f^{*}(F)(c) &\iso \Psh(\iC)(\iC(\blank, c), f^{*}F)\\
                &\iso \Psh(\iD)(f_{!}\iC(\blank, c), F)\\
                &\iso \Psh(\iD)(\iD(\blank, f_{0}c), F)\\
                &\iso Ff_{0}c
  \end{align}
\end{proof}

\begin{lem}\label{lem:cartesian-closed-iff-pullbacks}
  A category $\iC$ is locally cartesian iff it has pullbacks.
\end{lem}
\begin{proof}
  Let $c \in \iC$ be any object.
  The forgetful functor $\Pi : \iC/c \to \iC$ preserves (and creates) connected limits.
  Thus, $\iC/c$ has pullbacks whenever $\iC$ does.
  Since $\iC/c$ has a terminal object, it is finitely complete if $\iC$ has pullbacks.
  Conversely, if $\iC$ is locally cartesian, then pullbacks in $\iC$ can be constructed as products in a slice $\iC/c$ for some $c \in \iC$.
\end{proof}

\begin{cor}\label{cor:topos-locally-cartesian}
  Every topos is locally cartesian.
\end{cor}

\begin{rmk}
  Let $\iC$ be a category and $f : a \to b$ be a morphism of $\iC$.
  By unfolding the definition of slice category, we see that $\iC/a \iso (\iC/b)/f$.
  Thus, there is a canonical functor $\Sigma_{f} : \iC/a \to \iC/b$ given by the forgetful functor $\Pi : (\iC/b)/f \iso \iC/a \to \iC/b$.
  Explicitly, $\Sigma_{f} : g \mapsto fg$.
\end{rmk}

\begin{lem}
  A category $\iC$ is locally cartesian closed iff $\Sigma_{f}$ has a right adjoint $f^{*}$ for all $f$.
\end{lem}
\begin{proof}
  By \cref{lem:cartesian-closed-iff-pullbacks}, being locally cartesian closed is the same as having pullbacks.
  If $\iC$ has pullbacks, then take $f^{*}$ to be the pullback functor.
  The universal property of pullbacks implies that $\Sigma_{f} \adj f^{*}$.
  % https://q.uiver.app/#q=WzAsNSxbMSwzLCJhIl0sWzMsMywiYiJdLFszLDEsImMiXSxbMSwxLCJcXGJ1bGxldCJdLFswLDAsIlxcYnVsbGV0Il0sWzAsMSwiZiIsMl0sWzIsMSwiaCJdLFszLDAsImZeeyp9aCIsMl0sWzMsMl0sWzQsMCwiZyIsMix7ImN1cnZlIjoyfV0sWzQsMiwiIiwyLHsiY3VydmUiOi0yfV0sWzQsMywiIiwyLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzMsMSwiIiwyLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
  \[\begin{tikzcd}
      \bullet \\
      & f \times h && c \\
      \\
      & a && b
      \arrow["f"', from=4-2, to=4-4]
      \arrow["h", from=2-4, to=4-4]
      \arrow["{f^{*}h}"', from=2-2, to=4-2]
      \arrow[from=2-2, to=2-4]
      \arrow["g"', curve={height=12pt}, from=1-1, to=4-2]
      \arrow[curve={height=-12pt}, from=1-1, to=2-4]
      \arrow[dashed, from=1-1, to=2-2]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-2, to=4-4]
    \end{tikzcd}\]
  Conversely, if $\Sigma_{f} \adj f^{*}$ for all $f$, then we can define pullbacks as follows.
  % https://q.uiver.app/#q=WzAsNCxbMCwyLCJhIl0sWzIsMiwiYiJdLFsyLDAsImMiXSxbMCwwLCJcXGJ1bGxldCJdLFswLDEsImYiLDJdLFsyLDEsImgiXSxbMywwLCJmXnsqfWgiLDJdLFszLDIsIlxcZXBzaWxvbl97aH0iXSxbMywxLCIiLDIseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=
  \[\begin{tikzcd}
      f \times h && c \\
      \\
      a && b
      \arrow["f"', from=3-1, to=3-3]
      \arrow["h", from=1-3, to=3-3]
      \arrow["{f^{*}h}"', from=1-1, to=3-1]
      \arrow["{\epsilon_{h}}", from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
\end{proof}

\begin{cor}
  Let $\cE$ be a topos.
  $\Sigma_{f}$ has a right adjoint $f^{*}$ for all morphisms $f$ in $\cE$.
\end{cor}

\begin{notn}
  In a topos, we write $\Sigma_{B}$ for $\Sigma_{!_{B}} : \cE/B \to \cE/1 \iso \cE$ and $B^{*}$ for $!_{B}^{*} : \cE/1 \iso \cE \to \cE/B$.
\end{notn}

\begin{thm}
  Let $\cE$ be a topos and $B$ be an object of $\cE$.
  Then $\cE/B$ is a topos, and the pullback functor $B^{*} : \cE \to \cE/B$ is logical.
\end{thm}
\begin{proof}
  First, for each object $A \in \cE$, we claim that $B^{*}(PA)$ equipped with the relation $B^{*}(\in_{A})$ is a power object of $B^{*}A$ in $\cE/B$.
  Let $f : C \to B$ be any object in $\cE/B$.
  The product $f \times B^{*}A$ is constructed as the following pullback in $\cE$.
  % https://q.uiver.app/#q=WzAsNCxbMCwyLCJDIl0sWzIsMiwiQiJdLFsyLDAsIkIgXFx0aW1lcyBBIl0sWzAsMCwiXFxidWxsZXQiXSxbMiwxLCJCXnsqfUEgPSBcXHBpX3sxfSJdLFswLDEsImYiLDJdLFszLDBdLFszLDJdLFszLDEsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
  \[\begin{tikzcd}
      \bullet && {B \times A} \\
      \\
      C && B
      \arrow["{B^{*}A = \pi_{1}}", from=1-3, to=3-3]
      \arrow["f"', from=3-1, to=3-3]
      \arrow[from=1-1, to=3-1]
      \arrow[from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
  Note that the following square is also a pullback.
  % https://q.uiver.app/#q=WzAsNCxbMCwyLCJDIl0sWzIsMiwiQiJdLFsyLDAsIkIgXFx0aW1lcyBBIl0sWzAsMCwiQyBcXHRpbWVzIEEiXSxbMiwxLCJcXHBpX3sxfSJdLFswLDEsImYiLDJdLFszLDAsIlxccGlfezF9IiwyXSxbMywyLCJmIFxcdGltZXMgXFxpZF97QX0iXSxbMywxLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=
  \[\begin{tikzcd}
      {C \times A} && {B \times A} \\
      \\
      C && B
      \arrow["{\pi_{1}}", from=1-3, to=3-3]
      \arrow["f"', from=3-1, to=3-3]
      \arrow["{\pi_{1}}"', from=1-1, to=3-1]
      \arrow["{f \times \id_{A}}", from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
  Thus, $\Sigma_{B}(f \times B^{*}A) \iso C \times A$.
  This means that there is a bijection between the subobjects of $f \times B^{*}A$ in $\cE/B$ and those of $C \times A$ in $\cE$.
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJDIFxcdGltZXMgQSJdLFsxLDEsIkIiXSxbMiwwLCJcXGJ1bGxldCJdLFswLDEsImYgXFx0aW1lcyBCXnsqfUEiLDJdLFsyLDAsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMiwxXV0=
  \[\begin{tikzcd}
      {C \times A} && \bullet \\
      & B
      \arrow["{f \times B^{*}A}"', from=1-1, to=2-2]
      \arrow[tail, from=1-3, to=1-1]
      \arrow[from=1-3, to=2-2]
    \end{tikzcd}\]
  Thus, every relation from $f$ to $B^{*}A$ in $\cE/B$ may be regarded as a relation from $C$ to $A$ in $\cE$.
  Let $g : C \to PA$ be the name of such a relation.
  Then $(f, g) : f \to B^{*}(PA)$ is the unique name for the same relation in $\cE/B$.
  % https://q.uiver.app/#q=WzAsNSxbMCwwLCJDIl0sWzEsMSwiQiBcXHRpbWVzIFBBIl0sWzEsMywiQiJdLFszLDMsIjEiXSxbMywxLCJQQSJdLFsxLDRdLFsxLDIsIkJeeyp9KFBBKSJdLFsyLDNdLFs0LDNdLFsxLDMsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dLFswLDIsImYiLDIseyJjdXJ2ZSI6Mn1dLFswLDQsImciLDAseyJjdXJ2ZSI6LTJ9XSxbMCwxLCIiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XV0=
  \[\begin{tikzcd}
      C \\
      & {B \times PA} && PA \\
      \\
      & B && 1
      \arrow[from=2-2, to=2-4]
      \arrow["{B^{*}(PA)}", from=2-2, to=4-2]
      \arrow[from=4-2, to=4-4]
      \arrow[from=2-4, to=4-4]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-2, to=4-4]
      \arrow["f"', curve={height=12pt}, from=1-1, to=4-2]
      \arrow["g", curve={height=-12pt}, from=1-1, to=2-4]
      \arrow[dashed, from=1-1, to=2-2]
    \end{tikzcd}\]
  Since every topos is locally cartesian (c.f., \cref{cor:topos-locally-cartesian}), it suffices to construct the subobject classifier.
  This is immediate because we have shown that $B^{*}$ preserves power objects (and therefore subobject classifier).
  \todo{I forgot to construct exponentials.}
\end{proof}

\begin{defn}
  In a category $\iC$, an object $c$ is \emph{injective} when for every monomorphism $m : d \mono d'$ in $\iC$, every morphism $f : d \to c$ can be extended to a morphism $f' : d' \to c$ so that $f = f'm$.
\end{defn}

\begin{thm}\label{thm:subobject-classifier-injective}
  In a topos $\cE$, the subobject classifier is injective.
\end{thm}
\begin{proof}
  Let $m : d \mono d'$ and $f : d \to \Omega$.
  The morphism $f$ determines a pullback square in $\cE$.
  % https://q.uiver.app/#q=WzAsNCxbMCwyLCJkIl0sWzIsMiwiXFxPbWVnYSJdLFswLDAsImMiXSxbMiwwLCIxIl0sWzAsMSwiZiIsMl0sWzIsMCwiaCIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMiwzXSxbMywxLCJ0IiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dXQ==
  \[\begin{tikzcd}
      c && 1 \\
      \\
      d && \Omega
      \arrow["f"', from=3-1, to=3-3]
      \arrow["h"', tail, from=1-1, to=3-1]
      \arrow[from=1-1, to=1-3]
      \arrow["t", tail, from=1-3, to=3-3]
    \end{tikzcd}\]
  The composite $mh : c \mono d'$ is a subobject of $d'$ classified by a morphism $g : d' \to \Omega$.
  % https://q.uiver.app/#q=WzAsNCxbMCwyLCJkJyJdLFsyLDIsIlxcT21lZ2EiXSxbMCwwLCJjIl0sWzIsMCwiMSJdLFswLDEsImciLDJdLFsyLDAsIm1oIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFsyLDNdLFszLDEsInQiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV1d
  \[\begin{tikzcd}
      c && 1 \\
      \\
      {d'} && \Omega
      \arrow["g"', from=3-1, to=3-3]
      \arrow["mh"', tail, from=1-1, to=3-1]
      \arrow[from=1-1, to=1-3]
      \arrow["t", tail, from=1-3, to=3-3]
    \end{tikzcd}\]
  As $gm$ and $f$ classify the same subobject of $d$, the universal property of subobject classifiers demands that $gm = f$.
\end{proof}

\begin{cor}\label{cor:power-objects-injective}
  In a topos $\cE$, every power object $PA$ is injective.
\end{cor}
\begin{proof}
  For any monomorphism $m : d \to d'$ and any morphism $f : d \to PA$, consider the transpose $f^{\dagger} : A \times d \to \Omega$.
  By \cref{thm:subobject-classifier-injective}, $f^{\dagger}$ extends to a morphism $g^{\dagger} : A \times d' \to \Omega$.
  % https://q.uiver.app/#q=WzAsMyxbMiwwLCJcXE9tZWdhIl0sWzAsMCwiQSBcXHRpbWVzIGQiXSxbMCwyLCJBIFxcdGltZXMgZCciXSxbMSwwLCJmXntcXGRhZ2dlcn0iXSxbMSwyLCJcXGlkX3tBfSBcXHRpbWVzIG0iLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzIsMCwiZ157XFxkYWdnZXJ9IiwyXV0=
  \[\begin{tikzcd}
      {A \times d} && \Omega \\
      \\
      {A \times d'}
      \arrow["{f^{\dagger}}", from=1-1, to=1-3]
      \arrow["{\id_{A} \times m}"', tail, from=1-1, to=3-1]
      \arrow["{g^{\dagger}}"', from=3-1, to=1-3]
    \end{tikzcd}\]
  Thus, $g : d' \to PA$ is the required extension of $f$.
\end{proof}

\begin{cor}
  Every object $c$ in a topos $\cE$ has a monomorphism to an injective object.
\end{cor}
\begin{proof}
  The singleton morphism $\Set{}_{c} : c \mono Pc$ is a monomorphism.
  By \cref{cor:power-objects-injective}, $Pc$ is an injective object.
\end{proof}

\begin{cor}\label{cor:coproducts-disjoint}
  Let $X \xto{i} X + Y \xot{j} Y$ be a coproduct diagram in a topos $\cE$.
  Then $i$ and $j$ are monomorphisms and the following diagram is a pullback.
  % https://q.uiver.app/#q=WzAsNCxbMCwyLCJYIl0sWzIsMiwiWCtZIl0sWzIsMCwiWSJdLFswLDAsIjAiXSxbMCwxLCJpIiwyXSxbMiwxLCJqIl0sWzMsMF0sWzMsMl1d
  \[\begin{tikzcd}
      0 && Y \\
      \\
      X && {X+Y}
      \arrow["i"', from=3-1, to=3-3]
      \arrow["j", from=1-3, to=3-3]
      \arrow[from=1-1, to=3-1]
      \arrow[from=1-1, to=1-3]
    \end{tikzcd}\]
\end{cor}
\begin{proof}
  Suppose that $if = ig$.
  Then $\Set{}_{X}f = [\Set{}_{X},\Set{}_{Y}]if = [\Set{}_{X},\Set{}_{Y}]ig = \Set{}_{X}g$.
  Since $\Set{}_{X}$ is monic, $f = g$.
  The proof is completely analogous for $j$.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJYIl0sWzIsMCwiWCtZIl0sWzIsMiwiUFgiXSxbNCwwLCJZIl0sWzAsMSwiaSJdLFswLDIsIlxcU2V0e31fe1h9IiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFsxLDIsIiIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFszLDEsImoiLDJdLFszLDIsIlxcU2V0e31fe1l9IiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dXQ==
  \[\begin{tikzcd}
      X && {X+Y} && Y \\
      \\
      && PX
      \arrow["i", from=1-1, to=1-3]
      \arrow["{\Set{}_{X}}"', tail, from=1-1, to=3-3]
      \arrow[dashed, from=1-3, to=3-3]
      \arrow["j"', from=1-5, to=1-3]
      \arrow["{\Set{}_{Y}}", tail, from=1-5, to=3-3]
    \end{tikzcd}\]
  Since $i$ and $j$ are monomorphism, it is easy to verify that the square is a pullback.
\end{proof}

\cref{cor:coproducts-disjoint} means that coproducts in a topos are disjoint.

\begin{defn}[Gluing construction]
  Let $F : \cE \to \cF$ be a finite-limit preserving functor between topoi.
  The \emph{glued topos}, $\Gl(F)$, is the comma category $(\cF \dn F)$.
  The comma category $(\cF \dn F)$ is indeed a topos.
\end{defn}

\begin{defn}[Filter quotient construction]
  Let $\cE$ be a topos, and $\Phi$ be a filter of subterminal objects.
  A \emph{$\Phi$-map} $A \phito B$ in $\cE$ is a morphism $A \times U \to B$ for some $U \in \Phi$.
  Two $\Phi$-maps $f : A \times U \to B$ and $g : A \times V \to B$ are \emph{equivalent} if there is $W \leq U \cap V$ in $\Phi$ so that
  % https://q.uiver.app/#q=WzAsNCxbMCwyLCJBIFxcdGltZXMgVSJdLFsyLDIsIkIiXSxbMiwwLCJBIFxcdGltZXMgViJdLFswLDAsIkEgXFx0aW1lcyBXIl0sWzAsMSwiZiIsMl0sWzIsMSwiZyJdLFszLDIsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMywwLCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV1d
  \[\begin{tikzcd}
      {A \times W} && {A \times V} \\
      \\
      {A \times U} && B
      \arrow["f"', from=3-1, to=3-3]
      \arrow["g", from=1-3, to=3-3]
      \arrow[tail, from=1-1, to=1-3]
      \arrow[tail, from=1-1, to=3-1]
    \end{tikzcd}\]
  commutes.
  For two $\Phi$-maps $f : A \times U \to B$ and $g : B \times V \to C$, their composition is $g \circ (f \times \id_{V})$.
  The topos $\cE_{\Phi}$ consists of objects of $\cE$ as objects and equivalence classes of $\Phi$-maps as morphisms.
  The functor $P_{\Phi} : \cE \to \cE_{\Phi}$, which is identity on objects and sends each morphism to the equivalence class of $f$ regarded as $A \times 1 \to B$, is logical.
\end{defn}

% \section{Grothendieck topologies}
% \label{sec:grothendieck-topologies}

% \begin{defn}
%   A \emph{Grothendieck topology} on a category $\iC$ is a function $J$ assigning to each object $c$ a collection $J(c)$ of covering sieves on $c$ so that
%   \begin{enumerate}
%   \item For any object $c$, the maximal sieve is in $J(c)$.
%   \item (Stability) If $S$ is a sieve that covers $c$ and $g : d \to c$ is any morphism, then the pullback sieve $g^{*}S$ covers $d$.
%   \item (Local character) If $R$ is a covering sieve on $c$ and $S$ is another sieve on $c$ such that for all $f : d \to c \in R$, the pullback sieve $f^{*}S$ covers $d$, then $S$ covers $c$.
%   \end{enumerate}
% \end{defn}

% \begin{rmk}
%   Stability means the assignment $J$ extends to a functor $J : \iC\op \to \CSet$, i.e., an object in the presheaf category $\Psh(\iC)$.
%   The subobject classifier $\Omega$ in $\Psh(\iC)$ is the functor $\Sub(\yon\blank)$ sending each $c \in \iC$ to the set of sieves on $c$.
%   Thus, $J$ (a functor sending each $c$ to a set of covering sieves on $c$) is a subobject of $\Omega$.
% \end{rmk}

\section{Lawvere-Tierney topologies}
\label{sec:lawvere-tierney-topologies}

Let $X$ be a topological space.
A sheaf (of sets) is an assignment $\cO(X)\op \to \CSet$ so that a global section can be uniquely determined by gluing compatible local sections according to the topology of $X$.

Note that the subobject classifier in $\Psh(\cO(X))$ is the functor $\Sub\yon : \cO(X)\op \to \CSet$, assigning to each open set $U$ the set of all subfunctors $R \subseteq \cO(X)(\blank, U)$.
By definition, $\cO(X)(V,U) = 1$ if $V \subseteq U$, so $R(V) = 1$ necessarily implies that $V \subseteq U$, i.e., $\cO(X)(V, U) = 1$.
If additionally $V' \subseteq V$, then $R(V') = 1$ because we have $R(V) \to R(V')$.
Thus, we can view $R$ as a filter on $U$, i.e., a downward closed set of open subsets of $U$.

A family $\Set{U_{i}}_{i \in I}$ is an open cover of $U$ if $\bigcup_{i \in I}U_{i} = U$.
To formalize this idea, we define a natural transformation
\begin{mathpar}
  j : \Omega \to \Omega \and j_{U}(R) = \bigcup R
\end{mathpar}
For $V \subseteq U$, we have
\[
  \Omega(V \subseteq U)(j_{U}(R)) = \left(\bigcup R\right) \cap V = \bigcup(R \cap V) = j_{V}(\Omega(V \subseteq U)(R))
\]
The component $j_{U} : \Omega(U) \to \Omega(U)$ maps each filter on $U$ to the open subset that it covers.

The pullback of $t : 1 \to \Omega$ along $j$ determines a subobject $J$.
% https://q.uiver.app/#q=WzAsNCxbMCwwLCJKIl0sWzAsMiwiXFxPbWVnYSJdLFsyLDIsIlxcT21lZ2EiXSxbMiwwLCIxIl0sWzEsMiwiaiIsMl0sWzAsMSwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFszLDIsInQiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzAsM10sWzAsMiwiIiwxLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
\[\begin{tikzcd}
    J && 1 \\
    \\
    \Omega && \Omega
    \arrow["j"', from=3-1, to=3-3]
    \arrow[tail, from=1-1, to=3-1]
    \arrow["t", tail, from=1-3, to=3-3]
    \arrow[from=1-1, to=1-3]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
  \end{tikzcd}\]
By evaluating each functor at a given open set $U$ yields a pullback in $\CSet$, which is the fiber product of the functions $j_{U}$ and $t_{U}$, so the pullback is nothing but the set
\[
  J(U) = \Set{R \mono \Omega(U) \mid j_{U}(R) = U}
\]
By definition, $j_{U}(R) = \bigcup R$.
Thus, $J(U)$ is the set of all open covers of $U$.

\begin{defn}\label{def:lawvere-tierney-topology}
  A \emph{Lawvere-Tierney topology} (topology for short) on a topos $\cE$ is a morphism $j : \Omega \to \Omega$ satisfying
  % https://q.uiver.app/#q=WzAsMTAsWzAsMCwiMSJdLFsxLDAsIlxcT21lZ2EiXSxbMSwxLCJcXE9tZWdhIl0sWzIsMCwiXFxPbWVnYSJdLFszLDAsIlxcT21lZ2EiXSxbMywxLCJcXE9tZWdhIl0sWzQsMCwiXFxPbWVnYSBcXHRpbWVzIFxcT21lZ2EiXSxbNSwwLCJcXE9tZWdhIl0sWzUsMSwiXFxPbWVnYSJdLFs0LDEsIlxcT21lZ2EgXFx0aW1lcyBcXE9tZWdhIl0sWzAsMSwidCJdLFsxLDIsImoiXSxbMCwyLCJ0IiwyXSxbMyw0LCJqIl0sWzQsNSwiaiJdLFszLDUsImoiLDJdLFs2LDcsIlxcd2VkZ2UiXSxbOSw4LCJcXHdlZGdlIiwyXSxbNiw5LCJqIiwyXSxbNyw4LCJqIl1d
  \[\begin{tikzcd}
      1 & \Omega & \Omega & \Omega & {\Omega \times \Omega} & \Omega \\
      & \Omega && \Omega & {\Omega \times \Omega} & \Omega
      \arrow["t", from=1-1, to=1-2]
      \arrow["j", from=1-2, to=2-2]
      \arrow["t"', from=1-1, to=2-2]
      \arrow["j", from=1-3, to=1-4]
      \arrow["j", from=1-4, to=2-4]
      \arrow["j"', from=1-3, to=2-4]
      \arrow["\wedge", from=1-5, to=1-6]
      \arrow["\wedge"', from=2-5, to=2-6]
      \arrow["j \times j"', from=1-5, to=2-5]
      \arrow["j", from=1-6, to=2-6]
    \end{tikzcd}\]
\end{defn}

\begin{rmk}
  The morphism $j : \Omega \to \Omega$ classifies a subobject of $\Omega$.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJKIl0sWzIsMCwiMSJdLFsyLDIsIlxcT21lZ2EiXSxbMCwyLCJcXE9tZWdhIl0sWzMsMiwiaiIsMl0sWzEsMiwidCIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMCwxXSxbMCwzLCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzAsMiwiIiwxLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
  \[\begin{tikzcd}
      J && 1 \\
      \\
      \Omega && \Omega
      \arrow["j"', from=3-1, to=3-3]
      \arrow["t", tail, from=1-3, to=3-3]
      \arrow[from=1-1, to=1-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
  Thus, we can phrase \cref{def:lawvere-tierney-topology} in terms of this subobject.
\end{rmk}

\begin{defn}
  Let $\cE$ be a topos equipped with a topology $j$.
  Let $A$ be a subobject of $B$ classified by $\chi_{A}$.
  The composite $j \circ \chi_{A}$ determines another subobject $\Abar$ of $B$, which we call the \emph{closure} of $A$.
\end{defn}

\begin{thm}\label{thm:closure-operator-in-topos}
  Let $\cE$ be a topos, a morphism $j : \Omega \to \Omega$ induces an operator $E \mapsto \Ebar$ on the subobjects of each object $E$ of $\cE$ natural in its argument in the sense that for any $f : A \to B$ in $\cE$ and any subobject $C$ of $B$, one has
  \[
    f^{*}(\Cbar) = \overline{f^{*}C}
  \]
  Moreover, $j$ is a topology if and only if the operator satisfies
  \begin{mathpar}
    A \subseteq \Abar \and \overline{\Abar} = \Abar \and \overline{A \cap B} = \Abar \cap \Bbar
  \end{mathpar}
  for all objects.
\end{thm}
\begin{proof}
  By definition, $f^{*}(\Cbar)$ is the pullback of $\Cbar$ along $f$.
  Thus, $f^{*}(\Cbar)$ is a subobject classified by $j \circ \chi_{C} \circ f$, which by definition classifies the subobject $\overline{f^{*}C}$.
  % https://q.uiver.app/#q=WzAsNixbMiwwLCJcXENiYXIiXSxbMiwyLCJCIl0sWzQsMiwiXFxPbWVnYSJdLFs0LDAsIjEiXSxbMCwyLCJBIl0sWzAsMCwiZl57Kn0oXFxDYmFyKSJdLFswLDEsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMSwyLCJqIFxcY2lyYyBcXGNoaV97Q30iLDJdLFszLDIsInQiXSxbMCwzXSxbNCwxLCJmIiwyXSxbNSw0LCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzUsMF0sWzUsMSwiIiwyLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV0sWzAsMiwiIiwyLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
  \[\begin{tikzcd}
      {f^{*}(\Cbar)} && \Cbar && 1 \\
      \\
      A && B && \Omega
      \arrow[tail, from=1-3, to=3-3]
      \arrow["{j \circ \chi_{C}}"', from=3-3, to=3-5]
      \arrow["t", from=1-5, to=3-5]
      \arrow[from=1-3, to=1-5]
      \arrow["f"', from=3-1, to=3-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-3, to=3-5]
    \end{tikzcd}\]

  Now suppose that $j$ is a topology.
  The closure properties are can be proved by the following abstract nonsense.
  \begin{mathpar}
    % https://q.uiver.app/#q=WzAsNixbMSwyLCJCIl0sWzIsMiwiXFxPbWVnYSJdLFszLDIsIlxcT21lZ2EiXSxbMywxLCIxIl0sWzEsMSwiXFxBYmFyIl0sWzAsMCwiQSJdLFswLDEsIlxcY2hpX3tBfSIsMl0sWzEsMiwiaiIsMl0sWzMsMiwidCIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbNCwwLCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzQsM10sWzUsMywiIiwwLHsiY3VydmUiOi0yfV0sWzUsMCwiIiwwLHsiY3VydmUiOjIsInN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMywxLCJ0IiwyXSxbNSw0LCIiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbNCwyLCIiLDAseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=
    \begin{tikzcd}
      A \\
      & \Abar && 1 \\
      & B & \Omega & \Omega
      \arrow["{\chi_{A}}"', from=3-2, to=3-3]
      \arrow["j"', from=3-3, to=3-4]
      \arrow["t", tail, from=2-4, to=3-4]
      \arrow[tail, from=2-2, to=3-2]
      \arrow[from=2-2, to=2-4]
      \arrow[curve={height=-12pt}, from=1-1, to=2-4]
      \arrow[curve={height=12pt}, tail, from=1-1, to=3-2]
      \arrow["t"', from=2-4, to=3-3]
      \arrow[dashed, from=1-1, to=2-2]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-2, to=3-4]
    \end{tikzcd}\and
    % https://q.uiver.app/#q=WzAsNyxbMSwxLCJcXEFiYXIiXSxbMSwyLCJCIl0sWzIsMiwiXFxPbWVnYSJdLFszLDIsIlxcT21lZ2EiXSxbMywxLCIxIl0sWzQsMiwiXFxPbWVnYSJdLFswLDAsIlxcb3ZlcmxpbmV7XFxBYmFyfSJdLFswLDEsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMSwyLCJcXGNoaV97QX0iLDJdLFsyLDMsImoiLDJdLFs0LDMsInQiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzAsNF0sWzMsNSwiaiIsMl0sWzIsNSwiaiIsMix7ImN1cnZlIjozfV0sWzYsMSwiIiwyLHsiY3VydmUiOjIsInN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbNCw1LCJ0IiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFs2LDQsIiIsMCx7ImN1cnZlIjotMn1dLFs2LDAsIlxcaXNvIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV1d
    \begin{tikzcd}
      {\overline{\Abar}} \\
      & \Abar && 1 \\
      & B & \Omega & \Omega & \Omega
      \arrow[tail, from=2-2, to=3-2]
      \arrow["{\chi_{A}}"', from=3-2, to=3-3]
      \arrow["j"', from=3-3, to=3-4]
      \arrow["t", tail, from=2-4, to=3-4]
      \arrow[from=2-2, to=2-4]
      \arrow["j"', from=3-4, to=3-5]
      \arrow["j"', curve={height=18pt}, from=3-3, to=3-5]
      \arrow[curve={height=12pt}, tail, from=1-1, to=3-2]
      \arrow["t", tail, from=2-4, to=3-5]
      \arrow[curve={height=-12pt}, from=1-1, to=2-4]
      \arrow["\iso"{marking, allow upside down}, draw=none, from=1-1, to=2-2]
    \end{tikzcd}\and
    % https://q.uiver.app/#q=WzAsNixbMSwxLCJcXG92ZXJsaW5le0EgXFxjYXAgQn0iXSxbMSwyLCJDIl0sWzMsMiwiXFxPbWVnYSJdLFszLDEsIjEiXSxbMCwwLCJcXEFiYXIgXFxjYXAgXFxCYmFyIl0sWzAsMiwiQyJdLFswLDEsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMCwzXSxbMywyLCJ0IiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFsxLDIsImpcXHdlZGdlKFxcY2hpX3tBfSxcXGNoaV97Qn0pIl0sWzQsNSwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFs0LDMsIiIsMix7ImN1cnZlIjotMX1dLFs1LDIsIlxcd2VkZ2UoalxcY2hpX3tBfSxqXFxjaGlfe0J9KSIsMix7ImN1cnZlIjoyfV0sWzQsMCwiXFxpc28iLDMseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMSw1LCIiLDMseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dXQ==
    \begin{tikzcd}
      {\Abar \cap \Bbar} \\
      & {\overline{A \cap B}} && 1 \\
      C & C && \Omega
      \arrow[tail, from=2-2, to=3-2]
      \arrow[from=2-2, to=2-4]
      \arrow["t", tail, from=2-4, to=3-4]
      \arrow["{j\wedge(\chi_{A},\chi_{B})}", from=3-2, to=3-4]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[curve={height=-6pt}, from=1-1, to=2-4]
      \arrow["{\wedge(j\chi_{A},j\chi_{B})}"', curve={height=12pt}, from=3-1, to=3-4]
      \arrow["\iso"{marking, allow upside down}, draw=none, from=1-1, to=2-2]
      \arrow[Rightarrow, no head, from=3-2, to=3-1]
    \end{tikzcd}
  \end{mathpar}
  Conversely, if $j$ induces a closure operation with the above properties, then the diagrams above show that $j$ must be a topology.
\end{proof}

\begin{defn}
  Let $\cE$ be a topos equipped with a topology.
  We say that a subobject $A$ of $B$ is \emph{dense} in $B$ if $\Abar = B$ and that it is \emph{closed} when $\Abar = A$.
\end{defn}

\begin{defn}
  Let $\cE$ be a topos equipped with a topology $j$.
  A \emph{$j$-sheaf} is an object $F$ so that for every dense monomorphism $m : A \mono B$ and any morphism $f' : A \to F$, $m$ factors through $f'$ uniquely.
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJBIl0sWzAsMiwiQiJdLFsyLDAsIkMiXSxbMCwxLCJtIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFswLDIsImYiXSxbMSwyLCIiLDIseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XV0=
  \[\begin{tikzcd}
      A && F \\
      \\
      B
      \arrow["m"', tail, from=1-1, to=3-1]
      \arrow["f'", from=1-1, to=1-3]
      \arrow[dashed, from=3-1, to=1-3]
    \end{tikzcd}\]
  An object is $j$-separated if $m$ factors through $f'$ in at most one way.
  The category $\Sh_{j}(\cE)$ is the full subcategory of $\cE$ spanned by $j$-sheaves.
\end{defn}

\begin{rmk}
  Clearly, $\Sh_{j}(\cE)$ is the orthogonal class $\cM^{\bot}$, where $\cM$ is the class of all dense monomorphisms.
  When $\cE$ is a locally presentable category and $\cM$ is small, $\Sh_{j}(\cE)$ is reflective in $\cE$.
  In fact, $\Sh_{j}(\cE)$ is lex reflective because $\cM$ is stable under pullbacks.
\end{rmk}

\todo{These theorems are proved for more general categories in Elephant A.}

Now we record some facts about topos equipped with a topology.

\begin{lem}\label{lem:dense-bijection-closed-subobjects}
  Let $\cE$ be a topos equipped with a topology $j$.
  If $m : A \mono B$ is dense, then there is a bijection between closed subobjects of $A$ and those of $B$.
\end{lem}
\begin{proof}
  Let $B'$ be a closed subobject of $B$, then $m^{*}(B')$ is a subobject of $A$ and moreover $\overline{m^{*}(B')} = m^{*}(\overline{B'}) = m^{*}(B')$.
  Conversely, let $A'$ be a closed subobject of $A$.
  Then $\overline{A'} \subseteq \Abar = B$, and clearly $\Abar$ is closed.
  Since dense monomorphisms are pullback stable, the projection $m^{*}(C) \mono C$ is dense for any closed subobject $C$ of $B$.
  Thus, we have
  \begin{mathpar}
    m^{*}(\overline{A'}) = \overline{m^{*}(\overline{A'})} = \overline{A'} = A'\and
    \overline{m^{*}(B')} = B'
  \end{mathpar}
  This proves that the two mappings form a bijection.
\end{proof}

\begin{lem}\label{lem:category-of-sheaves-exponential-ideal}
  Let $\cE$ be a topos equipped with a topology $j$.
  $\Sh_{j}(\cE)$ is an exponential ideal in $\cE$.
\end{lem}
\begin{proof}
  Let $B$ be a $j$-sheaf and $A$ be an object in $\cE$.
  For any dense monomorphism $m : C' \to C$, the morphism $\id_{A} \times m : A \times C' \mono A \times C$ is dense because it is a pullback.
  Then for any $f' : C' \to B^{A}$, there is a unique $A \times C \to B$ whose transpose uniquely factors $m$ through $f'$.
  % https://q.uiver.app/#q=WzAsNixbNCwwLCJBIFxcdGltZXMgQyciXSxbNCwyLCJBIFxcdGltZXMgQyJdLFs2LDAsIkIiXSxbMiwwLCJCXntBfSJdLFswLDAsIkMnIl0sWzAsMiwiQyJdLFswLDEsIlxcaWRfe0F9IFxcdGltZXMgbSIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMCwyLCJcXGhhdHtmJ30iXSxbMSwyLCIiLDIseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbNCw1LCJtIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFs0LDMsImYnIl0sWzUsMywiIiwyLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
  \[\begin{tikzcd}
      {C'} && {B^{A}} && {A \times C'} && B \\
      \\
      C &&&& {A \times C}
      \arrow["{\id_{A} \times m}"', tail, from=1-5, to=3-5]
      \arrow["{f'^{\dagger}}", from=1-5, to=1-7]
      \arrow[dashed, from=3-5, to=1-7]
      \arrow["m"', tail, from=1-1, to=3-1]
      \arrow["{f'}", from=1-1, to=1-3]
      \arrow[dashed, from=3-1, to=1-3]
    \end{tikzcd}\]
  Thus, $B^{A}$ is a $j$-sheaf.
\end{proof}

\begin{lem}\label{lem:closed-object-classifier-a-sheaf}
  In a topos $\cE$ equipped with a topology $j$, let $\Omega_{j}$ be the equalizer of $\id_{\Omega}$ and $j$.
  $\Omega_{j}$ is a $j$-sheaf.
\end{lem}
\begin{proof}
  Let $m : A \mono B$ be any dense monomorphism and $f' : A \to \Omega_{j}$ be any morphism.
  $f'$ corresponds to a closed subobject $A'$ of $A$ given by the composite $kf'$.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXE9tZWdhX3tqfSJdLFswLDEsIkEiXSxbMSwwLCJcXE9tZWdhIl0sWzIsMCwiXFxPbWVnYSJdLFsxLDAsImYnIl0sWzAsMiwiayIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMiwzLCIiLDAseyJvZmZzZXQiOi0xfV0sWzIsMywiIiwwLHsib2Zmc2V0IjoxfV0sWzEsMiwiXFxjaGlfe0EnfSIsMl1d
  \[\begin{tikzcd}
      {\Omega_{j}} & \Omega & \Omega \\
      A
      \arrow["{f'}", from=2-1, to=1-1]
      \arrow["k", tail, from=1-1, to=1-2]
      \arrow[shift left, from=1-2, to=1-3]
      \arrow[shift right, from=1-2, to=1-3]
      \arrow["{\chi_{A'}}"', from=2-1, to=1-2]
    \end{tikzcd}\]
  The subobject $A'$ is a subobject in $B$ by the composite $mA'$.
  By \cref{lem:dense-bijection-closed-subobjects}, there is a unique closed subobject $B'$ whose pullback along $m$ is isomorphic to $A'$.
  By the universal property of equalizers, there is a unique morphism $B \to \Omega_{j}$ so that the following diagram commutes.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXE9tZWdhX3tqfSJdLFswLDEsIkIiXSxbMSwwLCJcXE9tZWdhIl0sWzIsMCwiXFxPbWVnYSJdLFsxLDAsInUiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMCwyLCJrIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFsyLDMsIiIsMCx7Im9mZnNldCI6LTF9XSxbMiwzLCIiLDAseyJvZmZzZXQiOjF9XSxbMSwyLCJcXGNoaV97Qid9IiwyXV0=
  \[\begin{tikzcd}
      {\Omega_{j}} & \Omega & \Omega \\
      B
      \arrow["u", dashed, from=2-1, to=1-1]
      \arrow["k", tail, from=1-1, to=1-2]
      \arrow[shift left, from=1-2, to=1-3]
      \arrow[shift right, from=1-2, to=1-3]
      \arrow["{\chi_{B'}}"', from=2-1, to=1-2]
    \end{tikzcd}\]
  To show that $um = f'$, it suffices to show $kum = kf'$, which is equivalent to showing $\chi_{B'}m = \chi_{A'}$.
  Since $A' \iso B'$ by construction, the desired equality follows at once.
  % https://q.uiver.app/#q=WzAsNixbMCwwLCJBJyJdLFsyLDAsIkInIl0sWzAsMiwiQSJdLFsyLDIsIkIiXSxbNCwyLCJcXE9tZWdhIl0sWzQsMCwiMSJdLFsyLDMsIm0iLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzAsMiwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFsxLDMsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMCwxLCJcXGlzbyIsMyx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFswLDMsIiIsMyx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dLFs1LDQsIiIsMyx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMSw1XSxbMyw0LCJcXGNoaV97Qid9IiwyXSxbMiw0LCJcXGNoaV97QSd9IiwyLHsiY3VydmUiOjN9XV0=
  \[\begin{tikzcd}
      {A'} && {B'} && 1 \\
      \\
      A && B && \Omega
      \arrow["m"', tail, from=3-1, to=3-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[tail, from=1-3, to=3-3]
      \arrow["\iso"{marking, allow upside down}, draw=none, from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
      \arrow[tail, from=1-5, to=3-5]
      \arrow[from=1-3, to=1-5]
      \arrow["{\chi_{B'}}"', from=3-3, to=3-5]
      \arrow["{\chi_{A'}}"', curve={height=18pt}, from=3-1, to=3-5]
    \end{tikzcd}\]
\end{proof}

\begin{cor}\label{cor:power-j-objects-sheaves}
  Let $\cE$ be a topos equipped with a topology $j$.
  For any object $A \in \cE$, the exponential $\Omega_{j}^{A}$ is a $j$-sheaf.
\end{cor}
\begin{proof}
  By \cref{lem:category-of-sheaves-exponential-ideal} and \cref{lem:closed-object-classifier-a-sheaf}.
\end{proof}

\begin{lem}
  For any object $B$ in a topos $\cE$, $B$ is separated iff the diagonal $\Delta : B \mono B \times B$ is closed.
\end{lem}
\begin{proof}
  Assume that $B$ is separated.
  Consider the comparison monomorphism $B \mono \Bbar$, which is clearly dense.
  Now, consider the following commutative diagram.
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJCIl0sWzIsMCwiQiJdLFswLDIsIlxcQmJhciJdLFswLDIsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMCwxLCJcXHBpX3sxfVxcRGVsdGEgPSBcXHBpX3syfVxcRGVsdGEiXSxbMiwxLCJcXHBpX3syfVxcb3ZlcmxpbmV7XFxEZWx0YX0iLDIseyJjdXJ2ZSI6MX1dLFsyLDEsIlxccGlfezF9XFxvdmVybGluZXtcXERlbHRhfSIsMCx7ImN1cnZlIjotMX1dXQ==
  \[\begin{tikzcd}
      B && B \\
      \\
      \Bbar
      \arrow[tail, from=1-1, to=3-1]
      \arrow["{\pi_{1}\Delta = \pi_{2}\Delta}", from=1-1, to=1-3]
      \arrow["{\pi_{2}\overline{\Delta}}"', curve={height=6pt}, from=3-1, to=1-3]
      \arrow["{\pi_{1}\overline{\Delta}}", curve={height=-6pt}, from=3-1, to=1-3]
    \end{tikzcd}\]
  Since $B$ is separated, $\pi_{1}\overline{\Delta} = \pi_{2}\overline{\Delta}$.
  Since $\Delta$ is the equalizer of the projections, we have
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJCIl0sWzIsMCwiQiBcXHRpbWVzIEIiXSxbNCwwLCJCIl0sWzAsMiwiXFxCYmFyIl0sWzEsMiwiXFxwaV97MX0iLDAseyJvZmZzZXQiOi0xfV0sWzEsMiwiXFxwaV97Mn0iLDIseyJvZmZzZXQiOjF9XSxbMCwxLCJcXERlbHRhIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFszLDEsIlxcb3ZlcmxpbmV7XFxEZWx0YX0iLDIseyJjdXJ2ZSI6Miwic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFswLDMsIiIsMix7ImN1cnZlIjoyLCJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzMsMCwiIiwxLHsiY3VydmUiOjIsInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==
  \[\begin{tikzcd}
      B && {B \times B} && B \\
      \\
      \Bbar
      \arrow["{\pi_{1}}", shift left, from=1-3, to=1-5]
      \arrow["{\pi_{2}}"', shift right, from=1-3, to=1-5]
      \arrow["\Delta", tail, from=1-1, to=1-3]
      \arrow["{\overline{\Delta}}"', curve={height=12pt}, tail, from=3-1, to=1-3]
      \arrow[curve={height=12pt}, tail, from=1-1, to=3-1]
      \arrow[curve={height=12pt}, dashed, from=3-1, to=1-1]
    \end{tikzcd}\]
  In fact, this yields an isomorphism $B \iso \Bbar$.

  Conversely, suppose that $\Delta : B \mono B \times B$ is closed.
  Then this relation is classified by $\delta_{B} : B \times B \to \Omega_{j}$ whose name is $\Set{}_{j} : B \to \Omega_{j}^{B}$.
  Note that $\Set{}_{j}$ is a monomorphism.
  By \cref{cor:power-j-objects-sheaves}, $\Omega_{j}^{B}$ is a $j$-sheaf (and therefore separated), so $B$ is separated because it is a subobject of a separated object.
\end{proof}

\begin{thm}
  Let $\cE$ be a topos equipped with a topology $j$.
  $\Sh_{j}(\cE)$ is reflective in $\cE$.
\end{thm}
\begin{proof}
  The inclusion functor $\Sh_{j}(\cE) \into \cE$ is fully faithful by construction.
  Thus, it suffices to construct the required left adjoint $L : \cE \to \Sh_{j}(\cE)$.
  Let $B$ be any object of $\cE$.
  Consider the diagonal morphism $\Delta : B \mono B \times B$.
  As the first approximation, take the closure of this subobject $\overline{\Delta} : \Bbar \mono B \times B$, which is named by the morphism $d : B \to \Omega_{j}^{B}$.
  Note that $d$ can be factorized as follows.
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJCIl0sWzIsMCwiXFxPbWVnYV97an1ee0J9Il0sWzEsMSwiTUIiXSxbMCwxLCJkIl0sWzAsMiwiIiwyLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoiZXBpIn19fV0sWzIsMSwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dXQ==
  \[\begin{tikzcd}
      B && {\Omega_{j}^{B}} \\
      & MB
      \arrow["d", from=1-1, to=1-3]
      \arrow[two heads, from=1-1, to=2-2]
      \arrow[tail, from=2-2, to=1-3]
    \end{tikzcd}\]
  Here, $MB$ is the coequalizer of the kernel pair of $d$.
  Note that $(\pi_{1}\overline{\Delta}, \pi_{2}\overline{\Delta})$ is such a kernel pair.
  Since $MB$ is a subobject of a separated object, it is separated itself.
  In fact, $MB$ is the reflection of $B$ in the full subcategory of separated objects since any morphism from $B$ into a separated object $C$ coequalizes $\pi_{1}\overline{\Delta}$ and $\pi_{2}\overline{\Delta}$.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXEJiYXIiXSxbMiwwLCJCIl0sWzQsMCwiTUIiXSxbNCwyLCJDIl0sWzAsMSwiIiwyLHsib2Zmc2V0IjotMX1dLFswLDEsIiIsMCx7Im9mZnNldCI6MX1dLFsxLDIsIlxcZXRhX3tCfSciLDAseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJlcGkifX19XSxbMSwzXSxbMiwzLCIiLDEseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XV0=
  \[\begin{tikzcd}
      \Bbar && B && MB \\
      \\
      &&&& C
      \arrow[shift left, from=1-1, to=1-3]
      \arrow[shift right, from=1-1, to=1-3]
      \arrow["{\eta_{B}'}", two heads, from=1-3, to=1-5]
      \arrow[from=1-3, to=3-5]
      \arrow[dashed, from=1-5, to=3-5]
    \end{tikzcd}\]
  This establishes the universality of the unit.
  To obtain a sheaf, we take the closure of the subobject $MB \mono \Omega_{j}^{B}$.
  We claim that the composite of the coequalizer and the dense monomorphism $MB \mono LB$ is the required universal morphism.
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJCIl0sWzEsMCwiTUIiXSxbMiwwLCJMQiJdLFswLDEsIiIsMCx7InN0eWxlIjp7ImhlYWQiOnsibmFtZSI6ImVwaSJ9fX1dLFsxLDIsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XV0=
  \[\begin{tikzcd}
      B & MB & LB
      \arrow[two heads, from=1-1, to=1-2]
      \arrow[tail, from=1-2, to=1-3]
    \end{tikzcd}\]
  Indeed, for any $j$-sheaf $C$ and any morphism $f : B \to C$, the coequalizer $B \epi MB$ factors through $f$ uniquely.
  Since $C$ is a sheaf, the dense monomorphism $MB \mono LB$ factors through $MB \to C$ uniquely.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJCIl0sWzEsMCwiTUIiXSxbMiwwLCJMQiJdLFsxLDEsIkMiXSxbMCwxLCIiLDAseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJlcGkifX19XSxbMSwyLCIiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzAsM10sWzEsMywiIiwyLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzIsMywiIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
  \[\begin{tikzcd}
      B & MB & LB \\
      & C
      \arrow[two heads, from=1-1, to=1-2]
      \arrow[tail, from=1-2, to=1-3]
      \arrow[from=1-1, to=2-2]
      \arrow[dashed, from=1-2, to=2-2]
      \arrow[dashed, from=1-3, to=2-2]
    \end{tikzcd}\]
  This proves that $LB$ is the reflection of $B$ in $\Sh_{j}(\cE)$.
\end{proof}

\begin{thm}
  Let $\cE$ be a topos equipped with a topology $j$.
  $\Sh_{j}(\cE)$ is a topos.
\end{thm}
\begin{proof}
  \todo{}
\end{proof}

\begin{lem}\label{lem:reflector-finite-product-preserving-exponential-ideal}
  Let $\cE$ be a topos and $\cL$ be a reflective subcategory of $\cE$.
  Then the reflector $L$ preserves finite products iff $\cL$ is an exponential ideal in $\cE$.
\end{lem}
\begin{proof}
  \todo{}
\end{proof}

\begin{thm}
  Let $\cE$ be a topos equipped with a topology $j$.
  The sheafification functor $L : \cE \to \Sh_{j}(\cE)$ preserves finite limits.
\end{thm}
\begin{proof}
  First, observe that $\Sh_{j}(\cE)$ is an exponential ideal in $\cE$.
  By \cref{lem:reflector-finite-product-preserving-exponential-ideal}, $L$ preserves finite products.
  It suffices to show that $L$ preserves binary intersections of subobjects. \todo{Justify this.}
  To this end, we show that $L$ preserves monomorphisms, which makes use of the following facts.
  \begin{enumerate}
  \item Every injective in $\Sh_{j}(\cE)$ is injective in $\cE$.
  \item A morphism $m : A \to B$ in a topos is monic iff every morphism from $A$ to an injective factors through $m$.
  \end{enumerate}
  For any monomorphism $A \mono B$ and any injective sheaf $I$, we have the following diagram.
  % https://q.uiver.app/#q=WzAsNSxbMCwwLCJBIl0sWzIsMCwiQiJdLFswLDIsIkxBIl0sWzIsMiwiTEIiXSxbMSwzLCJJIl0sWzAsMSwiaCIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMCwyLCJcXGV0YV97QX0iLDJdLFsxLDMsIlxcZXRhX3tCfSJdLFsyLDMsIkxoIl0sWzIsNCwiZiIsMl0sWzMsNCwiZyIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFswLDRdLFsxLDRdXQ==
  \[\begin{tikzcd}
      A && B \\
      \\
      LA && LB \\
      & I
      \arrow["h", tail, from=1-1, to=1-3]
      \arrow["{\eta_{A}}"', from=1-1, to=3-1]
      \arrow["{\eta_{B}}", from=1-3, to=3-3]
      \arrow["Lh", from=3-1, to=3-3]
      \arrow["f"', from=3-1, to=4-2]
      \arrow["g", dashed, from=3-3, to=4-2]
      \arrow[from=1-1, to=4-2]
      \arrow[from=1-3, to=4-2]
    \end{tikzcd}\]
  Universality of $\eta_{A}$ demands that $f$ factors $g$ through $Lh$.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJBIl0sWzIsMCwiTEEiXSxbMiwyLCJJIl0sWzMsMSwiTEIiXSxbMCwxLCJcXGV0YV97QX0iXSxbMCwyLCJmXFxldGFfe0F9IiwyXSxbMSwyLCJmIiwyLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzEsMywiTGgiXSxbMywyLCJnIl0sWzYsMywiIiwyLHsic2hvcnRlbiI6eyJzb3VyY2UiOjIwfSwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dXQ==
  \[\begin{tikzcd}
      A && LA \\
      &&& LB \\
      && I
      \arrow["{\eta_{A}}", from=1-1, to=1-3]
      \arrow["{f\eta_{A}}"', from=1-1, to=3-3]
      \arrow[""{name=0, anchor=center, inner sep=0}, "f"', dashed, from=1-3, to=3-3]
      \arrow["Lh", from=1-3, to=2-4]
      \arrow["g", from=2-4, to=3-3]
      \arrow[shorten <=5pt, Rightarrow, no head, from=0, to=2-4]
    \end{tikzcd}\]
  Thus, $Lh$ is a monomorphism.
  Now, consider the following pushout in $\cE$.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJBIFxcY2FwIEIiXSxbMCwyLCJBIl0sWzIsMCwiQiJdLFsyLDIsIkEgXFxjdXAgQiJdLFswLDEsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMiwzLCIiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzAsMiwiIiwxLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFsxLDMsIiIsMSx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMywwLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=
  \[\begin{tikzcd}
      {A \cap B} && B \\
      \\
      A && {A \cup B}
      \arrow[tail, from=1-1, to=3-1]
      \arrow[tail, from=1-3, to=3-3]
      \arrow[tail, from=1-1, to=1-3]
      \arrow[tail, from=3-1, to=3-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125, rotate=180}, draw=none, from=3-3, to=1-1]
    \end{tikzcd}\]
  $L$ as a left adjoint preserves colimits and additionally it preserves monomorphisms so we have the following pushout in $\Sh_{j}(\cE)$.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJMKEEgXFxjYXAgQikiXSxbMCwyLCJMQSJdLFsyLDAsIkxCIl0sWzIsMiwiTChBIFxcY3VwIEIpIl0sWzAsMSwiIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFsyLDMsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMCwyLCIiLDEseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzEsMywiIiwxLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFszLDAsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
  \[\begin{tikzcd}
      {L(A \cap B)} && LB \\
      \\
      LA && {L(A \cup B)}
      \arrow[tail, from=1-1, to=3-1]
      \arrow[tail, from=1-3, to=3-3]
      \arrow[tail, from=1-1, to=1-3]
      \arrow[tail, from=3-1, to=3-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125, rotate=180}, draw=none, from=3-3, to=1-1]
    \end{tikzcd}\]
  But this pushout is also a pullback, so $L(A \cap B) \iso LA \cap LB$.
\end{proof}

\section{Classifying topoi}
\label{sec:classifying-topoi}

\todo{Elephant B4.2.}
\paragraph{Achtung.} In this section, topos means Grothendieck topos.
\paragraph{Achtung.} I don't have a coherent story for this section yet.

A geometric theory is a doctrine $T : \iC\op \to \CFrm$.
For each $\Gamma \in \iC$, $T(\Gamma)$ is a frame of formulas in the given context $\Gamma$, and $\varphi \leq \psi \in T(\Gamma)$ means $\varphi \vdash_{\Gamma} \psi$.
$T$ needs to satisfy additional conditions so that quantifiers can be interpreted in the expected way.

A model of $T$ in a topos $\cE$ consists of a lex functor $M : \iC \to \cE$ and a natural transformation $\alpha$.
% https://q.uiver.app/#q=WzAsMyxbMSwxLCJcXENGcm0iXSxbMCwwLCJcXGlDXFxvcCJdLFsyLDAsIlxcY0VcXG9wIl0sWzIsMCwiUCJdLFsxLDAsIlQiLDJdLFsxLDIsIk0iXSxbNCwyLCJcXGFscGhhIiwyLHsic2hvcnRlbiI6eyJzb3VyY2UiOjEwLCJ0YXJnZXQiOjEwfX1dXQ==
\[\begin{tikzcd}
    \iC\op && \cE\op \\
    & \CFrm
    \arrow["P", from=1-3, to=2-2]
    \arrow[""{name=0, anchor=center, inner sep=0}, "T"', from=1-1, to=2-2]
    \arrow["M", from=1-1, to=1-3]
    \arrow["\alpha"', shorten <=5pt, shorten >=5pt, Rightarrow, from=0, to=1-3]
  \end{tikzcd}\]
The subobject classifier of $\cE$ needs to be an internal frame so that the powerobject functor $P : \cE\op \to \cE$ can be lifted.

We want a topos $\iC[T]$ and a universal model $(M_{U},\alpha_{U})$ such that every $T$-model in a topos $\cE$ can be identified with a geometric morphism $\cE \to \iC[T]$.
% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXGlDXFxvcCJdLFs0LDAsIlxcY0VcXG9wIl0sWzIsMSwiXFxpQ1tUXVxcb3AiXSxbMiwzLCJcXENGcm0iXSxbMCwxLCJNIiwwLHsiY3VydmUiOi0xfV0sWzAsMiwiTV97VX0iLDIseyJjdXJ2ZSI6MX1dLFsyLDEsImZeeyp9IiwyLHsiY3VydmUiOjF9XSxbMCwzLCJUIiwyLHsiY3VydmUiOjJ9XSxbMiwzLCJQIiwyXSxbMSwzLCJQX3tcXGNFfSIsMCx7ImN1cnZlIjotMn1dLFs0LDIsIlxcaXNvIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzgsOSwiXFxhbHBoYSIsMix7Im9mZnNldCI6LTQsInNob3J0ZW4iOnsic291cmNlIjoyMCwidGFyZ2V0IjoyMH19XSxbNywyLCJcXGFscGhhX3tVfSIsMix7InNob3J0ZW4iOnsic291cmNlIjoxMCwidGFyZ2V0IjoxMH19XV0=
\[\begin{tikzcd}
    \iC\op &&&& \cE\op \\
    && {\iC[T]\op} \\
    \\
    && \CFrm
    \arrow[""{name=0, anchor=center, inner sep=0}, "M", curve={height=-6pt}, from=1-1, to=1-5]
    \arrow["{M_{U}}"', curve={height=6pt}, from=1-1, to=2-3]
    \arrow["{f^{*}}"', curve={height=6pt}, from=2-3, to=1-5]
    \arrow[""{name=1, anchor=center, inner sep=0}, "T"', curve={height=12pt}, from=1-1, to=4-3]
    \arrow[""{name=2, anchor=center, inner sep=0}, "P"', from=2-3, to=4-3]
    \arrow[""{name=3, anchor=center, inner sep=0}, "{P_{\cE}}", curve={height=-12pt}, from=1-5, to=4-3]
    \arrow["\iso"{marking, allow upside down}, draw=none, from=0, to=2-3]
    \arrow["\alpha"', shift left=4, shorten <=10pt, shorten >=10pt, Rightarrow, from=2, to=3]
    \arrow["{\alpha_{U}}"', shorten <=3pt, shorten >=3pt, Rightarrow, from=1, to=2-3]
  \end{tikzcd}\]

\section{Locales}
\label{sec:locales}

\begin{defn}
  A \emph{frame} is a lattice with arbitrary joins and finite meets satisfying the infinitary distributive law.
  A \emph{frame homomorphism} is an order-preserving function that preserves infinite joins and finite meets.
\end{defn}

\begin{defn}
  The category of locales $\CLoc$ is the opposite of the category of frames $\CFrm$.
\end{defn}

\bibliographystyle{alpha}
\bibliography{all}

\end{document}
