\documentclass[article,10pt,oneside]{memoir}
\input{preambles}
\title{categorical logic}
\author{Frank Tsai}
\date{\today}
%\thanks{}
\begin{document}
\maketitle
\tableofcontents

\section{Introduction}
\label{sec:introduction}

Category theory has enabled us to investigate algebraic theories in a presentation-invariant way.
Algebraic theories are precisely categories with finite products.
We think of the objects of such a category as sorts and morphisms as terms.
Equations are internalized as the diagonal subobjects.
Given two algebraic theories $\cT$ and $\cT'$, a model of $\cT$ in $\cT'$ is a finite-product preserving functor $M : \cT \to \cT'$, ensuring that products of sorts in $\cT$ are interpreted (sensibly) as products of sorts in $\cT'$.
Additionally, this also ensures that equations are preserved.
Unsurprisingly, a homomorphism from $M$ to $M'$ is precisely a natural transformation $\alpha : M \To M'$.
% https://q.uiver.app/#q=WzAsNCxbMiwwLCJNcyJdLFswLDIsIk1zIl0sWzIsMiwiTShzIFxcdGltZXMgcykiXSxbNCwyLCJNKHMpIl0sWzIsMSwiXFxwaV97MX0iXSxbMiwzLCJcXHBpX3syfSIsMl0sWzAsMSwiXFxpZCIsMl0sWzAsMywiXFxpZCJdLFswLDIsIk1cXERlbHRhIiwxLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9LCJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XV0=
\[\begin{tikzcd}
    && Ms \\
    \\
    Ms && {M(s \times s)} && {Ms}
    \arrow["{\pi_{1}}", from=3-3, to=3-1]
    \arrow["{\pi_{2}}"', from=3-3, to=3-5]
    \arrow["\id"', from=1-3, to=3-1]
    \arrow["\id", from=1-3, to=3-5]
    \arrow["M\Delta"{description}, dashed, tail, from=1-3, to=3-3]
  \end{tikzcd}\]

Algebraic theories together with their models and homomorphisms between them assemble into a 2-category $\CAlg$.
For any (small) algebraic theory $\cT$, the hom-category $\CAlg(\cT,\CSet)$, i.e., the category of set-theoretic models, is equivalent to a cocomplete category with a strong generator comprised of perfectly presentable objects, i.e., a variety.
We can generalize this viewpoint: theories (of some kind) are categories with sufficient structures.
A model of a theory in another theory (of the same kind) is a functor preserving those structures.
The goal of this writeup is to develop this idea in more detail.

\section{Yoneda and cantor}
\label{sec:yoneda-and-cantor}

\begin{cons}[Archetypal Grothendieck construction]\label{cons:archetypal-grothendieck-construction}
  Let $X$ be a set.
  There is a bijection between the powerset $P(X)$ and the set of all truth functionals over $X$.
  \[
    \Theta : P(X) \otto 2^{X} : \Psi
  \]
  \begin{itemize}
  \item[$\Theta$:] For each subset $S \subseteq X$, $\Theta(S)$ is the characteristic function of $X$, mapping elements in $S$ to $1$ and everything else to $0$.
  \item[$\Psi$:] For each truth functional $\phi : X \to 2$, $\Psi(\phi)$ is the inverse image $\phi\inv(1)$.
  \end{itemize}
\end{cons}

\begin{rmk}
  The map $\Psi$ in \cref{cons:archetypal-grothendieck-construction} can be described as a pullback.
  % https://q.uiver.app/#q=WzAsNCxbMiwwLCIxIl0sWzIsMiwiMiJdLFswLDIsIlgiXSxbMCwwLCJcXHZhcnBoaVxcaW52KDEpIl0sWzAsMSwidCIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMiwxLCJcXHZhcnBoaSIsMl0sWzMsMiwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFszLDBdLFszLDEsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
  \[\begin{tikzcd}
      {\varphi\inv(1)} && 1 \\
      \\
      X && 2
      \arrow["t", tail, from=1-3, to=3-3]
      \arrow["\varphi"', from=3-1, to=3-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
  Indeed, $\varphi\inv(1)$ is the largest (w.r.t. inclusion) subset of $X$ so that $\varphi$ evaluates to $1$ everywhere.
\end{rmk}

\begin{rmk}
  In $\CSet$, we make the foundational commitment that $\CSet(A, B)$ is a set and that the powerset $P(A)$ is in fact a set.
  As it turns out, assuming either one is sufficient to construct the other.
\end{rmk}

\begin{rmk}
  The set $P(X)$ has a canonical poset structure given by the set inclusion relation.
  In fact, $P(X)$ equipped with set inclusion is a complete Boolean algebra.
  Thus, the powerset functor $P : \CSet\op \to \CSet$ may be equally regarded as a functor $P : \CSet\op \to \CPos$, sending each set to its powerset ordered by inclusion.
\end{rmk}

\begin{rmk}
  The two point set has a unique nontrivial poset structure $\Set{0 \leq 1}$.
  We can define a poset structure on truth functionals by transporting the poset structure defined on the powersets along the Grothendieck construction.
  \[
    \chi_{X} \leq \chi_{Y} \text{ iff } X \subseteq Y
  \]
  This is the usual pointwise poset structure.
\end{rmk}

We can classify subsets of a given set $X$.
We can classify $X$-indexed families (i.e., functions $f : Y \to X$), too.
These families assemble into the slice construction $\CSet/X$.

\begin{cons}[Discrete Grothendieck construction]
  Let $X$ be a set construed as a discrete category.
  There is an equivalence of categories.
  \[
    \Theta : \CSet/X \otto \CSet^{X} : \Psi
  \]
  \begin{itemize}
  \item[$\Theta$:] For each function $f : Y \to X$, $\Theta(f)$ is the functor that sends each $x \in X$ to the inverse image $f\inv(x)$.
  \item[$\Psi$:] For each functor $\varphi : X \to \CSet$, $\Psi(\varphi)$ is the canonical map $\coprod_{x \in X}\varphi(x) \to X$
  \end{itemize}
\end{cons}

\begin{rmk}
  Indeed, $\Psi$ can be phrased in terms of pullback.
  % https://q.uiver.app/#q=WzAsNCxbMiwwLCJcXENTZXRfeyp9Il0sWzIsMiwiXFxDU2V0Il0sWzAsMiwiWCJdLFswLDAsIlxcY29wcm9kX3t4IFxcaW4gWH1cXHZhcnBoaSh4KSJdLFswLDFdLFsyLDEsIlxcdmFycGhpIiwyXSxbMywyXSxbMywwXSxbMywxLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=
  \[\begin{tikzcd}
      {\coprod_{x \in X}\varphi(x)} && {\CSet_{*}} \\
      \\
      X && \CSet
      \arrow[from=1-3, to=3-3]
      \arrow["\varphi"', from=3-1, to=3-3]
      \arrow[from=1-1, to=3-1]
      \arrow[from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
  $\coprod_{x \in X}\varphi(x) \to X$ is the ``largest'' family so that $\varphi$ produces a witness everywhere.
\end{rmk}

\section{Hyperdoctrine}
\label{sec:hyperdoctrine}

The internal logic of a Heyting (or Boolean) algebra is intuitionistic (or classical) propositional logic.
Each sort of a given theory is equipped with a poset of propositions, in which $\varphi \leq \psi$ means $\varphi$ entails $\psi$.
For simplicity, let us assume a single sorted theory with no function symbols.
Let us recall Tarski's definition:
\begin{enumerate}
\item The unique sort is a set $S$.
\item A proposition variable is a subset of $S$.
\item $\top$ is the entire set $S$.
\item $\bot$ is the empty set $\varnothing$.
\item $\varphi \wedge \psi$ is the intersection $\varphi \cap \psi$.
\item $\varphi \vee \psi$ is the union $\varphi \cup \psi$.
\item $\varphi \To \psi$ is the exponential $\psi^{\varphi}$, i.e., the largest element so that $\psi^{\varphi} \wedge \varphi \leq \psi$.
\end{enumerate}

Essentially, propositions live in a poset with sufficient structure: various logical connectives correspond to various universal constructions.
As a model of a theory $\cT$ in another theory $\cT'$ has to preserve entailment, we expect it to be a function $M : \cT \to \cT'$ preserving relevant structures.

Generalizing this to multisorted theories is straightforward.
Each sort of the theory has a poset of propositions.
In the presence of nontrivial terms, we need to specify how propositions in context interact with substitutions.
For example, given a proposition in the context $d$, i.e., $\vdash_{d} \varphi$, substitution by a term $f : c \to d$ ought to produce a proposition in the context $c$, i.e., $\vdash_{c} \varphi[f]$.
Of course, we expect substitution to satisfy $\varphi[f][g] = \varphi[g \circ f]$ and $\varphi[\id] = \varphi$.

\begin{defn}
  A \emph{doctrine} is a functor $\cC : \iC\op \to \CPos$, where $\CPos$ is some suitable category of posets.
\end{defn}

\begin{defn}\label{def:model-of-doctrine}
  A \emph{model} of a doctrine $\cC : \iC\op \to \CPos$ in another doctrine $\cD : \iD\op \to \CPos$ consists of
  \begin{itemize}
  \item A model $M : \iC \to \iD$.
  \item A natural transformation $\lambda : \cC \To \cD \circ M\op$.
  \end{itemize}
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJcXGlDXFxvcCJdLFsyLDAsIlxcaURcXG9wIl0sWzEsMSwiXFxDUG9zIl0sWzAsMSwiTVxcb3AiXSxbMCwyLCJcXGNDIiwyXSxbMSwyLCJcXGNEIl0sWzQsMSwiXFxsYW1iZGEiLDEseyJzaG9ydGVuIjp7InNvdXJjZSI6MTAsInRhcmdldCI6MTB9fV1d
  \[\begin{tikzcd}
      \iC\op && \iD\op \\
      & \CPos
      \arrow["M\op", from=1-1, to=1-3]
      \arrow[""{name=0, anchor=center, inner sep=0}, "\cC"', from=1-1, to=2-2]
      \arrow["\cD", from=1-3, to=2-2]
      \arrow["\lambda"{description}, shorten <=4pt, shorten >=4pt, Rightarrow, from=0, to=1-3]
    \end{tikzcd}\]
\end{defn}

Let us unpack \cref{def:model-of-doctrine}.
The model $M : \iC \to \iD$ is unsurprising: we need to express $\iC$ in terms of $\iD$.
Each component $\lambda_{c}$ is a model of propositions $\cC(c)$ in $\cD M\op(c)$.
Naturality expresses that these models are compatible with substitutions. 
% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXGNDKGMpIl0sWzIsMCwiXFxjRCBNXFxvcChjKSJdLFswLDIsIlxcY0MoYycpIl0sWzIsMiwiXFxjRCBNXFxvcChjJykiXSxbMCwxLCJcXGxhbWJkYV97Y30iXSxbMiwwLCJcXGJsYW5rW2ZdIl0sWzMsMSwiXFxibGFua1tNXFxvcChmKV0iLDJdLFsyLDMsIlxcbGFtYmRhX3tjJ30iLDJdXQ==
\[\begin{tikzcd}
    {\cC(c)} && {\cD M\op(c)} \\
    \\
    {\cC(c')} && {\cD M\op(c')}
    \arrow["{\lambda_{c}}", from=1-1, to=1-3]
    \arrow["{\blank[f]}", from=3-1, to=1-1]
    \arrow["{\blank[M\op(f)]}"', from=3-3, to=1-3]
    \arrow["{\lambda_{c'}}"', from=3-1, to=3-3]
  \end{tikzcd}\]

Weighted quantifiers can be characterized as adjoints, too.
Given a term $f : c \to d$, the formula $\exists_{f}\varphi$ ought to be the smallest formula so that $\varphi \leq (\exists_{f}\varphi)[f]$.
Similarly, the formula $\forall_{f}\varphi$ ought to be the largest formula so that $(\forall_{f}\varphi)[f] \leq \varphi$.
That is, we need the following adjoints:
% https://q.uiver.app/#q=WzAsMixbMCwwLCJcXGNDKGMpIl0sWzAsMiwiXFxjQyhkKSJdLFsxLDAsIlxcYmxhbmtbZl0iLDFdLFswLDEsIlxcZXhpc3RzX3tmfSIsMix7ImN1cnZlIjo0fV0sWzAsMSwiXFxmb3JhbGxfe2Z9IiwwLHsiY3VydmUiOi00fV0sWzMsMiwiIiwxLHsibGV2ZWwiOjEsInN0eWxlIjp7Im5hbWUiOiJhZGp1bmN0aW9uIn19XSxbMiw0LCIiLDEseyJsZXZlbCI6MSwic3R5bGUiOnsibmFtZSI6ImFkanVuY3Rpb24ifX1dXQ==
\[\begin{tikzcd}
    {\cC(c)} \\
    \\
    {\cC(d)}
    \arrow[""{name=0, anchor=center, inner sep=0}, "{f^{*}}"{description}, from=3-1, to=1-1]
    \arrow[""{name=1, anchor=center, inner sep=0}, "{\exists_{f}}"', curve={height=24pt}, from=1-1, to=3-1]
    \arrow[""{name=2, anchor=center, inner sep=0}, "{\forall_{f}}", curve={height=-24pt}, from=1-1, to=3-1]
    \arrow["\dashv"{anchor=center}, draw=none, from=1, to=0]
    \arrow["\dashv"{anchor=center}, draw=none, from=0, to=2]
  \end{tikzcd}\]
Indeed, in the powerset doctrine $\cP : \CSet\op \to \CPos$, the existential quantifier and the universal quantifier are given by the direct image $f_{*}$ and the fiber image $f_{!}$, respectively.

The powerset doctrine factors through the contravariant powerset functor in a canonical way because every powerset has a canonical poset structure given by the inclusion relation.
% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXGlEIl0sWzIsMCwiXFxDU2V0XFxvcCJdLFsxLDIsIlxcQ1BvcyJdLFszLDIsIlxcQ1NldCJdLFswLDIsIlxcY0QiLDJdLFswLDEsIk0iXSxbMSwzLCJcXGNQIl0sWzIsM10sWzEsMiwiIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzQsMSwiXFxsYW1iZGEiLDAseyJzaG9ydGVuIjp7InNvdXJjZSI6MTAsInRhcmdldCI6MTB9fV1d
\[\begin{tikzcd}
    \iU\op && \CSet\op \\
    \\
    & \CPos && \CSet
    \arrow[""{name=0, anchor=center, inner sep=0}, "\cU"', from=1-1, to=3-2]
    \arrow["M", from=1-1, to=1-3]
    \arrow["\cP", from=1-3, to=3-4]
    \arrow[from=3-2, to=3-4]
    \arrow[dashed, from=1-3, to=3-2]
    \arrow["\lambda", shorten <=5pt, shorten >=5pt, Rightarrow, from=0, to=1-3]
  \end{tikzcd}\]
Thus, we may identify a model of a doctrine as a natural transformation (of some kind) between presheaves.
% https://q.uiver.app/#q=WzAsMyxbMCwwLCJcXGlEXFxvcCJdLFsyLDAsIlxcQ1NldFxcb3AiXSxbMiwyLCJcXENTZXQiXSxbMCwxXSxbMSwyXSxbMCwyLCJcXGNEIiwyXSxbNSwxLCJcXGxhbWJkYSIsMix7InNob3J0ZW4iOnsic291cmNlIjoxMCwidGFyZ2V0IjoxMH19XV0=
\[\begin{tikzcd}
    \iU\op && \CSet\op \\
    \\
    && \CSet
    \arrow[from=1-1, to=1-3]
    \arrow[from=1-3, to=3-3]
    \arrow[""{name=0, anchor=center, inner sep=0}, "\cU"', from=1-1, to=3-3]
    \arrow["\lambda"', shorten <=3pt, shorten >=3pt, Rightarrow, from=0, to=1-3]
  \end{tikzcd}\]
Given a natural transformation $\lambda : \cU \To \tilde{\cU}$ between presheaves, we may think of $\cU$ as a presheaf of ``witnesses'' and $\tilde{\cU}$ as a presheaf of ``types.''
By the Yoneda lemma, each type $A \in \tilde{\cU}(\Gamma)$ can be identified with a natural transformation $A : \iU(\blank, \Gamma) \To \cU$.
If we additionally require that the pullback of $A$ along $\lambda$ is representable, then the two projections correspond to a term $\Gamma.A \to \Gamma$ in the theory $\iU$ and a witness $t \in \cU(\Gamma.A)$, respectively.
% https://q.uiver.app/#q=WzAsNCxbMiwwLCJcXGNVIl0sWzIsMiwiXFx0aWxkZXtcXGNVfSJdLFswLDIsIlxceW9uXFxHYW1tYSJdLFswLDAsIlxceW9uXFxHYW1tYS5BIl0sWzAsMSwiXFxsYW1iZGEiXSxbMiwxLCJBIiwyXSxbMywyXSxbMywwLCJ0Il0sWzMsMSwiIiwxLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
\[\begin{tikzcd}
    {\yon\Gamma.A} && \cU \\
    \\
    \yon\Gamma && {\tilde{\cU}}
    \arrow["\lambda", from=1-3, to=3-3]
    \arrow["A"', from=3-1, to=3-3]
    \arrow[from=1-1, to=3-1]
    \arrow["t", from=1-1, to=1-3]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
  \end{tikzcd}\]

\section{Calculus of fractions and orthogonality}
\label{sec:calculus-of-fractions-and-orthogonality}
\todo{Ivan's notes: topics in category theory 2018}

\begin{defn}
  Let $\iC$ be a category and $\cW$ be a class of morphisms (to be inverted) of $\iC$.
  The \emph{localization of $\iC$ with respect to $\cW$} is a category $\iC[\cW\inv]$ equipped with a localization functor $L : \iC \to \iC[\cW\inv]$ such that
  \begin{itemize}
  \item $Lw$ is an isomorphism for all $w \in \cW$.
  \item $L$ is universal with respect to this property, i.e., if $F : \iC \to \iD$ is a functor that maps each$w \in \cW$ to an isomorphism, then there is a unique functor $i : \iC[\cW\inv] \to \iD$ so that $iL \iso F$.
  \end{itemize}
\end{defn}

\begin{thm}
  $\iC[\cW\inv]$ and $L$ exist for any category $\iC$ and any class of morphisms $\cW$.
\end{thm}
\begin{proof}
  Since $\cW$ are morphisms to be inverted, we formally add their inverses.
  Let $\iG$ be a graph whose vertices are objects of $\iC$ and morphisms are morphisms of $\iC$ and formal inverses of $w \in \cW$.
  Now, take the free category $F\iG$ generated the graph $\iG$.
  Explicitly, the morphisms of $F\iG$ are tuples of morphisms of $\iC \cup \cW\inv$.
  To enforce invertibility and universal property, we quotient the category $F\iG$ by the relation $\sim$ generated by the following equations
  \begin{itemize}
  \item $()_{c} = (\id_{c})$.
  \item $(g, f) = (gf)$ whenever the composition makes sense.
  \item $(w, w\inv) = ()_{\cod(w)}$.
  \item $(w\inv, w) = ()_{\dom(w)}$.
  \end{itemize}
  We take $\iC[\cW\inv] := F\iG/\sim$, and $L : \iC \to \iC[\cW\inv]$ is defined as the composite $\iC \into F\iG \epi \iC[\cW\inv]$.
  By construction, $Lw$ is an isomorphism for all $w \in \cW$.
  The universality of this construction is inherited from the universal property of the quotient category construction.
\end{proof}

\begin{defn}
  An object $c$ is \emph{orthogonal} to a morphism $m : d \to d'$ if for each morphism $f : d \to c$, there is a unique morphism $f' : d' \to c$ so that the following diagram commutes.
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJkIl0sWzIsMCwiZCciXSxbMSwxLCJjIl0sWzAsMSwibSJdLFswLDIsImYiLDJdLFsxLDIsImYnIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
  \[\begin{tikzcd}
      d && {d'} \\
      & c
      \arrow["m", from=1-1, to=1-3]
      \arrow["f"', from=1-1, to=2-2]
      \arrow["{f'}", dashed, from=1-3, to=2-2]
    \end{tikzcd}\]
  For a class $\cM$ of morphisms in a category $\iC$, we write $\cM^{\bot}$ for the full subcategory of $\iC$ spanned by objects orthogonal to each $m \in \cM$.
\end{defn}

\section{Sheaves}
\label{sec:sheaves}

\begin{defn}
  Let $X$ be a topological space.
  A \emph{sheaf} (of sets) is a presheaf $F : \cO(X)\op \to \CSet$ satisfying the \emph{sheaf condition}: For any open cover $U = \bigcup_{i}U_{i}$, the following diagram is an equalizer.
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJGKFUpIl0sWzIsMCwiXFxwcm9kX3tpfUYoVV97aX0pIl0sWzQsMCwiXFxwcm9kX3tpLGp9RihVX3tpfSBcXGNhcCBVX3tqfSkiXSxbMCwxXSxbMSwyLCJwIiwwLHsib2Zmc2V0IjotMX1dLFsxLDIsInEiLDIseyJvZmZzZXQiOjF9XV0=
  \[\begin{tikzcd}
      {F(U)} && {\prod_{i}F(U_{i})} && {\prod_{i,j}F(U_{i} \cap U_{j})}
      \arrow[from=1-1, to=1-3]
      \arrow["p", shift left, from=1-3, to=1-5]
      \arrow["q"', shift right, from=1-3, to=1-5]
    \end{tikzcd}\]
  The morphisms $p$ and $q$ are the canonical ones specified by morphisms of the form $F(U_{i} \cap U_{j} \subseteq U_{k})$ composed with an appropriate projection.
  % https://q.uiver.app/#q=WzAsNyxbMCwyLCJGKFUpIl0sWzIsMiwiXFxwcm9kX3tpfUYoVV97aX0pIl0sWzQsMiwiXFxwcm9kX3tpLGp9RihVX3tpfSBcXGNhcCBVX3tqfSkiXSxbMiwwLCJGKFVfe2l9KSJdLFsyLDQsIkYoVV97an0pIl0sWzQsMCwiRihVX3tpfSBcXGNhcCBVX3tqfSkiXSxbNCw0LCJGKFVfe2l9IFxcY2FwIFVfe2p9KSJdLFswLDFdLFsxLDIsInAiLDAseyJvZmZzZXQiOi0xfV0sWzEsMiwicSIsMix7Im9mZnNldCI6MX1dLFsxLDMsIlxccGlfe2l9Il0sWzAsMywiRihVX3tpfSBcXHN1YnNldGVxIFUpIl0sWzEsNCwiXFxwaV97an0iLDJdLFswLDQsIkYoVV97an0gXFxzdWJzZXRlcSBVKSIsMl0sWzIsNSwiXFxwaV97aSxqfSIsMl0sWzIsNiwiXFxwaV97aSxqfSJdLFszLDUsIkYoVV97aX0gXFxjYXAgVV97an0gXFxzdWJzZXRlcSBVX3tpfSkiXSxbNCw2LCJGKFVfe2l9IFxcY2FwIFVfe2p9IFxcc3Vic2V0ZXEgVV97an0pIiwyXV0=
  \[\begin{tikzcd}
      && {F(U_{i})} && {F(U_{i} \cap U_{j})} \\
      \\
      {F(U)} && {\prod_{i}F(U_{i})} && {\prod_{i,j}F(U_{i} \cap U_{j})} \\
      \\
      && {F(U_{j})} && {F(U_{i} \cap U_{j})}
      \arrow[from=3-1, to=3-3]
      \arrow["p", shift left, from=3-3, to=3-5]
      \arrow["q"', shift right, from=3-3, to=3-5]
      \arrow["{\pi_{i}}", from=3-3, to=1-3]
      \arrow["{F(U_{i} \subseteq U)}", from=3-1, to=1-3]
      \arrow["{\pi_{j}}"', from=3-3, to=5-3]
      \arrow["{F(U_{j} \subseteq U)}"', from=3-1, to=5-3]
      \arrow["{\pi_{i,j}}"', from=3-5, to=1-5]
      \arrow["{\pi_{i,j}}", from=3-5, to=5-5]
      \arrow["{F(U_{i} \cap U_{j} \subseteq U_{i})}", from=1-3, to=1-5]
      \arrow["{F(U_{i} \cap U_{j} \subseteq U_{j})}"', from=5-3, to=5-5]
    \end{tikzcd}\]
\end{defn}

\begin{defn}
  Let $X$ be a topological space.
  We define the category of sheaves $\Sh(X)$ as the full subcategory of $\Psh(\cO(X))$ spanned by sheaves.
\end{defn}

\begin{thm}
  For any topological space $X$, there is an isomorphism
  \[
    \Theta : \cO(X) \otto \Sub_{\Sh(X)}(1) : \Psi
  \]
\end{thm}
\begin{proof}
  We construct the two order-preserving functions as follows:
  \begin{itemize}
  \item[($\Theta$)] For each open set $O$, $\Theta(O)$ is the represented subsheaf $\Hom(\blank, O)$ of the terminal sheaf $1$.
  \item[($\Psi$)] For each subsheaf $F$ of the terminal sheaf, $\Psi(F)$ is the open set $\bigcup\Set{O \in \cO(X) \mid F(O) = 1}$, i.e., it is the union of all open sets $O$ so that $F(O)$ is the singleton set.
  \end{itemize}
\end{proof}

\begin{defn}
  Let $X$ and $Y$ be topological spaces.
  A continuous map $p : Y \to X$ is called a \emph{bundle over} $X$.
  A \emph{cross section} of a bundle $p : Y \to X$ is a continuous map $s : X \to Y$ so that $ps = \id$, i.e., a morphism from the identity bundle $\id : X \to X$ to $p : Y \to X$ in the slice category $\CTop/X$.
\end{defn}

\begin{rmk}
  Let $U \subseteq X$ be an open set of the topological space $X$, and $p : Y \to X$ be a bundle over $X$.
  The pullback yields a bundle over $U$.
  % https://q.uiver.app/#q=WzAsNCxbMCwyLCJVIl0sWzIsMiwiWCJdLFsyLDAsIlkiXSxbMCwwLCJwXFxpbnYgVSJdLFsyLDEsInAiXSxbMCwxLCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzMsMCwicFxcdmVydF97VX0iLDJdLFszLDIsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMywxLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XSxbMCwyLCJzIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
  \[\begin{tikzcd}
      {p\inv U} && Y \\
      \\
      U && X
      \arrow["p", from=1-3, to=3-3]
      \arrow[tail, from=3-1, to=3-3]
      \arrow["{p\vert_{U}}"', from=1-1, to=3-1]
      \arrow[tail, from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
      \arrow["s"{description}, dashed, from=3-1, to=1-3]
    \end{tikzcd}\]
  We call $s$ a \emph{cross section} of $p$ over $U$ if $s \circ p\vert_{U}$ is the inclusion.
\end{rmk}

\begin{rmk}
  We have an assignment $\Gamma_{p} : \cO(X) \to \CSet$ defined by sending open sets $U$ to the set of all cross sections of $p$ over $U$.
  This can be extended to a contravariant functor as for any open set $U' \subseteq U$ and any cross section $s$, we can define a cross section of $p$ over $U'$ by composition.
  % https://q.uiver.app/#q=WzAsNixbMiwyLCJVIl0sWzQsMiwiWCJdLFs0LDAsIlkiXSxbMiwwLCJwXFxpbnYgVSJdLFswLDAsInBcXGludiBVJyJdLFswLDIsIlUnIl0sWzIsMSwicCJdLFswLDEsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMywwLCJwXFx2ZXJ0X3tVfSIsMl0sWzMsMiwiIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFszLDEsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dLFswLDIsInMiLDEseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbNSwwLCIiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzQsNSwicFxcdmVydF97VSd9IiwyXSxbNCwzLCIiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzUsMiwiIiwyLHsiY3VydmUiOi0yLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbNCwwLCIiLDIseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=
  \[\begin{tikzcd}
      {p\inv U'} && {p\inv U} && Y \\
      \\
      {U'} && U && X
      \arrow["p", from=1-5, to=3-5]
      \arrow[tail, from=3-3, to=3-5]
      \arrow["{p\vert_{U}}"', from=1-3, to=3-3]
      \arrow[tail, from=1-3, to=1-5]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-3, to=3-5]
      \arrow["s"{description}, dashed, from=3-3, to=1-5]
      \arrow[tail, from=3-1, to=3-3]
      \arrow["{p\vert_{U'}}"', from=1-1, to=3-1]
      \arrow[tail, from=1-1, to=1-3]
      \arrow[curve={height=-12pt}, dashed, from=3-1, to=1-5]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
\end{rmk}

\section{Elementary topoi}
\label{sec:elementary-topoi}

\begin{defn}[Elementary form]\label{def:topos}
  An (elementary) \emph{topos} $\cE$ is a category with
  \begin{enumerate}
  \item\label{def:topos-pullbacks} Pullbacks;
  \item\label{def:topos-terminal} A terminal object $1$;
  \item A subobject classifier $\Omega$;
  \item\label{def:topos-exponential} To each object $a$ an object $Pa$ and a morphism $\in_{a} : Pa \times a \to \Omega$ so that for any $f : b \times a \to \Omega$, there is a unique morphism $g : b \to Pa$ so that $g \times \id$ factors $f$ through $\in_{a}$.
    % https://q.uiver.app/#q=WzAsNSxbMiwxLCJhIFxcdGltZXMgUGEiXSxbMSwyLCJcXE9tZWdhIl0sWzAsMSwiYiBcXHRpbWVzIGEiXSxbMCwwLCJiIl0sWzIsMCwiUGEiXSxbMCwxLCJcXGluX3thfSJdLFsyLDEsImYiLDJdLFsyLDAsImcgXFx0aW1lcyBcXGlkIl0sWzMsNCwiZyIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==
    \[\begin{tikzcd}
	b && Pa \\
	{b \times a} && {Pa \times a} \\
	& \Omega
	\arrow["{\in_{a}}", from=2-3, to=3-2]
	\arrow["f"', from=2-1, to=3-2]
	\arrow["{g \times \id}", from=2-1, to=2-3]
	\arrow["g", dashed, from=1-1, to=1-3]
      \end{tikzcd}\]
  \end{enumerate}
\end{defn}

\begin{rmk}
  We can phrase \cref{def:topos} in a nonelementary way.
  Conditions \ref{def:topos-pullbacks} and \ref{def:topos-terminal} demand that $\cE$ is finitely complete, while condition \ref{def:topos-exponential} demands that $\cE$ has power objects, and thus all exponentials (c.f., \cref{thm:topos-has-exponentials}).
  In other words, a topos is a category with finite limits, exponentials, and a subobject classifier.
\end{rmk}

\begin{rmk}
  The assignment $P : \ob\cE \to \ob\cE$ can be uniquely extended to a functor.
  Extending $P$ to a functor means that for any $c$, the following isomorphism has to be natural in $a$.
  \[
    \cE(c, Pa) \iso \cE(c \times a, \Omega)
  \]
  That is, for any $h : a \to b$, the following diagram must commute.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXGNFKFBiLFBhKSJdLFsyLDAsIlxcY0UoUGIgXFx0aW1lcyBhLCBcXE9tZWdhKSJdLFsyLDIsIlxcY0UoUGIgXFx0aW1lcyBiLCBcXE9tZWdhKSJdLFswLDIsIlxcY0UoUGIsIFBiKSJdLFswLDEsIlxcaXNvIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzMsMiwiXFxpc28iLDMseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMiwxLCJcXGJsYW5rIFxcY2lyYyAoXFxpZCBcXHRpbWVzIGgpIiwyXSxbMywwLCJQaCBcXGNpcmMgXFxibGFuayJdXQ==
  \[\begin{tikzcd}
      {\cE(Pb,Pa)} && {\cE(Pb \times a, \Omega)} \\
      \\
      {\cE(Pb, Pb)} && {\cE(Pb \times b, \Omega)}
      \arrow["\iso"{marking, allow upside down}, draw=none, from=1-1, to=1-3]
      \arrow["\iso"{marking, allow upside down}, draw=none, from=3-1, to=3-3]
      \arrow["{\blank \circ (\id \times h)}"', from=3-3, to=1-3]
      \arrow["{Ph \circ \blank}", from=3-1, to=1-1]
    \end{tikzcd}\]
  The transpose of $\id_{Pb}$ is $\in_{b}$.
  Thus, $Ph$ must be the transpose of $\in_{b}(\id \times h)$.
  Namely, it is the unique morphism given by the universal property of power objects.
  % https://q.uiver.app/#q=WzAsMyxbMCwyLCJQYSBcXHRpbWVzIGEiXSxbMiwyLCJcXE9tZWdhIl0sWzAsMCwiUGIgXFx0aW1lcyBhIl0sWzAsMSwiXFxpbl97YX0iLDJdLFsyLDEsIlxcaW5fe2J9KFxcaWQgXFx0aW1lcyBoKSJdLFsyLDAsIlBoIFxcdGltZXMgXFxpZCIsMix7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==
  \[\begin{tikzcd}
      {Pb \times a} \\
      \\
      {Pa \times a} && \Omega
      \arrow["{\in_{a}}"', from=3-1, to=3-3]
      \arrow["{\in_{b}(\id \times h)}", from=1-1, to=3-3]
      \arrow["{Ph \times \id}"', dashed, from=1-1, to=3-1]
    \end{tikzcd}\]
\end{rmk}

\begin{rmk}
  Indeed, the power object functor $P : \cE\op \to \cE$ is monadic.
  As monadic functors create limits and $\cE$ has finite limits by definition, $\cE\op$ has finite limits.
  Thus, $\cE$ is finitely cocomplete.
\end{rmk}

\begin{eg}
  When $\cE = \CSet$, the functor $P : \CSet\op \to \CSet$ is just the usual (contravariant) powerset functor.
\end{eg}

\begin{rmk}
  Given a topos $\cE$, we can view a subobject of $a$ as
  \begin{enumerate}
  \item An equivalence class of monos: $a' \mono a$.
  \item A characteristic morphism: $a \to \Omega$.
  \item A global element of a power object: $1 \to Pa$.
  \end{enumerate}
  This is due to the following isomorphisms.
  \[
    \Sub_{\cE}(a) \iso \cE(a, \Omega) \iso \cE(1, Pa)
  \]
\end{rmk}

\begin{defn}
  Let $\cE$ be a topos.
  Let $r : s \mono a \times b$ be a subobject with the corresponding characteristic morphism $\varphi : a \times b \to \Omega$ and global element $[\varphi] : b \to Pa$.
  We say that $s$ is an \emph{extension} of the predicate $\varphi$ and the element $[\varphi]$ \emph{names} the predicate $\varphi$.
\end{defn}

\begin{eg}
  In $\CSet$, a relation $R \subseteq X \times Y$ can be equally viewed as a truth functional (predicate) $\varphi : X \times Y \to 2$.
  The name of this predicate is a function $[\varphi] : Y \to PX$ that maps each $y \in Y$ to a subset of $X$ for which $R(x, y)$ holds for all $x$ in that subset.
\end{eg}

\begin{eg}\label{eg:singleton-predicate}
  The diagonal map $\Delta_{a} : a \to a \times a$ is always a monomorphism.
  Thus, in a topos, $\Delta_{a}$ is classified by the equality predicate $\delta_{a} : a \times a \to \Omega$, which is named by the global element $[\delta_{a}] : a \to Pa$.
  As it turns out, the name $[\delta_{a}]$ is a monomorphism itself.
  Thus, it is classified by a predicate $\sigma_{a} : Pa \to \Omega$, called the \emph{singleton} predicate.
\end{eg}

\begin{thm}\label{thm:topos-has-exponentials}
  Every topos has exponentials.
\end{thm}
\begin{proof}
  The main idea is that every function can be identified with a graph in $\CSet$, so a reasonable guess is to take $B^{A}$ as a subobject of $P(A \times B)$.
  Let $r : P(A \times B) \times A \to PB$ be the name of the subobject $\in_{A \times B} \mono P(A \times B) \times A \times B$.
  Take the pullback of the singleton map along $r$.
  % https://q.uiver.app/#q=WzAsNCxbMCwyLCJQKEEgXFx0aW1lcyBCKSBcXHRpbWVzIEEiXSxbMiwyLCJQQiJdLFsyLDAsIkIiXSxbMCwwLCJRIl0sWzAsMSwiciIsMl0sWzIsMSwiXFxTZXR7fSIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMywyXSxbMywwLCJxIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFszLDEsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
  \[\begin{tikzcd}
      Q && B \\
      \\
      {P(A \times B) \times A} && PB
      \arrow["r"', from=3-1, to=3-3]
      \arrow["{\Set{}}", tail, from=1-3, to=3-3]
      \arrow[from=1-1, to=1-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
  In $\CSet$, $Q$ consists of pairs $(G, a)$ so that $\Set{b \in B \mid (a, b) \in G}$ is a singleton set.
  This means the ``function'' is defined at $a$ in a unique way.
  A function must satisfy this for all $a$, so let $q : P(A \times B) \to PB$ be the name of the classifying map $\chi_{Q}$, and $t_{A} : 1 \to PA$ be the name of the maximal subobject in $\Sub(1 \times A)$.
  Take the following pullback.
  % https://q.uiver.app/#q=WzAsNCxbMiwwLCIxIl0sWzIsMiwiUEEiXSxbMCwyLCJQKEEgXFx0aW1lcyBCKSJdLFswLDAsIkJee0F9Il0sWzIsMSwicSIsMl0sWzAsMSwidF97QX0iXSxbMywyLCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzMsMF1d
  \[\begin{tikzcd}
      {B^{A}} && 1 \\
      \\
      {P(A \times B)} && PA
      \arrow["q"', from=3-1, to=3-3]
      \arrow["{t_{A}}", tail, from=1-3, to=3-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
  In $\CSet$, $B^{A}$ is precisely the set of all graphs from $A$ to $B$.
  It remains to verify that $B^{A}$ has the universal property of exponentials.
  Note that the following diagram is a pullback square.
  % https://q.uiver.app/#q=WzAsNCxbMiwwLCJCIl0sWzIsMiwiUEIiXSxbMCwyLCJBIFxcdGltZXMgUChBIFxcdGltZXMgQikiXSxbMCwwLCJBIFxcdGltZXMgQl57QX0iXSxbMiwxLCJyIiwyXSxbMCwxLCJcXFNldHt9Il0sWzMsMiwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFszLDBdLFszLDEsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
  \[\begin{tikzcd}
      {A \times B^{A}} && B \\
      \\
      {A \times P(A \times B)} && PB
      \arrow["r"', from=3-1, to=3-3]
      \arrow["{\Set{}}", from=1-3, to=3-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
  The projection $A \times B^{A} \to B$ defines the evaluation map.
  Now, for any morphism $A \times C \to B$, we construct a morphism $A \times C \to A \times P(A \times B)$.
  First, to construction a morphism $C \to P(A \times B)$, it suffices to construct a morphism $A \times C \to PB$.
  Take $\Set{} \circ f$, and let $g : C \to P(A \times B)$ be its transpose.
  In $\CSet$, $g$ is defined by $c \mapsto \Set{(a, f(a, c))}$.
  Then $\id_{A} \times g$ makes the outer square of the following diagram commute.
  Thus, we have proven the required universal property.
  % https://q.uiver.app/#q=WzAsNSxbMywxLCJCIl0sWzMsMywiUEIiXSxbMSwzLCJBIFxcdGltZXMgUChBIFxcdGltZXMgQikiXSxbMSwxLCJBIFxcdGltZXMgQl57QX0iXSxbMCwwLCJBIFxcdGltZXMgQyJdLFsyLDEsInIiLDJdLFswLDEsIlxcU2V0e30iXSxbMywyLCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzMsMCwiXFxldiJdLFszLDEsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dLFs0LDAsImYiLDAseyJjdXJ2ZSI6LTJ9XSxbNCwyLCJcXGlkX3tBfSBcXHRpbWVzIGciLDIseyJjdXJ2ZSI6Mn1dLFs0LDMsIlxcaWRfe0F9IFxcdGltZXMgXFxmaGF0IiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
  \[\begin{tikzcd}
      {A \times C} \\
      & {A \times B^{A}} && B \\
      \\
      & {A \times P(A \times B)} && PB
      \arrow["r"', from=4-2, to=4-4]
      \arrow["{\Set{}}", from=2-4, to=4-4]
      \arrow[tail, from=2-2, to=4-2]
      \arrow["\ev", from=2-2, to=2-4]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-2, to=4-4]
      \arrow["f", curve={height=-12pt}, from=1-1, to=2-4]
      \arrow["{\id_{A} \times g}"', curve={height=12pt}, from=1-1, to=4-2]
      \arrow["{\id_{A} \times \fhat}"{description}, dashed, from=1-1, to=2-2]
    \end{tikzcd}\]
\end{proof}

\begin{thm}
  In a topos, every monomorphism is an equalizer and every mono and epi morphism is an isomorphism.
\end{thm}
\begin{proof}
  Let $\Omega_{t}$ be the equalizer of $\id_{\Omega}$ and $t!_{\Omega}$.
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJcXE9tZWdhX3t0fSJdLFsyLDAsIlxcT21lZ2EiXSxbNCwwLCJcXE9tZWdhIl0sWzEsMiwidCFfe1xcT21lZ2F9IiwwLHsib2Zmc2V0IjotMX1dLFsxLDIsIlxcaWRfe1xcT21lZ2F9IiwyLHsib2Zmc2V0IjoxfV0sWzAsMSwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dXQ==
  \[\begin{tikzcd}
      {\Omega_{t}} && \Omega && \Omega
      \arrow["{t!_{\Omega}}", shift left, from=1-3, to=1-5]
      \arrow["{\id_{\Omega}}"', shift right, from=1-3, to=1-5]
      \arrow[tail, from=1-1, to=1-3]
    \end{tikzcd}\]
  It's easy to verify that $A \mono B$ is the equalizer of $\chi_{A}$ and $t!_{\Omega}\chi_{A}$.
  Note that $!_{\Omega}\chi_{A} = !_{B}$ because $1$ is the terminal object.
\end{proof}

\begin{rmk}
  $\Omega_{t}$ classifies maximal subobjects.
  In $\CSet$, $\Omega_{t}$ coincides with the terminal object $1$, so $t_{t} : 1 \to \Omega_{t}$ can only be pulled back along the unique map $! : A \to \Omega_{t}$, giving the maximal subobject $A \subseteq A$.
\end{rmk}

\begin{cor}
  Every topos is balanced.
\end{cor}

\begin{defn}
  Let $\cE$ and $\cF$ be topoi.
  A \emph{logical functor} $F : \cE \to \cF$ is a functor that preserves finite limits, the subobject classifier, and exponentials.
\end{defn}

\begin{defn}
  Let $\cE$ and $\cF$ be topoi.
  A \emph{geometric morphism} $f : \cF \to \cE$ consists of a pair of functors
  % https://q.uiver.app/#q=WzAsMixbMCwwLCJcXGNGIl0sWzIsMCwiXFxjRSJdLFswLDEsImZfeyp9IiwyLHsiY3VydmUiOjJ9XSxbMSwwLCJmXnsqfSIsMix7ImN1cnZlIjoyfV0sWzMsMiwiIiwyLHsibGV2ZWwiOjEsInN0eWxlIjp7Im5hbWUiOiJhZGp1bmN0aW9uIn19XV0=
  \[\begin{tikzcd}
      \cF && \cE
      \arrow[""{name=0, anchor=center, inner sep=0}, "{f_{*}}"', curve={height=12pt}, from=1-1, to=1-3]
      \arrow[""{name=1, anchor=center, inner sep=0}, "{f^{*}}"', curve={height=12pt}, from=1-3, to=1-1]
      \arrow["\dashv"{anchor=center, rotate=-90}, draw=none, from=1, to=0]
    \end{tikzcd}\]
  such that $f^{*}$ preserves finite limits.
  The functor $f_{*}$ is called the \emph{direct image} of $f$ and $f^{*}$ is the \emph{inverse image} of $f$.
  If $f$ and $g$ are geometric morphism, a \emph{geometric transformation} $\alpha : f \to g$ is a natural transformation $f^{*} \To g^{*}$.
\end{defn}

\begin{defn}
  We write $\CTopoi$ for the 2-category of topoi, geometric morphisms, and geometric transformations.
\end{defn}

\begin{eg}\label{eg:geometric-morphisms-between-presheaves}
  Let $F : \iC \to \iD$ be a functor between small categories.
  The functor $f^{*}$ defined by precomposition has a left and right adjoints.
  The right Kan extension is the direct image, while $f^{*}$ is the inverse image.
  % https://q.uiver.app/#q=WzAsMixbMCwwLCJcXFBzaChcXGlEKSJdLFsyLDAsIlxcUHNoKFxcaUMpIl0sWzAsMSwiZl57Kn0iLDAseyJvZmZzZXQiOi0yfV0sWzEsMCwiXFxyYW5fe2Z9IiwwLHsib2Zmc2V0IjotMn1dLFsyLDMsIiIsMix7ImxldmVsIjoxLCJzdHlsZSI6eyJuYW1lIjoiYWRqdW5jdGlvbiJ9fV1d
  \[\begin{tikzcd}
      {\Psh(\iD)} && {\Psh(\iC)}
      \arrow[""{name=0, anchor=center, inner sep=0}, "{f^{*}}", shift left=2, from=1-1, to=1-3]
      \arrow[""{name=1, anchor=center, inner sep=0}, "{\ran_{f}}", shift left=2, from=1-3, to=1-1]
      \arrow["\dashv"{anchor=center, rotate=-90}, draw=none, from=0, to=1]
    \end{tikzcd}\]
  Thus, the assignment $\iC \mapsto \Psh(\iC)$ can be extended to a pseudofunctor $\CCat \to \CTopoi$.
\end{eg}

\begin{defn}
  A geometric morphism $f : \cF \to \cE$ is \emph{essential} if the inverse image $f^{*} : \cE \to \cF$ has a left adjoint.
  We write $f_{!}$ for the left adjoint of $f^{*}$.
\end{defn}

\todo{It appears a lot of the ``dirty work'' we did for algebraic theories can be nicely explained by examples in Elephant A.4.1.}
\todo{This appears to be a connection between geometry and algebra.}

\begin{lem}
  Let $\iC$ and $\iD$ be small categories such that $\iD$ is Cauchy-complete.
  Then every essential geometric morphism $f : \Psh(\iC) \to \Psh(\iD)$ is induced by a functor $\iC \to \iD$.
\end{lem}
\begin{proof}
  Let $g : \iC \to \iD$ be a functor.
  By \cref{eg:geometric-morphisms-between-presheaves}, this functor induces an essential geometric morphism defined by precomposition.

  Conversely, let $f$ be an essential geometric morphism.
  We want to show that $f$ is induced by a functor $g : \iC \to \iD$ by precomposition.
  Note that representable functors are perfectly presentable in the presheaf category and $f^{*}$ preserves colimits.
  Owing to the following natural isomorphism,
  \[
    \Psh(\iD)(f_{!}\iC(\blank, c), \blank) \iso \Psh(\iC)(\iC(\blank,c), f^{*}\blank)
  \]
  we see that $\Psh(\iD)(f_{!}\iC(\blank, c), \blank)$ preserves sifted colimits.
  Thus, $f_{!}\iC(\blank,c)$ is perfectly presentable and therefore it is a retract of a representable.
  Since $\iD$ is Cauchy-complete, $f_{!}\iC(\blank, c)$ is representable.
  Thus, $f_{!}$ restricts along the Yoneda embedding to a functor $f_{0} : \iC \to \iD$.
  Indeed, $f$ is induced by $f_{0}$.
  \begin{align}
    f^{*}(F)(c) &\iso \Psh(\iC)(\iC(\blank, c), f^{*}F)\\
                &\iso \Psh(\iD)(f_{!}\iC(\blank, c), F)\\
                &\iso \Psh(\iD)(\iD(\blank, f_{0}c), F)\\
                &\iso Ff_{0}c
  \end{align}
\end{proof}

\section{Grothendieck topologies}
\label{sec:grothendieck-topologies}

\begin{defn}
  A \emph{Grothendieck topology} on a category $\iC$ is a function $J$ assigning to each object $c$ a collection $J(c)$ of covering sieves on $c$ so that
  \begin{enumerate}
  \item For any object $c$, the maximal sieve is in $J(c)$.
  \item (Stability) If $S$ is a sieve that covers $c$ and $g : d \to c$ is any morphism, then the pullback sieve $g^{*}S$ covers $d$.
  \item (Local character) If $R$ is a covering sieve on $c$ and $S$ is another sieve on $c$ such that for all $f : d \to c \in R$, the pullback sieve $f^{*}S$ covers $d$, then $S$ covers $c$.
  \end{enumerate}
\end{defn}

\begin{rmk}
  Stability means the assignment $J$ extends to a functor $J : \iC\op \to \CSet$, i.e., an object in the presheaf category $\Psh(\iC)$.
  The subobject classifier $\Omega$ in $\Psh(\iC)$ is the functor $\Sub(\yon\blank)$ sending each $c \in \iC$ to the set of sieves on $c$.
  Thus, $J$ (a functor sending each $c$ to a set of covering sieves on $c$) is a subobject of $\Omega$.
\end{rmk}

\section{Lawvere-Tierney topologies}
\label{sec:lawvere-tierney-topologies}

Let $X$ be a topological space.
A sheaf (of sets) is an assignment $\cO(X)\op \to \CSet$ so that a global section can be uniquely determined by gluing compatible local sections according to the topology of $X$.

Note that the subobject classifier in $\Psh(\cO(X))$ is the functor $\Sub\yon : \cO(X)\op \to \CSet$, assigning to each open set $U$ the set of all subfunctors $R \subseteq \cO(X)(\blank, U)$.
By definition, $\cO(X)(V,U) = 1$ if $V \subseteq U$, so $R(V) = 1$ necessarily implies that $V \subseteq U$, i.e., $\cO(X)(V, U) = 1$.
If additionally $V' \subseteq V$, then $R(V') = 1$ because we have $R(V) \to R(V')$.
Thus, we can view $R$ as a filter on $U$, i.e., a set of downward closed open subsets of $U$.

A family $\Set{U_{i}}_{i \in I}$ is an open cover of $U$ if $\bigcup_{i \in I}U_{i} = U$.
To formalize this idea, we define a natural transformation
\begin{mathpar}
  j : \Omega \to \Omega \and j_{U}(R) = \bigcup R
\end{mathpar}
For $V \subseteq U$, we have
\[
  \Omega(V \subseteq U)(j_{U}(R)) = \left(\bigcup R\right) \cap V = \bigcup(R \cap V) = j_{V}(\Omega(V \subseteq U)(R))
\]
The component $j_{U} : \Omega(U) \to \Omega(U)$ maps each filter on $U$ to the open subset that it covers.

The pullback of $t : 1 \to \Omega$ along $j$ determines a subobject $J$.
% https://q.uiver.app/#q=WzAsNCxbMCwwLCJKIl0sWzAsMiwiXFxPbWVnYSJdLFsyLDIsIlxcT21lZ2EiXSxbMiwwLCIxIl0sWzEsMiwiaiIsMl0sWzAsMSwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFszLDIsInQiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzAsM10sWzAsMiwiIiwxLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
\[\begin{tikzcd}
    J && 1 \\
    \\
    \Omega && \Omega
    \arrow["j"', from=3-1, to=3-3]
    \arrow[tail, from=1-1, to=3-1]
    \arrow["t", tail, from=1-3, to=3-3]
    \arrow[from=1-1, to=1-3]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
  \end{tikzcd}\]
By evaluating each functor at the open set $U$ yields a pullback in $\CSet$, which is the fiber product of the functions $j_{U}$ and $t_{U}$, so the pullback is nothing but the set
\[
  J(U) = \Set{R \mono \Omega(U) \mid j_{U}(R) = U}
\]
By definition, $j_{U}(R) = \bigcup R$.
Thus, $J(U)$ is the set of all open covers of $U$.

\begin{defn}\label{def:lawvere-tierney-topology}
  A \emph{Lawvere-Tierney topology} (topology for short) on a topos $\cE$ is a morphism $j : \Omega \to \Omega$ satisfying
  % https://q.uiver.app/#q=WzAsMTAsWzAsMCwiMSJdLFsxLDAsIlxcT21lZ2EiXSxbMSwxLCJcXE9tZWdhIl0sWzIsMCwiXFxPbWVnYSJdLFszLDAsIlxcT21lZ2EiXSxbMywxLCJcXE9tZWdhIl0sWzQsMCwiXFxPbWVnYSBcXHRpbWVzIFxcT21lZ2EiXSxbNSwwLCJcXE9tZWdhIl0sWzUsMSwiXFxPbWVnYSJdLFs0LDEsIlxcT21lZ2EgXFx0aW1lcyBcXE9tZWdhIl0sWzAsMSwidCJdLFsxLDIsImoiXSxbMCwyLCJ0IiwyXSxbMyw0LCJqIl0sWzQsNSwiaiJdLFszLDUsImoiLDJdLFs2LDcsIlxcd2VkZ2UiXSxbOSw4LCJcXHdlZGdlIiwyXSxbNiw5LCJqIiwyXSxbNyw4LCJqIl1d
  \[\begin{tikzcd}
      1 & \Omega & \Omega & \Omega & {\Omega \times \Omega} & \Omega \\
      & \Omega && \Omega & {\Omega \times \Omega} & \Omega
      \arrow["t", from=1-1, to=1-2]
      \arrow["j", from=1-2, to=2-2]
      \arrow["t"', from=1-1, to=2-2]
      \arrow["j", from=1-3, to=1-4]
      \arrow["j", from=1-4, to=2-4]
      \arrow["j"', from=1-3, to=2-4]
      \arrow["\wedge", from=1-5, to=1-6]
      \arrow["\wedge"', from=2-5, to=2-6]
      \arrow["j \times j"', from=1-5, to=2-5]
      \arrow["j", from=1-6, to=2-6]
    \end{tikzcd}\]
\end{defn}

\begin{rmk}
  The morphism $j : \Omega \to \Omega$ classifies a subobject of $\Omega$.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJKIl0sWzIsMCwiMSJdLFsyLDIsIlxcT21lZ2EiXSxbMCwyLCJcXE9tZWdhIl0sWzMsMiwiaiIsMl0sWzEsMiwidCIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMCwxXSxbMCwzLCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzAsMiwiIiwxLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
  \[\begin{tikzcd}
      J && 1 \\
      \\
      \Omega && \Omega
      \arrow["j"', from=3-1, to=3-3]
      \arrow["t", tail, from=1-3, to=3-3]
      \arrow[from=1-1, to=1-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}\]
  Thus, we can phrase \cref{def:lawvere-tierney-topology} in terms of this subobject.
\end{rmk}

\begin{defn}
  Let $\cE$ be a topos equipped with a topology $j$.
  Let $A$ be a subobject of $B$ classified by $\chi_{A}$.
  The composite $j \circ \chi_{A}$ determines another subobject $\Abar$ of $B$, which we call the \emph{closure} of $A$.
\end{defn}

\begin{thm}\label{thm:closure-operator-in-topos}
  Let $\cE$ be a topos, a morphism $j : \Omega \to \Omega$ induces an operator $E \mapsto \Ebar$ on the subobjects of each object $E$ of $\cE$ natural in its argument in the sense that for any $f : A \to B$ in $\cE$ and any subobject $C$ of $B$, one has
  \[
    f^{*}(\Cbar) = \overline{f^{*}C}
  \]
  Moreover, $j$ is a topology if and only if the operator satisfies
  \begin{mathpar}
    A \subseteq \Abar \and \overline{\Abar} = \Abar \and \overline{A \cap B} = \Abar \cap \Bbar
  \end{mathpar}
  for all objects.
\end{thm}
\begin{proof}
  By definition, $f^{*}(\Cbar)$ is the pullback of $\Cbar$ along $f$.
  Thus, $f^{*}(\Cbar)$ is a subobject classified by $j \circ \chi_{C} \circ f$, which by definition classifies the subobject $\overline{f^{*}C}$.
  % https://q.uiver.app/#q=WzAsNixbMiwwLCJcXENiYXIiXSxbMiwyLCJCIl0sWzQsMiwiXFxPbWVnYSJdLFs0LDAsIjEiXSxbMCwyLCJBIl0sWzAsMCwiZl57Kn0oXFxDYmFyKSJdLFswLDEsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMSwyLCJqIFxcY2lyYyBcXGNoaV97Q30iLDJdLFszLDIsInQiXSxbMCwzXSxbNCwxLCJmIiwyXSxbNSw0LCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzUsMF0sWzUsMSwiIiwyLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV0sWzAsMiwiIiwyLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
  \[\begin{tikzcd}
      {f^{*}(\Cbar)} && \Cbar && 1 \\
      \\
      A && B && \Omega
      \arrow[tail, from=1-3, to=3-3]
      \arrow["{j \circ \chi_{C}}"', from=3-3, to=3-5]
      \arrow["t", from=1-5, to=3-5]
      \arrow[from=1-3, to=1-5]
      \arrow["f"', from=3-1, to=3-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-3, to=3-5]
    \end{tikzcd}\]

  Now suppose that $j$ is a topology.
  The closure properties are can be proved by the following abstract nonsense.
  \begin{mathpar}
    % https://q.uiver.app/#q=WzAsNixbMSwyLCJCIl0sWzIsMiwiXFxPbWVnYSJdLFszLDIsIlxcT21lZ2EiXSxbMywxLCIxIl0sWzEsMSwiXFxBYmFyIl0sWzAsMCwiQSJdLFswLDEsIlxcY2hpX3tBfSIsMl0sWzEsMiwiaiIsMl0sWzMsMiwidCIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbNCwwLCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzQsM10sWzUsMywiIiwwLHsiY3VydmUiOi0yfV0sWzUsMCwiIiwwLHsiY3VydmUiOjIsInN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMywxLCJ0IiwyXSxbNSw0LCIiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbNCwyLCIiLDAseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=
    \begin{tikzcd}
      A \\
      & \Abar && 1 \\
      & B & \Omega & \Omega
      \arrow["{\chi_{A}}"', from=3-2, to=3-3]
      \arrow["j"', from=3-3, to=3-4]
      \arrow["t", tail, from=2-4, to=3-4]
      \arrow[tail, from=2-2, to=3-2]
      \arrow[from=2-2, to=2-4]
      \arrow[curve={height=-12pt}, from=1-1, to=2-4]
      \arrow[curve={height=12pt}, tail, from=1-1, to=3-2]
      \arrow["t"', from=2-4, to=3-3]
      \arrow[dashed, from=1-1, to=2-2]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-2, to=3-4]
    \end{tikzcd}\and
    % https://q.uiver.app/#q=WzAsNyxbMSwxLCJcXEFiYXIiXSxbMSwyLCJCIl0sWzIsMiwiXFxPbWVnYSJdLFszLDIsIlxcT21lZ2EiXSxbMywxLCIxIl0sWzQsMiwiXFxPbWVnYSJdLFswLDAsIlxcb3ZlcmxpbmV7XFxBYmFyfSJdLFswLDEsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMSwyLCJcXGNoaV97QX0iLDJdLFsyLDMsImoiLDJdLFs0LDMsInQiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzAsNF0sWzMsNSwiaiIsMl0sWzIsNSwiaiIsMix7ImN1cnZlIjozfV0sWzYsMSwiIiwyLHsiY3VydmUiOjIsInN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbNCw1LCJ0IiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFs2LDQsIiIsMCx7ImN1cnZlIjotMn1dLFs2LDAsIlxcaXNvIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV1d
    \begin{tikzcd}
      {\overline{\Abar}} \\
      & \Abar && 1 \\
      & B & \Omega & \Omega & \Omega
      \arrow[tail, from=2-2, to=3-2]
      \arrow["{\chi_{A}}"', from=3-2, to=3-3]
      \arrow["j"', from=3-3, to=3-4]
      \arrow["t", tail, from=2-4, to=3-4]
      \arrow[from=2-2, to=2-4]
      \arrow["j"', from=3-4, to=3-5]
      \arrow["j"', curve={height=18pt}, from=3-3, to=3-5]
      \arrow[curve={height=12pt}, tail, from=1-1, to=3-2]
      \arrow["t", tail, from=2-4, to=3-5]
      \arrow[curve={height=-12pt}, from=1-1, to=2-4]
      \arrow["\iso"{marking, allow upside down}, draw=none, from=1-1, to=2-2]
    \end{tikzcd}\and
    % https://q.uiver.app/#q=WzAsNixbMSwxLCJcXG92ZXJsaW5le0EgXFxjYXAgQn0iXSxbMSwyLCJDIl0sWzMsMiwiXFxPbWVnYSJdLFszLDEsIjEiXSxbMCwwLCJcXEFiYXIgXFxjYXAgXFxCYmFyIl0sWzAsMiwiQyJdLFswLDEsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMCwzXSxbMywyLCJ0IiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFsxLDIsImpcXHdlZGdlKFxcY2hpX3tBfSxcXGNoaV97Qn0pIl0sWzQsNSwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFs0LDMsIiIsMix7ImN1cnZlIjotMX1dLFs1LDIsIlxcd2VkZ2UoalxcY2hpX3tBfSxqXFxjaGlfe0J9KSIsMix7ImN1cnZlIjoyfV0sWzQsMCwiXFxpc28iLDMseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMSw1LCIiLDMseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dXQ==
    \begin{tikzcd}
      {\Abar \cap \Bbar} \\
      & {\overline{A \cap B}} && 1 \\
      C & C && \Omega
      \arrow[tail, from=2-2, to=3-2]
      \arrow[from=2-2, to=2-4]
      \arrow["t", tail, from=2-4, to=3-4]
      \arrow["{j\wedge(\chi_{A},\chi_{B})}", from=3-2, to=3-4]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[curve={height=-6pt}, from=1-1, to=2-4]
      \arrow["{\wedge(j\chi_{A},j\chi_{B})}"', curve={height=12pt}, from=3-1, to=3-4]
      \arrow["\iso"{marking, allow upside down}, draw=none, from=1-1, to=2-2]
      \arrow[Rightarrow, no head, from=3-2, to=3-1]
    \end{tikzcd}
  \end{mathpar}
  Conversely, if $j$ induces a closure operation with the above properties, then the diagrams above show that $j$ must be a topology.
\end{proof}

\begin{defn}
  Let $\cE$ be a topos equipped with a topology.
  We say that a subobject $A$ of $B$ is \emph{dense} in $B$ if $\Abar = B$ and that it is \emph{closed} when $\Abar = A$.
\end{defn}

\begin{defn}
  Let $\cE$ be a topos equipped with a topology $j$.
  A \emph{$j$-sheaf} is an object $F$ so that for every dense monomorphism $m : A \mono B$ and any morphism $f' : A \to F$, $m$ factors through $f'$ uniquely.
  % https://q.uiver.app/#q=WzAsMyxbMCwwLCJBIl0sWzAsMiwiQiJdLFsyLDAsIkMiXSxbMCwxLCJtIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFswLDIsImYiXSxbMSwyLCIiLDIseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XV0=
  \[\begin{tikzcd}
      A && F \\
      \\
      B
      \arrow["m"', tail, from=1-1, to=3-1]
      \arrow["f'", from=1-1, to=1-3]
      \arrow[dashed, from=3-1, to=1-3]
    \end{tikzcd}\]
  An object is $j$-separated if $m$ factors through $f'$ in at most one way.
  The category $\Sh_{j}(\cE)$ is the full subcategory of $\cE$ spanned by $j$-sheaves.
\end{defn}

\begin{rmk}
  Clearly, $\Sh_{j}(\cE)$ is the orthogonal class $\cM^{\bot}$, where $\cM$ is the class of all dense monomorphisms.
  When $\cE$ is a locally presentable category and $\cM$ is small, $\Sh_{j}(\cE)$ is reflective in $\cE$.
  In fact, $\Sh_{j}(\cE)$ is lex reflective because $\cM$ is stable under pullbacks.
\end{rmk}

\todo{These theorems are proved for more general categories in elephant.}

Now we record some facts about topos equipped with a topology.

\begin{lem}\label{lem:dense-bijection-closed-subobjects}
  Let $\cE$ be a topos equipped with a topology $j$.
  If $m : A \mono B$ is dense, then there is a bijection between closed subobjects of $A$ and those of $B$.
\end{lem}
\begin{proof}
  Let $B'$ be a closed subobject of $B$, then $m^{*}(B')$ is a subobject of $A$ and moreover $\overline{m^{*}(B')} = m^{*}(\overline{B'}) = m^{*}(B')$.
  Conversely, let $A'$ be a closed subobject of $A$.
  Then $\overline{A'} \subseteq \Abar = B$, and clearly $\Abar$ is closed.
  Since dense monomorphisms are pullback stable, the projection $m^{*}(C) \mono C$ is dense for any closed subobject $C$ of $B$.
  Thus, we have
  \begin{mathpar}
    m^{*}(\overline{A'}) = \overline{m^{*}(\overline{A'})} = \overline{A'} = A'\and
    \overline{m^{*}(B')} = B'
  \end{mathpar}
  This proves that the two mappings form a bijection.
\end{proof}

\begin{lem}\label{lem:category-of-sheaves-exponential-ideal}
  Let $\cE$ be a topos equipped with a topology $j$.
  $\Sh_{j}(\cE)$ is an exponential ideal in $\cE$.
\end{lem}
\begin{proof}
  Let $B$ be a $j$-sheaf and $A$ be an object in $\cE$.
  For any dense monomorphism $m : C' \to C$, the morphism $\id_{A} \times m : A \times C' \mono A \times C$ is dense because it is a pullback.
  Then for any $f' : C' \to B^{A}$, there is a unique $A \times C \to B$ whose transpose uniquely factors $m$ through $f'$.
  % https://q.uiver.app/#q=WzAsNixbNCwwLCJBIFxcdGltZXMgQyciXSxbNCwyLCJBIFxcdGltZXMgQyJdLFs2LDAsIkIiXSxbMiwwLCJCXntBfSJdLFswLDAsIkMnIl0sWzAsMiwiQyJdLFswLDEsIlxcaWRfe0F9IFxcdGltZXMgbSIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMCwyLCJcXGhhdHtmJ30iXSxbMSwyLCIiLDIseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbNCw1LCJtIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFs0LDMsImYnIl0sWzUsMywiIiwyLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
  \[\begin{tikzcd}
      {C'} && {B^{A}} && {A \times C'} && B \\
      \\
      C &&&& {A \times C}
      \arrow["{\id_{A} \times m}"', tail, from=1-5, to=3-5]
      \arrow["{f'^{\dagger}}", from=1-5, to=1-7]
      \arrow[dashed, from=3-5, to=1-7]
      \arrow["m"', tail, from=1-1, to=3-1]
      \arrow["{f'}", from=1-1, to=1-3]
      \arrow[dashed, from=3-1, to=1-3]
    \end{tikzcd}\]
  Thus, $B^{A}$ is a $j$-sheaf.
\end{proof}

\begin{lem}\label{lem:closed-object-classifier-a-sheaf}
  In a topos $\cE$ equipped with a topology $j$, let $\Omega_{j}$ be the equalizer of $\id_{\Omega}$ and $j$.
  $\Omega_{j}$ is a $j$-sheaf.
\end{lem}
\begin{proof}
  Let $m : A \mono B$ be any dense monomorphism and $f' : A \to \Omega_{j}$ be any morphism.
  $f'$ corresponds to a closed subobject $A'$ of $A$ given by the composite $kf'$.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXE9tZWdhX3tqfSJdLFswLDEsIkEiXSxbMSwwLCJcXE9tZWdhIl0sWzIsMCwiXFxPbWVnYSJdLFsxLDAsImYnIl0sWzAsMiwiayIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMiwzLCIiLDAseyJvZmZzZXQiOi0xfV0sWzIsMywiIiwwLHsib2Zmc2V0IjoxfV0sWzEsMiwiXFxjaGlfe0EnfSIsMl1d
  \[\begin{tikzcd}
      {\Omega_{j}} & \Omega & \Omega \\
      A
      \arrow["{f'}", from=2-1, to=1-1]
      \arrow["k", tail, from=1-1, to=1-2]
      \arrow[shift left, from=1-2, to=1-3]
      \arrow[shift right, from=1-2, to=1-3]
      \arrow["{\chi_{A'}}"', from=2-1, to=1-2]
    \end{tikzcd}\]
  The subobject $A'$ is a subobject in $B$ by the composite $mA'$.
  By \cref{lem:dense-bijection-closed-subobjects}, there is a unique closed subobject $B'$ whose pullback along $m$ is isomorphic to $A'$.
  By the universal property of equalizers, there is a unique morphism $B \to \Omega_{j}$ so that the following diagram commutes.
  % https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXE9tZWdhX3tqfSJdLFswLDEsIkIiXSxbMSwwLCJcXE9tZWdhIl0sWzIsMCwiXFxPbWVnYSJdLFsxLDAsInUiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMCwyLCJrIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFsyLDMsIiIsMCx7Im9mZnNldCI6LTF9XSxbMiwzLCIiLDAseyJvZmZzZXQiOjF9XSxbMSwyLCJcXGNoaV97Qid9IiwyXV0=
  \[\begin{tikzcd}
      {\Omega_{j}} & \Omega & \Omega \\
      B
      \arrow["u", dashed, from=2-1, to=1-1]
      \arrow["k", tail, from=1-1, to=1-2]
      \arrow[shift left, from=1-2, to=1-3]
      \arrow[shift right, from=1-2, to=1-3]
      \arrow["{\chi_{B'}}"', from=2-1, to=1-2]
    \end{tikzcd}\]
  To show that $um = f'$, it suffices to show $kum = kf'$, which is equivalent to showing $\chi_{B'}m = \chi_{A'}$.
  Since $A' \iso B'$ by construction, the desired equality follows at once.
  % https://q.uiver.app/#q=WzAsNixbMCwwLCJBJyJdLFsyLDAsIkInIl0sWzAsMiwiQSJdLFsyLDIsIkIiXSxbNCwyLCJcXE9tZWdhIl0sWzQsMCwiMSJdLFsyLDMsIm0iLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzAsMiwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFsxLDMsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMCwxLCJcXGlzbyIsMyx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFswLDMsIiIsMyx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dLFs1LDQsIiIsMyx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1vbm8ifX19XSxbMSw1XSxbMyw0LCJcXGNoaV97Qid9IiwyXSxbMiw0LCJcXGNoaV97QSd9IiwyLHsiY3VydmUiOjN9XV0=
  \[\begin{tikzcd}
      {A'} && {B'} && 1 \\
      \\
      A && B && \Omega
      \arrow["m"', tail, from=3-1, to=3-3]
      \arrow[tail, from=1-1, to=3-1]
      \arrow[tail, from=1-3, to=3-3]
      \arrow["\iso"{marking, allow upside down}, draw=none, from=1-1, to=1-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
      \arrow[tail, from=1-5, to=3-5]
      \arrow[from=1-3, to=1-5]
      \arrow["{\chi_{B'}}"', from=3-3, to=3-5]
      \arrow["{\chi_{A'}}"', curve={height=18pt}, from=3-1, to=3-5]
    \end{tikzcd}\]
\end{proof}

\begin{cor}
  Let $\cE$ be a topos equipped with a topology $j$.
  For any object $A \in \cE$, the exponential $\Omega_{j}^{A}$ is a $j$-sheaf.
\end{cor}
\begin{proof}
  By \cref{lem:category-of-sheaves-exponential-ideal} and \cref{lem:closed-object-classifier-a-sheaf}.
\end{proof}

\begin{thm}
  Let $\cE$ be a topos equipped with a topology $j$.
  $\Sh_{j}(\cE)$ is reflective in $\cE$.
\end{thm}
\begin{proof}
  The inclusion functor $\Sh_{j}(\cE) \into \cE$ is fully faithful by construction.
  Thus, it suffices to construct the required left adjoint $L : \cE \to \Sh_{j}(\cE)$.
\end{proof}

\todo{%
  \begin{enumerate}
  \item Prove $\Sh_{j}(\cE)$ is a lex reflection of $\cE$.
  \item Prove that $\Sh_{j}(\cE)$ is a topos.
  \end{enumerate}
}

\section{Locales}
\label{sec:locales}

\begin{defn}
  A \emph{frame} is a lattice with arbitrary joins and finite meets satisfying the infinitary distributive law.
  A \emph{frame homomorphism} is an order-preserving function that preserves infinite joins and finite meets.
\end{defn}

\begin{defn}
  The category of locales $\CLoc$ is the opposite of the category of frames $\CFrm$.
\end{defn}

\bibliographystyle{alpha}
\bibliography{all}

\end{document}
