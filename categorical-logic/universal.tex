\documentclass{zett}
\input{preambles}
\title{categorical logic lecture notes}
\author{Frank Tsai}
\date{\today}
% \thanks{}


\begin{document}
\maketitle
\tableofcontents

\section{Generators and Projectives}
\label{sec:generators-and-projectives}

\subsection{Well-Powered Categories}
\label{sec:well-powered-categories}

\begin{defn}\label{def:equiv-mono}
  Given an object $C \in \iC$ of a category $\iC$.
  Two monomorphisms $f : R \mono C$ and $g : S \mono C$ are \emph{equivalent} when there is an isomorphism $\tau : R \iso S$ such that the triangle
  \[\input{img/1-01}\]
  commutes.
  An equivalence class of monomorphisms with codomain $C$ is called a \emph{subobject} of $C$, and a category is \emph{well-powered} when every object has only a set worth of subobjects.
\end{defn}

Given a category $\iC$ and an object $C \in \iC$, we can consider the class $\mathsf{Mono}(C)$ of monomorphisms with codomain $C$.
We define a preorder on $\mathsf{Mono}(C)$ by $f \preceq g$ when there is a morphism $h : R \to S$ so that $f = g \circ h$, where $f : R \mono C$ and $g : S \mono C$.
Performing quotient on $(\mathsf{Mono}(C),\preceq)$ by the equivalence relation defined in \cref{def:equiv-mono}, one obtains the partially ordered class $\mathsf{Sub}(C)$.
Often, we write a mono $f : R \mono C$ for its equivalence class by abuse of notation.

In this notes, a ``family'' is always indexed by a set.

\subsection{Intersections and Unions}
\label{sec:intersections-and-unions}

\begin{defn}
  Given an object $C \in \iC$.
  The \emph{intersection} of a family of subobjects of $A$ is the infimum of that family in $\mathsf{Sub}(A)$.
  Similarly, the \emph{union} of a family of subobjects of $A$ is the supremum of that family in $\mathsf{Sub}(A)$.
\end{defn}

\begin{prop}\label{prop:sub-set-intersections-unions}
  If $\mathsf{Sub}(A)$ is a set, then the following are equivalent:
  \begin{enumerate}
  \item the intersection of every family of subobjects of $A$ exists;
  \item the union of every family of subobjects of $A$ exists.
  \end{enumerate}
\end{prop}
\begin{proof}
  Let $I$ be a family of subobjects.
  One has
  \begin{align}
    \inf_{I}s_{i} &= \sup\{s \mid \forall i \in I.\,s \preceq s_{i}\}\\
    \sup_{I}s_{i} &= \inf\{s \mid \forall i \in I.\,s_{i} \preceq s\}
  \end{align}
\end{proof}

\begin{prop}
  If $\iC$ has pullbacks, the intersection of two subobjects of the same object $C \in \iC$ is given by their pullback.
\end{prop}
\begin{proof}
  Given two subobjects $f$ and $g$.
  Since monomorphisms are pullback stable and closed under composition, we have another subobject $R \times_{C} S \mono C$.
  \[\input{img/1-02}\]
  The universal property of pullbacks then guarantees that this is the infimum of this family in $\mathsf{Sub}(C)$.
\end{proof}

This result generalizes to an arbitrary family of subobjects.

\begin{prop}\label{prop:complete-intersection}
  If $\iC$ is complete, then the intersection of every family of subobjects is given by their limit.
\end{prop}
\begin{proof}
  Take the limit of the family
  \[\input{img/1-03}\]
  The universal property of limits guarantees that $\bigcap F \mono C$ is the infimum of this family in $\mathsf{Sub}(C)$.
\end{proof}

\begin{cor}
  In a complete and well-powered category, the intersection and union of every family of subobjects of a fixed object always exists.
\end{cor}

\subsection{Strong Epimorphisms}
\label{sec:strong-epimorphisms}

\begin{defn}
  An epimorphism $f : A \epi B$ in a category is \emph{extremal} if it does not factor through any proper subobject of $B$; i.e., any monomorphism $i : C \mono B$ so that the following triangle commutes, is an isomorphism.
  \[\input{img/1-04}\]
\end{defn}

\begin{prop}
  In a category $\iC$,
  \begin{enumerate}
  \item every regular epimorphism is extremal,
  \item if a composite $f \circ g$ is extremal, then $f$ is extremal,
  \item an monic extremal epimorphism is an isomorphism.
  \end{enumerate}
\end{prop}
\begin{proof}
  (i) Suppose that $f = i \circ g$, we wish to show that $i$ is an isomorphism.
  Since $f \circ u = i \circ g \circ u = i \circ g \circ v = f \circ v$ and $i$ is a monomorphism, it follows that $g$ forms a cocone over $u$ and $v$.
  Thus, there is a unique morphism $j$ so that $g = j \circ f$.
  \[\input{img/1-05}\]
  Since $i \circ j \circ f = i \circ g = \id_{B} \circ f$ and $f$ is an epimorphism, $i \circ j = \id_{B}$.
  Since $i$ is a monomorphism with a right inverse, $i$ is an isomorphism.

  (ii) For any commutative triangle $f = i \circ j$, where $i$ is an monomorphism, we extend this triangle by $g$, yielding the following diagram:
  \[\input{img/1-06}\]
  Since $f \circ g$ is extremal, it follows that $i$ is an isomorphism.

  (iii) Consider the following diagram:
  \[\input{img/1-07}\]
  Since $f$ is extremal, $f$ must be an isomorphism.
\end{proof}

\begin{prop}
  In a category $\iC$, if every monic epimorphism is an isomorphism, then every epimorphism is extremal.
\end{prop}
\begin{proof}
  Let $f : A \epi B$, $i : C \mono B$, and $j : A \to C$ such that $f = i \circ j$.
  Since post-composing $i$ with $j$ results in an epimorphism, $i$ is an epimorphism.
  Then the hypothesis demands that $i$ is an isomorphism.
\end{proof}

\begin{defn}
  An epimorphism $f : A \epi B$ is called a \emph{strong epimorphism} when, $f$ has the filling property against any monomorphism, i.e., there is a morphism $w : B \to X$ commuting with the two triangles.
  \[\input{img/1-08}\]
  Note that this arrow is necessarily unique.
\end{defn}

\begin{prop}\label{prop:strong-epimorphism-facts}
  In a category $\iC$,
  \begin{enumerate}
  \item the composite of two strong epimorphisms is a strong epimorphism,
  \item if a composite $f \circ g$ is a strong epimorphism, then $f$ is a strong epimorphism,
  \item a monic strong epimorphism is an isomorphism,
  \item every regular epimorphism is strong,
  \item every strong epimorphism is extremal.
  \end{enumerate}
\end{prop}
\begin{proof}
  (i) Since $f$ is strong, there is a filling $b : B \to X$.
  This filling yields a commutative square $y \circ x \circ b = w \circ g$.
  Since $y \circ x$ is also a monomorphism and $g$ is strong, it follows that there is a filling $c : C \to X$.
  \[\input{img/1-09}\]
  (ii) Given a commutative square $x \circ u = v \circ f$, we extend this square by $g$.
  This yields the following commutative square, and since $f \circ g$ strong, there is a filling $w$ so that $w \circ f \circ g = u \circ g$ and $x \circ w = v$.
  \[\input{img/1-10}\]
  It remains to show that $w \circ f = u$.
  To this end, consider $x \circ w \circ f$.
  \begin{align}
    x \circ w \circ f &= v \circ f\\
                      &= x \circ u
  \end{align}
  Since $x$ is a monomorphism, $w \circ f = u$ follows.

  (iii) Consider the following:
  \[\input{img/1-11}\]
  The filling is clearly the inverse of $f$.
  Thus, $f$ is an isomorphism.

  (iv) Suppose that $x \circ u = v \circ f$.
  Then $x \circ u \circ a = v \circ f \circ a = v \circ f \circ b = x \circ u \circ b$.
  Since $x$ is a monomorphism, it follows that $u$ is a cocone over $a$ and $b$.
  \[\input{img/1-12}\]
  The universal property of coequalizers yields a morphism $w$ that commutes with the lower triangle.
  It remains to check that $x \circ w = v$.
  Since $f$ is an epimorphism, it suffices to check $x \circ w \circ f = v \circ f$.
  \begin{align}
    x \circ w \circ f &= x \circ u\\
                      &= v \circ f
  \end{align}

  (v) Suppose that $f = i \circ j$ with $i$ a monomorphism.
  Since $f$ is strong, there is a filling $w$ such that $i \circ w = \id$.
  Since $i$ is a monomorphism with a right inverse, it is an isomorphism.
  \[\input{img/1-13}\]
\end{proof}

\begin{prop}\label{prop:fcc-strong-epimorphism-facts}
  Let $\iC$ be a finitely complete category.
  \begin{enumerate}
  \item Every morphism with the filling property is a strong epimorphism.
  \item Every morphism with the extremal property is an extremal epimorphism.
  \item An epimorphism is extremal if and only if it is strong.
  \end{enumerate}
\end{prop}
\begin{proof}
  (i) Let $f$ be a morphism with the filling property, i.e., any commutative square against a monomorphism has a unique filling.
  We aim to prove that $f$ is an epimorphism.
  To this end, let $a,b$ be a pair of parallel morphisms so that $a \circ f = b \circ f$.
  The equalizer $E(a,b)$ is a monomorphism against which there is a commutative square depicted as follow:
  \[\input{img/1-14}\]
  Thus, there is a unique filling $w$, corresponding to a unique morphism $A \to A$ that constitute a cone over $a$ and $b$.
  In this case, $w$ corresponds to the identity.
  Thus, $a = b$.

  (ii) Let $f$ be a morphism with the extremal property, i.e., in every commutative triangle $f = i \circ j$ with $i$ a monomorphism, $i$ is an isomorphism.
  We aim to show that $f$ is a epimorphism.
  Let $a,b$ be a pair of parallel morphisms so that $a \circ f = b \circ f$.
  Consider the following equalizer:
  \[\input{img/1-15}\]
  The universal property yields a factorization of $f$.
  Thus, the equalizer $E(a,b)$ is an isomorphism (thus, an epimorphism).
  From $a \circ E(a,b) = b \circ E(a,b)$, we can conclude that $a = b$.

  (iii) The ``only if'' direction: Let $f$ be an extremal epimorphism.
  Assume the commutative square: $x \circ u = v \circ f$.
  Form the pullback of $v$ along $x$ as follows:
  \[\input{img/1-16}\]
  Since monomorphisms are pullback stable, $x'$ is a monomorphism.
  This constitute a factorization of $f$.
  Thus, $x'$ is an isomorphism.
  We can then define $w' = v' \circ {x'}\inv$.
  This is routine to check that this is a filling.

  The ``if'' direction follows immediately from \cref{prop:strong-epimorphism-facts}.
\end{proof}

\begin{prop}\label{prop:stability-pushout}
  In a category $\iC$,
  \begin{enumerate}
  \item strong epimorphisms are stable under pushout,
  \item regular epimorphisms are stable under pushout,
  \end{enumerate}
  whenever the pushouts exist in $\iC$.
\end{prop}
\begin{proof}
  Note that epimorphisms are stable under pushout.
  It remains to show that these epimorphisms are strong (resp., regular).

  (i) Let $f$ be a strong epimorphism.
  We aim to show that $f'$ is a strong epimorphism.
  To this end, let $x \circ u = v \circ f'$ be a commutative diagram.
  \[\input{img/1-17}\]
  Then there is a filling $w$.
  This constitutes a cocone over the pushout diagram.
  Thus, the universal property yields a candidate filling $w'$.
  It remains to check commutativity.
  $w' \circ f' = u$ is immediate.
  To show that $x \circ w' = v$, push the cocone $u,w$ out by $x$.
  Now, it suffices to show that $v$ factors through the legs, i.e., $v \circ h' = x \circ w$ and $v \circ f' = x \circ u$.
  The latter equation is immediate by assumption.
  To show the former, consider $v \circ h' \circ f$.
  \begin{align}
    v \circ h' \circ f &= x \circ u \circ h\\
                       &= x \circ w \circ f
  \end{align}
  Since $f$ is an epimorphism, the former equation follows.

  (ii) Now assume that $f$ is a regular epimorphism.
  The pushout of $f$ along $h$ is an epimorphism $f'$.
  Particularly, $f'$ is a cocone under the parallel pair $h \circ a$ and $h \circ b$.
  For any $x$ that forms a cocone under the same pair, the universal property of coequalizers guarantees a morphism $y$ so that $y \circ f = x \circ h$.
  Then the universal property for pushouts gives a morphism $w$.
  \[\input{img/1-18}\]
  This proves that $f'$ is a weak coequalizer.
  Since $w$ uniquely corresponds to $y$, it follows that $w$ is unique.
  Thus, $f'$ is a coequalizer.
\end{proof}

\begin{prop}
  Left adjoints preserve strong (resp., regular) epimorphisms and right adjoints preserve strong (resp., regular) monomorphisms.
\end{prop}
\begin{proof}
  Since left adjoints preserve colimits and right adjoints preserve limits, preservation of regular epimorphisms (resp., monomorphisms) is evident.
  It suffices to prove that left adjoints preserve strong epimorphisms.
  Preservation of strong monomorphisms follows at once by duality.

  Let $F \adj G$ and $f$ be a strong epimorphism in the domain of $F$.
  $Ff$ is an epimorphism and we wish to prove that it is strong.
  Let $v \circ Ff = x \circ u$ be a commutative square.
  This commutative square corresponds to the commutative square on the left.
  Note that $Gx$ is a monomorphism because right adjoints preserve monomorphisms.
  \begin{mathpar}
    \input{img/1-19} \and \input{img/1-20}
  \end{mathpar}
  Since $f$ is a strong monomorphism, it has a filling $w$.
  The transpose $w^{\dagger}$ is the sought after filling.
\end{proof}

\subsection{Epi-Mono Factorization}
\label{sec:epi-mono-factorization}

\begin{defn}
  A category $\iC$ is \emph{finitely well-complete} when
  \begin{enumerate}
  \item $\iC$ is finitely complete;
  \item for any object $C \in \iC$, the intersection of an arbitrary class of subobjects of $C$ exists.
  \end{enumerate}
\end{defn}

\begin{prop}
  \begin{enumerate}
  \item[]
  \item A complete and well-powered category is finitely well-complete.
  \item A finitely complete category where every object has just finitely many subobjects is finitely well-complete.
  \end{enumerate}
\end{prop}
\begin{proof}
  \begin{enumerate}
  \item[]
  \item \cref{prop:sub-set-intersections-unions}.
  \item \cref{prop:complete-intersection}.
  \end{enumerate}
\end{proof}

\begin{prop}
  In a finitely well-complete category, every morphism $f$ factorizes as $f = i \circ p$ where $i$ is a monomorphism and $p$ is a strong epimorphism.
\end{prop}
\begin{proof}
  Let $f : A \to B$ be a morphism.
  Let $i_{k} \in \mathsf{Sub}(B)$ be a family of subobjects of $B$ so that there is a morphism $p_{k}$ such that $f = i_{k} \circ p_{k}$.
  Any choice of $p_{k}$'s constitutes a cone over $\{i_{k}\}$ so that $f = i_{k} \circ p_{k}$.
  Consider the intersection of $\{i_{k}\}$.
  The universal property of limits gives a morphism $p$ so that $i \circ p = f$.
  \[\input{img/1-21}\]
  Additionally, $p$ is extremal since its codomain is an infimum of the family $\{i_{k}\}$.
  Thus, by \cref{prop:fcc-strong-epimorphism-facts}, $p$ is a strong epimorphism.
\end{proof}

\begin{defn}
  A category has \emph{strong-epi-mono factorizations} if every morphism $f$ factorizes as $f = i \circ p$ with $i$ a monomorphism and $p$ a strong epimorphism.
  The monomorphism $i$ is called the \emph{image} of $f$.
\end{defn}

\begin{prop}\label{prop:semf-facts}
  Let $\iC$ be a category with strong-epi-mono factorizations.
  \begin{enumerate}
  \item The strong-epi-mono factorization of an arrow is unique up to an isomorphism.
  \item Given any pair of strong-epi-mono factorizations $(i,p)$ and $(i',p')$ and morphisms $u, v$ so that $v \circ i \circ p = i' \circ p' \circ u$, there is a unique morphism $h : A \to B$ between the middle points of the strong-epi-mono factorizations making the entire diagram commute.
  \item If $h = i \circ p$ is a strong-epi-mono factorization and $h = k \circ r$, where $k$ is a monomorphism, there is a unique $t$ such that $r = t \circ p$, $i = k \circ t$.
  \end{enumerate}
\end{prop}
\begin{proof}
  \begin{enumerate}
  \item[]
  \item Let $f = i \circ p = i' \circ p'$.
    Since $p$ and $p'$ are strong epimorphisms, we have the following:
    \[\input{img/1-22}\]
    Clearly, the two dashed morphisms are mutual inverses.
  \item Consider the following diagram:
    \[\input{img/1-23}\]
  \item Consider the following diagram:
    \[\input{img/1-24}\]
  \end{enumerate}
\end{proof}

\begin{prop}
  Let $\iC$ be a category with pullbacks and strong-epi-mono factorizations.
  Given a morphism $f : A \to B$ and writing $\mathsf{Str}(A)$ and $\mathsf{Str}(B)$ for the posets of strong subobjects, the inverse image functor
  \[
    f\inv : \mathsf{Str}(B) \to \mathsf{Str}(A)
  \]
  is right adjoint to the direct strong image functor
  \[
    f_{*} : \mathsf{Str}(A) \to \mathsf{Str}(B)
  \]
  In other words, $f_{*} \adj f\inv$ is a Galois connection.
\end{prop}
\begin{proof}
  Given a strong subobject of $B$, by the dual of \cref{prop:stability-pushout}, the pullback along $f$ is a strong subobject of $A$.
  This defines $f\inv$.
  Now, given a strong subobject $A'$ of $A$, by hypothesis, $f \circ A' = i \circ p$ has a strong-epi-mono factorization.
  To show that $i$ is a strong subobject, consider any commutative diagram against an epimorphism.
  \[\input{img/1-25}\]
  Since $A'$ is strong, there is a filling $w$, whose composition with $p$ is the sought-after filling.

  Now, Let $A'$ and $B'$ be strong subobjects of $A$ and $B$, respectively.
  If $A' \subseteq f\inv(B')$, then there is a comparison morphism $A' \to f\inv(B')$.
  $f \circ a'$ admits a strong-epi-mono factorization.
  Note that this factorization commutes with the path $A' \to f\inv(B') \to B' \to B$.
  Thus, \cref{prop:semf-facts} gives a comparison morphism $f_{*}(A') \to B'$.
  \[\input{img/1-27}\]
  Conversely, if $f_{*}(A') \subseteq B'$, then there is a morphism $f_{*}(A') \to B'$ that factors through the bottom monomorphism $f_{*}(A') \to B$.
  The universal property of pullbacks gives a comparison morphism $A' \to f\inv(B')$.
  \[\input{img/1-26}\]
\end{proof}

\subsection{Generators}
\label{sec:generators}

\begin{defn}
  Let $\iC$ be a category.
  A family $(G_{i})_{i \in I}$ of objects of $\iC$ is a family of \emph{generators} when, for any pair of parallel morphisms $u, v : A \toto B$
  \[
    (\forall f : G_{i} \to A.\,u \circ f = v \circ f) \imp u = v
  \]
\end{defn}

In some categories, every object is a quotient of a coproduct of generators.
\begin{prop}\label{prop:coproduct-generators-epimorphism}
  Let $\iC$ be a category with coproducts and $(G_{i})_{i \in I}$ a family of objects of $\iC$.
  The following are equivalent:
  \begin{enumerate}
  \item $(G_{i})_{i \in I}$ is a family of generators;
  \item for every object $C \in \iC$, the unique morphism
    \[
      \gamma_{C} : \coprod_{i \in I, f \in \iC(G_{i}, C)} \dom(f) \to C
    \]
    is an epimorphism and $\gamma_{C} \circ \iota_{f} = f$.
  \end{enumerate}
\end{prop}
\begin{proof}
  Suppose that $(G_{i})_{i \in I}$ is a family of generators.
  Let $u,v : C \toto D$ be a parallel pair of morphisms such that $u \circ \gamma_{C} = v \circ \gamma_{C}$.
  We need to prove $u = v$.
  Since $(G_{i})_{i \in I}$ is a family of generators, it suffices to prove that $\forall g : G_{i} \to C.\,u \circ g = v \circ g$.
  \begin{align}
    u \circ g &= u \circ \gamma_{C} \circ \iota_{g}\\
          &= v \circ \gamma_{C} \circ \iota_{g}\\
          &= v \circ g
  \end{align}

  Conversely, suppose that $\gamma_{C}$ is an epimorphism for each $C \in \iC$.
  Let $u,v : C \toto D$ be a parallel pair of morphisms.
  Suppose that $\forall f : G_{i} \to C.\, u \circ f = v \circ f$.
  We need to show that $u = v$.
  By hypothesis, $u \circ \gamma_{C} \circ \iota_{C} = v \circ \gamma_{C} \circ \iota_{C}$.
  Thus, $u \circ \gamma_{C} = v \circ \gamma_{C}$ by the universal property of coproducts.
  Since $\gamma_{C}$ is an epimorphism, $u = v$.
\end{proof}

Observe that when a category $\iC$ has coproducts and a regular family of generators $(G_{i})_{i \in I}$, then every object $\iC$ can be presented as a coequalizer of a pair of parallel morphisms between coproducts of generators.
Since $\gamma_{P}$ is an epimorphism, $\gamma_{C}$ is the cokernel of the pair $u \circ \gamma_{P}$ and $v \circ \gamma_{P}$.
\[\input{img/1-28}\]

\subsection{Projectives}
\label{sec:projectives}

\begin{defn}
  An object $P$ of a category $\iC$ is \emph{projective} when, given an epimorphism $p : A \to B$ and a morphism $f : P \to B$, there is a factorization $g : P \to A$ such that $p \circ g = f$.
  If $\iC$ is locally small, then an equivalent definition is that $P$ is projective when the representable functor $\iC(P,\blank)$ preserves epimorphisms.
\end{defn}

\begin{prop}\label{prop:coproduct-of-projectives-projective}
  A coproduct of projective objects is a projective object.
  The converse holds when the category has a zero object.
\end{prop}
\begin{proof}
  Given any epimorphism $p$ and morphism $f$, the compositions of $f$ with those injections yield morphisms to the codomain of $p$.
  Projectivity then implies that there is a cocone with nadir $\dom(p)$.
  The universal property of coproducts then yields the desired map.
  \[\input{img/1-29}\]
\end{proof}

\begin{prop}
  A retract of a projective is a projective.
\end{prop}
\begin{proof}
  Given any morphism $f$, the composition with a section $s$ of $r$ yields a morphism $g$.
  Since $P$ is projective, there is a morphism $t$.
  The composition of this morphism with the section $s$ yields the required morphism $w$.
  \[\input{img/1-30}\]
\end{proof}

\begin{defn}
  A category $\iC$ \emph{has enough projectives} when for every object $A$, there is a projective $P$ and an epimorphism $P \epi A$.
\end{defn}

\begin{prop}
  Let $\iC$ be a category with coproducts.
  If $\iC$ has a set of projective generators, then $\iC$ has enough projectives.
\end{prop}
\begin{proof}
  By \cref{prop:coproduct-generators-epimorphism}, the canonical morphism $\coprod G_{i} \epi C$ is an epimorphism.
  By \cref{prop:coproduct-of-projectives-projective}, $\coprod G_{i}$ is projective.
\end{proof}

\section{Abelian Categories}
\label{sec:abelian-categories}

\begin{defn}
  \label{defn:abelian-categories}
  A category $\iC$ is \emph{abelian} when
  \begin{enumerate}
  \item $\iC$ has a zero object;
  \item every pair of objects of $\iC$ has a product and a coproduct;
  \item every arrow of $\iC$ has a kernel and a cokernel;
  \item every monomorphism of $\iC$ is a kernel; every epimorphism of $\iC$ is a cokernel.
  \end{enumerate}
\end{defn}

\begin{rmk}
  \label{defn:abelian-categories-self-dual}
  The notion of abelian categories is self-dual, i.e., the dual of an abelian category is again an abelian category.
\end{rmk}

\begin{prop}
  \label{prop:abelian-categories-monic-epimorphism-is-isomorphism}
  In an abelian category every monic epimorphism is an isomorphism.
\end{prop}
\begin{proof}
  Let $f : A \to B$ be a monic epimorphism.
  Since $f$ is the cokernel of some morphism, it is a regular epimorphism.
  The result follows by applying \cref{prop:strong-epimorphism-facts}.
\end{proof}

\section{Retractions are regular epimorphisms}
\label{sec:retractions-are-regular-epimorphisms}

\begin{prop}
  \label{prop:retractions-are-regular-epimorphisms}
  In any category $\iC$, a retraction $r : A \epi B$ is a regular epimorphism.
  Specifically, a retraction $r : A \epi B$ is the coequalizer of the pair $(sr,\id_{A})$, where $s$ is a section of $r$.
\end{prop}
\begin{proof}
  \begin{node}
    By calculation, $r$ forms a cocone under the pair $(sr,\id_{A})$.
    For any cocone $f$ under the same pair, $fs$ is an obvious factorization.
    Since $r$ is an epimorphism, any morphism factoring through $f$ must coincide with $fs$.
  \end{node}
  \[
    % https://q.uiver.app/#q=WzAsNCxbMCwwLCJBIl0sWzIsMCwiQSJdLFs0LDAsIkIiXSxbNCwyLCJDIl0sWzAsMSwic3IiLDAseyJvZmZzZXQiOi0xfV0sWzAsMSwiXFxpZF97QX0iLDIseyJvZmZzZXQiOjF9XSxbMSwyLCJyIiwyLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoiZXBpIn19fV0sWzIsMSwicyIsMix7ImN1cnZlIjoyLCJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzEsMywiZiIsMl0sWzIsMywiZnMiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XV0=
    \begin{tikzcd}
      A && A && B \\
      \\
      &&&& C
      \arrow["sr", shift left, from=1-1, to=1-3]
      \arrow["{\id_{A}}"', shift right, from=1-1, to=1-3]
      \arrow["r"', two heads, from=1-3, to=1-5]
      \arrow["s"', curve={height=12pt}, tail, from=1-5, to=1-3]
      \arrow["f"', from=1-3, to=3-5]
      \arrow["fs", dashed, from=1-5, to=3-5]
    \end{tikzcd}
  \]
\end{proof}

\section{Regular Categories}
\label{sec:regular-categories}

\begin{notn}
  The symbol $\epi$ is reserved for regular epimorphism in this section.
\end{notn}

\begin{defn}
  \label{defn:regular-categories}
  A category $\iC$ is \emph{regular} when it satisfies the following conditions:
  \begin{enumerate}
  \item every arrow has a kernel pair;
  \item every kernel pair has a coequalizer;
  \item\label{itm:regular-categories-axiom-3}
    the pullback of a regular epimorphism along any morphism exists and is also a regular epimorphism.
  \end{enumerate}
\end{defn}

\begin{lem}
  \label{lem:regular-categories-factorization}
  In a regular category $\iC$, consider a regular epimorphism $f : A \epi B$ and an arbitrary morphism $g : B \to C$.
  The factorization
  \[
    f \times_{C} f : A \times_{C} A \to B \times_{C} B
  \]
  exists and is an epimorphism.
\end{lem}
\begin{proof}
  Take the pullback of $g$ along itself.
  This yields the kernel pair of $g$.
  Since $f$ is a regular epimorphism, the pullback of $f$ along the kernel pairs of $g$ yields two regular epimorphisms $u$ and $v$.
  The pullback of $u$ along $v$ then yields two regular epimorphisms $x$ and $y$.
  Thus, we define $f \times_{C} f := u \circ y$, and since it is the composition of two epimorphisms it is itself an epimorphism.
  \[
    % https://q.uiver.app/#q=WzAsOSxbMiw0LCJCIl0sWzQsNCwiQyJdLFs0LDIsIkIiXSxbMiwyLCJCIFxcdGltZXNfe0N9IEIiXSxbMCw0LCJBIl0sWzAsMiwiXFxidWxsZXQiXSxbNCwwLCJcXGJ1bGxldCJdLFsyLDAsIlxcYnVsbGV0Il0sWzAsMCwiQSBcXHRpbWVzX3tDfSBBIl0sWzAsMSwiZyIsMl0sWzIsMSwiZyJdLFszLDBdLFszLDJdLFszLDEsIiIsMCx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dLFs0LDAsImYiLDIseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJlcGkifX19XSxbNSw0XSxbNSwzLCJ2IiwwLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoiZXBpIn19fV0sWzYsMiwiZiIsMCx7InN0eWxlIjp7ImhlYWQiOnsibmFtZSI6ImVwaSJ9fX1dLFs3LDMsInUiLDIseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJlcGkifX19XSxbNyw2XSxbNSwwLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XSxbNywyLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XSxbOCw3LCJ5IiwwLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoiZXBpIn19fV0sWzgsNSwieCIsMix7InN0eWxlIjp7ImhlYWQiOnsibmFtZSI6ImVwaSJ9fX1dLFs4LDMsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
    \begin{tikzcd}
      {A \times_{C} A} && \bullet && A \\
      \\
      \bullet && {B \times_{C} B} && B \\
      \\
      A && B && C
      \arrow["g"', from=5-3, to=5-5]
      \arrow["g", from=3-5, to=5-5]
      \arrow[from=3-3, to=5-3]
      \arrow[from=3-3, to=3-5]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=3-3, to=5-5]
      \arrow["f"', two heads, from=5-1, to=5-3]
      \arrow[from=3-1, to=5-1]
      \arrow["v", two heads, from=3-1, to=3-3]
      \arrow["f", two heads, from=1-5, to=3-5]
      \arrow["u"', two heads, from=1-3, to=3-3]
      \arrow[from=1-3, to=1-5]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=3-1, to=5-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-3, to=3-5]
      \arrow["y", two heads, from=1-1, to=1-3]
      \arrow["x"', two heads, from=1-1, to=3-1]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
    \end{tikzcd}
  \]
\end{proof}

\begin{thm}
  \label{thm:regular-categories-factorization}
  In a regular category, every morphism factors as a regular epimorphism followed by a monomorphism and this factorization is unique up to isomorphism.
\end{thm}
\begin{proof}
  Let $f : A \to B$ be an arbitrary morphism.
  Consider the coequalizer of the kernel pair $(u,v)$ of $f$.
  \[
    % https://q.uiver.app/#q=WzAsNCxbMCwwLCJBIFxcdGltZXNfe0J9IEEiXSxbMiwwLCJBIl0sWzQsMiwiQiJdLFs0LDAsIlxcYnVsbGV0Il0sWzAsMSwidiIsMix7Im9mZnNldCI6MX1dLFswLDEsInUiLDAseyJvZmZzZXQiOi0xfV0sWzEsMywiayIsMCx7InN0eWxlIjp7ImhlYWQiOnsibmFtZSI6ImVwaSJ9fX1dLFsxLDIsImYiLDJdLFszLDIsImkiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XV0=
    \begin{tikzcd}
      {A \times_{B} A} && A && Q \\
      \\
      &&&& B
      \arrow["v"', shift right, from=1-1, to=1-3]
      \arrow["u", shift left, from=1-1, to=1-3]
      \arrow["k", two heads, from=1-3, to=1-5]
      \arrow["f"', from=1-3, to=3-5]
      \arrow["i", dashed, from=1-5, to=3-5]
    \end{tikzcd}
  \]
  By the universal property of coequalizers, $f$ admits a factorization as a regular epimorphism $k$ followed by some morphism $i$.
  It remains to prove that $i$ is a monomorphism.
  Let $(x,y)$ be the kernel pair of $i$.
  Recall that $i$ is a monomorphism if and only if $x = y$.
  Since $k$ is a regular epimorphism, we can apply \cref{lem:regular-categories-factorization} to $k$.
  This yields an epimorphism $t : A \times_{B} A \to Q \times_{B} Q$ such that $xt = ku$ and $yt = kv$.
  \[
    % https://q.uiver.app/#q=WzAsNyxbMiw0LCJRIl0sWzQsNCwiQiJdLFs0LDIsIlEiXSxbMiwyLCJRXFx0aW1lc197Qn1RIl0sWzAsNCwiQSJdLFs0LDAsIkEiXSxbMCwwLCJBIFxcdGltZXNfe0J9IEEiXSxbMCwxLCJpIiwyXSxbMiwxLCJpIl0sWzMsMCwieCIsMl0sWzMsMiwieSJdLFszLDEsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dLFs0LDAsImsiLDIseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJlcGkifX19XSxbNSwyLCJrIiwwLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoiZXBpIn19fV0sWzYsNCwidSIsMl0sWzYsNSwidiJdLFs2LDMsInQiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifSwiaGVhZCI6eyJuYW1lIjoiZXBpIn19fV1d
    \begin{tikzcd}
      {A \times_{B} A} &&&& A \\
      \\
      && {Q\times_{B}Q} && Q \\
      \\
      A && Q && B
      \arrow["i"', from=5-3, to=5-5]
      \arrow["i", from=3-5, to=5-5]
      \arrow["x"', from=3-3, to=5-3]
      \arrow["y", from=3-3, to=3-5]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=3-3, to=5-5]
      \arrow["k"', two heads, from=5-1, to=5-3]
      \arrow["k", two heads, from=1-5, to=3-5]
      \arrow["u"', from=1-1, to=5-1]
      \arrow["v", from=1-1, to=1-5]
      \arrow["t", dashed, two heads, from=1-1, to=3-3]
    \end{tikzcd}
  \]
  Since $k$ coequalizes $u$ and $v$, we have $xt = yt$.
  Since $t$ is an epimorphism, $x = y$.
  $(k,i)$ constitutes a regular-epi-mono factorization of $f$.
  Since every regular epimorphism is a strong epimorphism (\cref{prop:strong-epimorphism-facts}), $(k,i)$ also constitutes a strong-epi-mono factorization.
  Thus, \cref{prop:semf-facts} proves the uniqueness of regular-epi-mono factorization.
\end{proof}

\begin{prop}
  \label{prop:regular-categories-regular-epimorphism-iff-strong-epimorphism}
  In a regular category, the following conditions are equivalent:
  \begin{enumerate}
  \item $f$ is a regular epimorphism;
  \item $f$ is a strong epimorphism.
  \end{enumerate}
\end{prop}
\begin{proof}
  (``only if''): This is proved in \cref{prop:strong-epimorphism-facts}.

  (``if''): Let $f$ be a strong epimorphism.
  By \cref{thm:regular-categories-factorization}, $f$ admits a regular-epi-mono factorization.
  \[
    % https://q.uiver.app/#q=WzAsNCxbMCwyLCJcXGJ1bGxldCJdLFsyLDIsIlxcYnVsbGV0Il0sWzAsMCwiXFxidWxsZXQiXSxbMiwwLCJcXGJ1bGxldCJdLFswLDEsImYiLDIseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJlcGkifX19XSxbMiwzLCJpIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibW9ubyJ9fX1dLFswLDIsImsiLDAseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJlcGkifX19XSxbMSwzLCIiLDEseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsxLDIsInciLDIseyJjdXJ2ZSI6MSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzIsMSwidCIsMix7ImN1cnZlIjoxLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XV0=
    \begin{tikzcd}
      \bullet && \bullet \\
      \\
      \bullet && \bullet
      \arrow["f"', two heads, from=3-1, to=3-3]
      \arrow["i", tail, from=1-1, to=1-3]
      \arrow["k", two heads, from=3-1, to=1-1]
      \arrow[Rightarrow, no head, from=3-3, to=1-3]
      \arrow["w"', curve={height=6pt}, dashed, from=3-3, to=1-1]
      \arrow["t"', curve={height=6pt}, dashed, from=1-1, to=3-3]
    \end{tikzcd}
  \]
  Since $f$ is strong, it admits a lifting $w$.
  Similarly, since $k$ is regular (thus strong), it admits a lifting $t$.
  $w$ and $t$ are mutual inverses.
  Thus, $f$ is a coequalizer of some parallel pair of morphisms.
\end{proof}

\begin{cor}
  In a regular category:
  \begin{enumerate}
  \item the composite of two regular epimorphisms is a regular epimorphism;
  \item if a composite $f \circ g$ is a regular epimorphism, $f$ is a regular epimorphism;
  \item a morphism which is both a regular epimorphism and a monomorphism is an isomorphism.
  \end{enumerate}
\end{cor}
\begin{proof}
  In a regular category, strong epimorphisms and regular epimorphisms coincide.
  Thus, \cref{prop:strong-epimorphism-facts} applies.
\end{proof}

\subsection{Relations}
\label{sec:regular-categories-relations}

\begin{node}
  \label{node:relations-motivation}
  A relation $R$ on a set $A$ is a subset $R \subseteq A \times A$, i.e., a subobject $r : R \mono A \times A$.
  Postcomposition with the projections yields a pair of morphisms:
  \[
    \pi_{1}r, \pi_{2}r : R \toto A
  \]
\end{node}

\begin{defn}
  \label{defn:relations}
  A \emph{relation} on an object $A$ of a category $\iC$ is an object $R \in \iC$ with a pair of jointly monomorphic morphisms $r_{1},r_{2} : R \toto A$.
  For each object $X \in \iC$ we write
  \[
    R_{X} = \Set{ (r_{1}x, r_{2}x) \mid x \in \iC(X,R) }
  \]
  We use this notation as a shorthand for the following:
  \[
    R_{X} = \Set{ (y, z) \mid \exists x \in \iC(X,R).\,y = r_{1}x \land z = r_{2}x }
  \]
  for the (set-theoretic) relation generated by $R$ on the set $\iC(X,A)$.
\end{defn}

\begin{defn}
  \label{defn:effective-equivalence-relations}
  An equivalence relation $(R,r_{1},r_{2})$ on an object $A$ of a category $\iC$ is \emph{effective} when the coequalizer $q$ of $(r_{1},r_{2})$ exists and $(r_{1},r_{2})$ is the kernel pair of $q$.
\end{defn}

\begin{prop}
  \label{prop:equivalence-relation-characterizations}
  In a category admitting pullbacks of strong epimorphisms.
  A relation $(R,r_{1},r_{2})$ on an object $A$ is an equivalence relation if and only if the followings exist:
  \begin{enumerate}
  \item a morphism $\delta : A \to R$ such that $r_{1}\delta = \id_{A}$ and $r_{2}\delta = \id_{A}$;
  \item a morphism $\sigma : R \to R$ such that $r_{1}\sigma = r_{2}$ and $r_{2}\sigma = r1$;
  \item a morphism $\tau : R \times_{A} R \to R$ such that $r_{1}\tau = r_{1}\rho_{1}$ and $r_{2}\tau = r_{2}\rho_{2}$, where $\rho_{1}$ and $\rho_{2}$ are the pullback of $r_{1}$ and $r_{2}$.
  \end{enumerate}
  Additionally, these morphisms are unique.
\end{prop}
\begin{proof}
  \begin{enumerate}
  \item[]
  \item\label{prop:equivalence-relation-characterizations-refl}
    Suppose that $(R,r_{1},r_{2})$ is an equivalence relation on $A$.
    Then the relation $R_{A} = \{(r_{1}x,r_{2}x) \mid x \in \iC(A,R)\}$ on $\iC(A,A)$ is reflexive.
    Thus, $(\id_{A},\id_{A}) \in R_{A}$.
    There is a morphism $\delta : A \to R$ such that $r_{1}\delta = \id_{A} = r_{2}\delta$.
    Conversely, assume the existence of such a morphism $\delta$.
    Then for any object $X \in \iC$ and any morphism $x \in \iC(X,A)$, one has
    \begin{mathpar}
      x = r_{1}\delta x \and x = r_{2}\delta x
    \end{mathpar}
    Thus, $(x,x) \in R_{A}$.
  \item Assume that $(R,r_{1},r_{2})$ is an equivalence relation.
    Then $R_{R}$ is an equivalence relation on the set $\iC(R,A)$.
    Note that $(r_{1}\id_{R},r_{2}\id_{R}) = (r_{1},r_{2}) \in R_{R}$.
    Symmetry implies that there is a morphism $\sigma : R \to R$ with the desired property.
    Conversely, assume that $\sigma : R \to R$ exists.
    Then for any $X \in \iC$, assume $(r_{1}x,r_{2}x) \in R_{X}$.
    Then we also have $(r_{1}\sigma x,r_{2}\sigma x) = (r_{2}x,r_{1}x) \in R_{X}$.
  \item
    \begin{node}
      By \ref{prop:equivalence-relation-characterizations-refl}, there is a morphism $\delta : A \to R$ such that $r_{1}\delta = r_{2}\delta = \id_{A}$.
      This implies that $r_{1}$ and $r_{2}$ are retractions.
      By \cref{prop:retractions-are-regular-epimorphisms,prop:strong-epimorphism-facts}, $r_{1}$ and $r_{2}$ are strong epimorphisms.
      Thus, by hypothesis the following pullback diagram exists.
      \[
        % https://q.uiver.app/#q=WzAsNCxbMCwyLCJSIl0sWzIsMiwiQSJdLFsyLDAsIlIiXSxbMCwwLCJSIFxcdGltZXNfe0F9IFIiXSxbMCwxLCJyX3sxfSIsMl0sWzIsMSwicl97Mn0iXSxbMywyLCJcXHJob197MX0iXSxbMywwLCJcXHJob197Mn0iLDJdLFszLDEsIiIsMSx7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
        \begin{tikzcd}
          {R \times_{A} R} && R \\
          \\
          R && A
          \arrow["{r_{1}}"', from=3-1, to=3-3]
          \arrow["{r_{2}}", from=1-3, to=3-3]
          \arrow["{\rho_{1}}", from=1-1, to=1-3]
          \arrow["{\rho_{2}}"', from=1-1, to=3-1]
          \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
        \end{tikzcd}
      \]
    \end{node}
    \begin{node}
      Assume that $(R,r_{1},r_{2})$ is an equivalence relation.
      We need to construct a morphism $\tau : R \times_{A} R \to R$.
      Consider the equivalence relation $R_{R \times_{A} R}$ on the set $\iC(R \times_{A} R, A)$.
      By definition, $(r_{1}\rho_{1},r_{2}\rho_{1})$ and $(r_{1}\rho_{2},r_{2}\rho_{2})$ are in the relation $R_{R \times_{A} R}$.
      Since $r_{1}\rho_{2} = r_{2}\rho_{1}$, transitivity demands that $(r_{1}\rho_{1},r_{2}\rho_{2}) \in R_{R \times_{A} R}$, which then implies that there is a morphism $\tau : R \times_{A} R \to R$ with the desired equations.
    \end{node}
    \begin{node}
      Conversely, assume the existence of $\tau$.
      Then for any $X \in \iC$, assume that $(r_{1}x,r_{2}x) \in R_{X}$ and $(r_{1}y,r_{2}y) \in R_{X}$, where $r_{2}x = r_{1}y$.
      This data defines a cone over the span $(r_{1},r_{2})$:
      \[
        % https://q.uiver.app/#q=WzAsNSxbMSwzLCJSIl0sWzMsMywiQSJdLFszLDEsIlIiXSxbMSwxLCJSIFxcdGltZXNfe0F9IFIiXSxbMCwwLCJYIl0sWzAsMSwicl97MX0iLDJdLFsyLDEsInJfezJ9Il0sWzMsMiwiXFxyaG9fezF9Il0sWzMsMCwiXFxyaG9fezJ9IiwyXSxbMywxLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XSxbNCwwLCJ5IiwyLHsiY3VydmUiOjJ9XSxbNCwyLCJ4IiwwLHsiY3VydmUiOi0yfV0sWzQsMywidSIsMSx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==
        \begin{tikzcd}
          X \\
          & {R \times_{A} R} && R \\
          \\
          & R && A
          \arrow["{r_{1}}"', from=4-2, to=4-4]
          \arrow["{r_{2}}", from=2-4, to=4-4]
          \arrow["{\rho_{1}}", from=2-2, to=2-4]
          \arrow["{\rho_{2}}"', from=2-2, to=4-2]
          \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-2, to=4-4]
          \arrow["y"', curve={height=12pt}, from=1-1, to=4-2]
          \arrow["x", curve={height=-12pt}, from=1-1, to=2-4]
          \arrow["u"{description}, dashed, from=1-1, to=2-2]
        \end{tikzcd}
      \]
      By construction, $(r_{1}\tau u,r_{2}\tau u) = (r_{1}\rho_{1}u,r_{2}\rho_{2}u) = (r_{1}x,r_{2}y) \in R_{X}$.
    \end{node}
    \begin{node}
      Any morphisms $\delta'$, $\sigma'$, and $\tau'$ satisfying the same properties as $\delta$, $\sigma$, and $\tau$ also satisfy the following equations:
      \begin{mathpar}
        r_{1}\delta = r_{1}\delta' \and r_{2}\delta = r_{2}\delta' \and
        r_{1}\sigma = r_{1}\sigma' \and r_{2}\sigma = r_{2}\sigma' \and
        r_{1}\tau = r_{1}\tau' \and r_{2}\tau = r_{2}\tau'
      \end{mathpar}
      Since $r_{1}$ and $r_{2}$ are jointly monomorphic, we conclude that $\delta = \delta'$, $\sigma = \sigma'$, and $\tau = \tau'$.
    \end{node}
  \end{enumerate}
\end{proof}

\section{Exact categories}
\label{sec:exact-categories}

\begin{defn}
  \label{defn:exact-categories}
  An \emph{exact category} is a \hyperref[defn:regular-categories]{regular category} in which equivalence \hyperref[defn:relations]{relations} are \hyperref[defn:effective-equivalence-relations]{effective}.
\end{defn}

\section{Universal algebra}
\label{sec:universal-algebra}

\begin{defn}
  \label{defn:universal-algebra-presentation}
  A \emph{presentation} $\dP$ of an algebraic theory $\cT$ is a theory with equality specified by three components:
  \begin{enumerate}
  \item a denumerable set of variables: $x, y, z, \ldots$;
  \item for each $n \in \dN$, a set $\cO_{n}$ of $n$-ary function symbols;
  \item a set of axioms.
  \end{enumerate}
  The axioms are equalities between \emph{terms}, which are defined inductively as follows:
  \begin{enumerate}
  \item variables are terms;
  \item if $f$ is an $n$-ary function symbol and $t_{1},\ldots,t_{n}$ are terms, then $f(t_{1},\ldots,t_{n})$ is a term.
  \end{enumerate}
  A nullary function symbol is also called a \emph{constant}.
\end{defn}

\todo{Ivan's Lec3 notes: A variety is a cocomplete category with a dense generator made of finitely projective objects}

\begin{defn}
  \label{defn:universal-algebra-models}
  Let $\dP$ be a presentation.
  A \emph{model} of $\dP$ consists of the following data:
  \begin{enumerate}
  \item a set $M$;
  \item for each $n \in \dN$ and $f \in \cO_{n}$, a function $\fhat : M^{n} \to M$.
  \end{enumerate}
  subject to the condition that axioms of $\dP$ are realized by this interpretation, i.e., when
  \begin{enumerate}
  \item each variable is interpreted as any element of $M$;
  \item for each $n \in \dN$, $f \in \cO_{n}$, and terms $t_{1},\ldots,t_{n}$ with interpretations $\that_{1},\ldots,\that_{n}$, the term $f(t_{1},\ldots,t_{n})$ is interpreted as $\fhat(\that_{1},\ldots,\that_{n})$, then
  \end{enumerate}
  all the equations of $\dP$ hold for every possible interpretation of the variables.
\end{defn}

\begin{defn}
  \label{defn:universal-algebra-homomorphisms}
  Let $\dP$ be a presentation, and $\sM$ and $\sM'$ be models of $\dP$.
  A \emph{homomorphism} $\sM \to \sM'$ is a function $\varphi : M \to M'$ such that
  \[
    \fhat(\varphi(x_{1}),\ldots,\varphi(x_{n}))) = \varphi(\fhat(x_{1},\ldots,x_{n}))
  \]
  for all $n \in \dN$, $f \in \cO_{n}$, and $x_{1},\ldots,x_{n} \in M$.
\end{defn}

\begin{lem}
  \label{lem:universal-algebra-varieties}
  Let $\dP$ be a presentation of an algebraic theory.
  The models of $\dP$ and their homomorphisms constitute a category, denoted $\Mod_{\dP}$.
\end{lem}
\begin{proof}
  \begin{node}
    $\Mod_{\dP}$ inherits its categorical structure from ordinary identity functions and function compositions.
  \end{node}
\end{proof}

\begin{node}
  \label{node:universal-algebra-cong}
  Given a presentation $\dP$, we inductively define a congruence relation $\cng$ on the set of $\dP$-terms as follows:
  for any terms $s$ and $t$,
  \begin{enumerate}
  \item\label{node:universal-algebra-cong-1}
    if $s = t$ holds in every model, then $s \cng t$;
  \item\label{node:universal-algebra-cong-2}
    if $s \cng t$ then for any $n \in \dN$ and any terms $u_{1},\ldots,u_{n}$ and any variables $x_{1},\ldots,x_{n}$,
    \[
      s[u_{1},\ldots,u_{n}/x_{1},\ldots,x_{n}] \cng t[u_{1},\ldots,u_{n}/x_{1},\ldots,x_{n}]
    \]
  \item\label{node:universal-algebra-cong-3}
    for any $n \in \dN$ and $f \in \cO_{n}$, if $s_{1} \cng t_{1},\ldots,s_{n} \cng t_{n}$, then
    \[
      f(s_{1},\ldots,s_{n}) \cng f(t_{1},\ldots,t_{n})
    \]
  \end{enumerate}
\end{node}

\begin{node}
  Given a presentation $\dP$, let $T_{n}$ be the set of all $\dP$-terms with variables $x_{1},\ldots,x_{n}$.
  Concretely, $T_{n}$ is defined inductively as follows:
  \begin{enumerate}
  \item variables $x_{1},\ldots,x_{n} \in T_{n}$;
  \item if $f$ is an $m$-ary function symbol and $t_{1},\ldots,t_{m} \in T_{n}$, then $f(t_{1},\ldots,t_{m}) \in T_{n}$.
  \end{enumerate}
  We define $F_{n}$ to be the quotient of $T_{n}$ by the congruence defined in \cref{node:universal-algebra-cong}.
\end{node}

\begin{node}
  Concretely, the set $F_{n}$ is the set of \emph{$\dP$-abstract terms} in $n$ variables.
  This ought to be a (syntactic) model of $\dP$.
\end{node}

\begin{lem}
  \label{lem:universal-algebra-F-n-model}
  Given a presentation $\dP$, the set $F_{n}$ can be equipped with the structure of a $\dP$-model.
\end{lem}
\begin{proof}
  \begin{node}
    To specify a model is to specify an underlying set and functions on this set.
    We take $F_{n}$ to be the underlying set.
  \end{node}
  \begin{node}
    For any $m \in \dN$ and any $m$-ary function symbol $f \in \cO_{m}$, we define a function $\fbar : T_{n}^{m} \to T_{n}$ by mapping an $m$-tuple of raw terms $(t_{1},\ldots,t_{n})$ to the term $f(t_{1},\ldots,t_{n})$.
    Condition \ref{node:universal-algebra-cong-3} demands that $\fbar$ is compatible with $\cng$.
    Thus, it induces a function $\fhat : F_{n}^{m} \to F_{n}$.
  \end{node}
  \begin{node}
    It remains to check that every axiom of $\dP$ is satisfied in every possible interpretation of the variables.
    Let $s = t$ be an axiom of $\dP$.
    Then $s = t$ holds in every model.
    Thus, $s \cng t$ by condition \ref{node:universal-algebra-cong-1}.
    Condition \ref{node:universal-algebra-cong-2} then implies that $s$ and $t$ are interpreted as the same abstract term in any possible interpretation of the variables.
  \end{node}
\end{proof}

\begin{lem}
  \label{lem:universal-algebra-copower-F-1}
  Let $\dP$ be a presentation.
  In the category $\Mod_{\dP}$, $F_{n}$ is the $n$-th copower of $F_{1}$.
\end{lem}
\begin{proof}
  \begin{node}
    We denote the set of abstract terms involving just the variable $x_{i}$ by $F_{1}^{(i)}$ for $1 \leq i \leq n$.
    There is a function
    \[
      \iota^{(i)} : F_{1} \iso F_{1}^{(i)} \mono F_{n}
    \]
    defined by mapping an abstract term in $F_{1}^{(i)}$ to itself in $F_{n}$ and composing with the isomorphism $F_{1} \iso F_{1}^{(i)}$.
  \end{node}
  \begin{node}
    Intuitively, the isomorphism $F_{1}^{(i)} \iso F_{1}$ is renaming.
  \end{node}
  \begin{node}
    For each function symbol $f \in \cO_{n}$ and $t_{1},\ldots,t_{n} \in F_{1}^{(i)}$,
    \[
      \iota^{(i)}(f(t_{1},\ldots,t_{n})) = f(t_{1},\ldots,t_{n}) = f(\iota^{(i)}(t_{1}),\ldots,\iota^{(i)}(t_{n}))
    \]
    Thus, $i^{(i)}$ is a homomorphism.
    It remains to show that these functions have the universal property of coproducts.
  \end{node}
  \begin{node}
    \label{node:universal-algebra-abstract-interpretation}
    For any model $\sM$ of $\dP$, we need to construct a unique homomorphism $F_{n} \to \sM$ that factors through $\varphi_{1},\ldots,\varphi_{n}$.
    We construct $s : F_{n} \to \sM$ as follows:
    \begin{enumerate}
    \item\label{node:universal-algebra-var-interp-1}
      for variables $x_{i}$, we map the equivalence class $[x_{i}] \in F_{n}$ to $\varphi_{i}([x_{i}])$;
    \item\label{node:universal-algebra-var-interp-2}
      for any term $t \in T_{n}$, we map $t$ to its interpretation in $\sM$, where variables are interpreted as in \ref{node:universal-algebra-var-interp-1}.
    \end{enumerate}
    The quotient map $T_{n} \epi F_{n}$ admits a section $r : F_{n} \mono T_{n}$ ($r$ stands for \emph{reification}).
    Precomposition of $r$ with the function defined in \ref{node:universal-algebra-var-interp-2} yields $s : F_{n} \to \sM$.
  \end{node}
  \begin{node}
    The function $s$ is a homomorphism since for any function symbol $f \in \cO_{n}$ and $t_{1},\ldots,t_{n} \in F_{n}$,
    \[
      s(\fhat(t_{1},\ldots,t_{n})) = \fhat(\that_{1},\ldots,\that_{n}) = \fhat(s(t_{1}),\ldots,s(t_{n}))
    \]
    The first equation follows from the construction in \cref{node:universal-algebra-abstract-interpretation}, i.e., $s$ maps each abstract term to its interpretation in $\sM$.
    By recursion, each $\that_{i} \in \sM$ is $s(t_{i})$, proving the second equation.
  \end{node}
  \begin{node}
    By construction, $s$ factors through each $\varphi_{i}$.
    Since each $\iota^{(i)}$ is a monomorphism, uniqueness of $s$ follows.
  \end{node}
\end{proof}

\begin{node}
  $F_{n}$ is the free model on $n$ generators.
  For example, consider the usual presentation of the theory of monoids.
  $F_{0}$ is the trivial monoid, $F_{1}$ is the free monoid on one generator, and $F_{2}$ is constructed by gluing two copies of $F_{1}$ together.
\end{node}

\begin{node}
  \label{node:universal-algebra-homomorphisms-determined-by-one-point}
  By abuse of notation, we write $x$ for the abstract term $[x]$.
  A homomorphism $F_{1} \to F_{n}$ is completely determined by the value of $x$ in $F_{n}$ (this can be seen as a mini Yoneda Lemma).
  For example, if $x \mapsto xy$ then the conditions of homomorphisms demand that $xx \mapsto xyxy$ and so on.
\end{node}

\begin{node}
  \label{node:universal-algebra-morphism-encodes-n-terms}
  Considering \cref{node:universal-algebra-homomorphisms-determined-by-one-point}, \cref{lem:universal-algebra-copower-F-1} means that a morphism $f : F_{n} \to F_{m}$ in $\Mod_{\dP}$ precisely encodes a choice of $n$ abstract terms in $F_{m}$: the morphism $f$ is uniquely determined by $n$ homomorphisms $F_{1} \to F_{m}$.
\end{node}


\begin{prop}
  \label{prop:universal-algebra-presentation-to-category}
  Let $\dP$ be a presentation and $\sF$ be the full subcategory of $\Mod_{\dP}$ spanned by the free models $F_{n}$ on finitely many generators.
  The dual category $\sF\op$ has finite products and $\Mod_{\dP}$ is equivalent to the category of finite-product preserving functors from $\sF\op$ to $\CSet$.
\end{prop}
\begin{proof}
  \begin{node}
    \label{node:universal-algebra-functor-to-model}
    Given a finite-product preserving functor $G : \sF\op \to \CSet$, we construct a model of $\dP$ by taking $G(F_{1})$ as the underlying set.
    Each function symbol $f \in \cO_{n}$ gives an abstract term $[f(x_{1},\ldots,x_{n})] \in F_{n}$.
    By \cref{node:universal-algebra-morphism-encodes-n-terms}, this is precisely a morphism $\fbar : F_{1} \to F_{n}$, corresponding to $f^{*} : F_{1}^{n} \to F_{1}$ in the opposite category $\sF\op$.
    Then
    \[
      G(f^{*}) : G(F_{1}^{n}) \to G(F_{1})
    \]
    composed with the isomorphism $G(F_{1}^{n}) \iso G(F_{1})^{n}$ gives an interpretation for $f$.
  \end{node}
  \begin{node}
    We extend construction \cref{node:universal-algebra-functor-to-model} to morphisms.
    Given a natural transformation $\alpha : G \to G'$ between two product-preserving functors, we need to define a homomorphism $G(F_{1}) \to G'(F_{1})$.
    The natural candidate for such a map is the component $\alpha_{F_{1}}$, and indeed naturality implies that $\alpha_{F_{1}}$ is a homomorphism.
    Functoriality is also easy to check.
  \end{node}
  \begin{node}
    Suppose that the variables $x_{1},\ldots,x_{n}$ are interpreted as $a_{1},\ldots,a_{n} \in G(F_{1})$.
    We show that if $t \in T_{n}$, then $t$ is interpreted as $G(t^{*})(a_{1},\ldots,a_{n})$.
    By induction on the structure of $t$.
    When $t$ is a variable $x_{i}$, then the abstract term $[x_{i}]$ corresponds to the injection $\xbar_{i} : F_{1} \to F_{n}$.
    Thus, $x_{i}^{*} : F_{1}^{n} \to F_{1}$ is the projection, so $G(x_{i}^{*})(a_{1},\ldots,a_{n}) = a_{i}$.
    When $t = f(t_{1},\ldots,t_{m})$, $t$ is interpreted as $G(f^{*})(G(t_{1}^{*})(a_{1},\ldots,a_{n}),\ldots,G(t_{m}^{*})(a_{1},\ldots,a_{n}))$ by the induction hypothesis.
    Or equivalently,
    \[
      G(f^{*}(t_{1},\ldots,t_{m})^{*})(a_{1},\ldots,a_{n})
    \]
  \end{node}
  \begin{node}
    Let $s = t$ be an axiom of $\dP$, we must show that $s$ and $t$ have the same interpretation in $G(F_{1})$.
    Since axioms must hold in all models, $[s] = [t]$ holds in $F_{n}$, so $\sbar = \tbar : F_{1} \to F_{n}$.
    Thus, they are interpreted as $G(s^{*})(a_{1},\ldots,a_{n}) = G(t^{*})(a_{1},\ldots,a_{n})$.
  \end{node}

  \begin{node}
    \label{node:universal-algebra-model-to-functor}
    Conversely, given a model $\sM$, we define a finite-product preserving functor $G : \sF\op \to \CSet$ by
    \[
      G(F_{n}) = M^{n}
    \]
    Given a morphism $t : F_{n} \to F_{m}$, corresponding to $n$ abstract terms in $m$ variables, the function $G(\tbar) : M^{m} \to M^{n}$ maps $(a_{1},\ldots,a_{m})$ to the $n$ tuple in which each of the $n$ abstract terms in $m$ variables is interpreted by substituting $(a_{1},\ldots,a_{m})$ for those variables.
    Functoriality of $G$ is easy to check.
  \end{node}

  \begin{node}
    Now, we extend construction \cref{node:universal-algebra-model-to-functor} to morphisms.
    Given a homomorphism $\varphi : \sM \to \sM'$, we need to extend to a natural transformation $\alpha : G \to G'$.
    The underlying function $\varphi : M \to M'$ determines the component $\alpha_{F_{1}} : G(F_{1}) \to G'(F_{1})$.
    The conditions of homomorphisms and preservation of finite-products allow us to extend $\alpha_{F_{1}}$ to a natural transformation.
  \end{node}

  \begin{node}
    By construction, for any model $\sM \in \Mod_{\dP}$, let $G : \sF\op \to \CSet$ be the functor defined in \cref{node:universal-algebra-model-to-functor}.
    The construction in \cref{node:universal-algebra-functor-to-model} yields a model such that
    \[
      G(F_{1}) = M
    \]
    Conversely, for any product-preserving functor $G : \sF\op \to \CSet$, applying construction \cref{node:universal-algebra-model-to-functor} to the model $G(F_{1})$ yields another product-preserving functor $G'$ such that
    \[
      G'(F_{n}) \iso G'(F_{1})^{n} = G(F_{1})^{n} \iso G(F_{n})
    \]
  \end{node}
\end{proof}

\section{Lawvere Theory}
\label{sec:lawvere-theory}

\begin{node}
  We write $\dN$ for a chosen skeletal category of $\CFinSet$.
\end{node}

\begin{defn}
  The \emph{category of Lawvere theories} $\CLaw$ is the full subcategory of $\dN\op/\CCat$ spanned by those objects $A : \dN\op \to \dA$ that is identity-on-objects and preserves finite products.
  We write $A^{n}$ for the value of $A$ at $n$ and we omit the superscript when $n = 1$.
  An \emph{$n$-ary operation} of $\dA$ is a morphism $f : A^{n} \to A$.
  We write $\pi^{n}_{i} : A^{n} \to A$ for the value of $A$ at the $i$-th projection $n \to 1$ of $\dN\op$.
\end{defn}

\begin{eg}
  The identity functor $\dN\op \to \dN\op$ is a Lawvere theory, which we call ``the theory of equality''.
  This is an initial object of $\CLaw$.
\end{eg}

\begin{thm}
  The category $\CLaw$ has coproducts.
\end{thm}

\section{Presentations of Lawvere theories}
\label{sec:presentations-of-lawvere-theories}

\begin{node}
  We define a functor $T : \CLaw \to \CSet^{|\dN|}$ that maps a Lawvere theory to a sequence of sets of operations.
  $T$ maps each Lawvere theory $A$ to a sequence of sets whose $n$-th element is the set $\dA(A^{n}, A)$, i.e., the set of all $n$-ary operations.
  For each $F : A \to B$, $T$ maps $F$ to a sequence of functions whose $n$-th element $(TF)_{n} : \Hom(A^{n}, A) \to \Hom(B^{n}, B)$ maps each $n$-ary operation $k$ of $A$ to $Fk$, an $n$-ary operation of $B$.
\end{node}

\begin{thm}
  $T$ has a left adjoint $F$.
\end{thm}

\section{Algebraic categories}
\label{sec:algebraic-categories}

\begin{defn}
  Let $A : \dN\op \to \dA$ be a Lawvere theory.
  The \emph{category of algebras of type $A$}, denoted $\Alg(A)$, is the full subcategory of $\CSet^{\dA}$ spanned by those finite-product preserving functors.
  A category $\iC$ is \emph{algebraic} if $\iC \eqv \Alg(B)$ for some Lawvere theory $B$.
\end{defn}


\section{Splitting of idempotents}
\label{sec:splitting-of-idempotents}

\begin{defn}
  \label{defn:idempotents}
  A morphism $e : C \to C$ is \emph{idempotent} when $ee = e$.
\end{defn}

\begin{prop}
  Consider a retract and a section $r, s : R \otto C$.
  The composition $sr$ is idempotent.
\end{prop}
\begin{proof}
  \[
    srsr = s \circ \id \circ r = sr
  \]
\end{proof}

\begin{defn}
  An idempotent $e : C \to C$ \emph{splits} when there exists a retract $r,s : R \otto C$ such that $sr = e$.
\end{defn}

\begin{prop}
  In a category $\iC$, the following conditions are equivalent for an idempotent $e : C \to C$.
  \begin{enumerate}
  \item\label{prop:splitting-of-idempotents-equiv-1}
    $e$ splits as $e = sr$.
  \item\label{prop:splitting-of-idempotents-equiv-2}
    the equalizer $s = \ker(e,\id_{C})$ exists and is absolute
  \item\label{prop:splitting-of-idempotents-equiv-3}
    the coequalizer $r = \coker(e,\id_{C})$ exists and is absolute
  \end{enumerate}
\end{prop}
\begin{proof}
  \begin{node}
    Assume (\ref{prop:splitting-of-idempotents-equiv-1}).
    The diagram below is a split coequalizer diagram.
    \[
      % https://q.uiver.app/#q=WzAsMyxbMCwwLCJDIl0sWzIsMCwiQyJdLFs0LDAsIlIiXSxbMCwxLCJlIiwwLHsib2Zmc2V0IjotMX1dLFswLDEsIlxcaWRfe0N9IiwyLHsib2Zmc2V0IjoxfV0sWzEsMiwiciJdLFsyLDEsInMiLDAseyJjdXJ2ZSI6LTJ9XSxbMSwwLCJcXGlkX3tDfSIsMCx7ImN1cnZlIjotMn1dXQ==
      \begin{tikzcd}
	C && C && R
	\arrow["e", shift left, from=1-1, to=1-3]
	\arrow["{\id_{C}}"', shift right, from=1-1, to=1-3]
	\arrow["r", from=1-3, to=1-5]
	\arrow["s", curve={height=-15pt}, from=1-5, to=1-3]
	\arrow["{\id_{C}}", curve={height=-15pt}, from=1-3, to=1-1]
      \end{tikzcd}
    \]
    Thus, $r$ is an absolute coequalizer.
  \end{node}
  \begin{node}
    Assume (\ref{prop:splitting-of-idempotents-equiv-3}).
    $e$ is a cocone under the pair $e, \id_{C}$ since $ee = e = e \circ \id_{C}$.
    \[
      % https://q.uiver.app/#q=WzAsNCxbMCwwLCJDIl0sWzIsMCwiQyJdLFs0LDAsIlIiXSxbNCwyLCJDIl0sWzEsMiwiciJdLFswLDEsImUiLDAseyJvZmZzZXQiOi0xfV0sWzAsMSwiXFxpZF97Q30iLDIseyJvZmZzZXQiOjF9XSxbMSwzLCJlIiwyXSxbMiwzLCJzIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
      \begin{tikzcd}
	C && C && R \\
	\\
	&&&& C
	\arrow["r", from=1-3, to=1-5]
	\arrow["e", shift left, from=1-1, to=1-3]
	\arrow["{\id_{C}}"', shift right, from=1-1, to=1-3]
	\arrow["e"', from=1-3, to=3-5]
	\arrow["s", dashed, from=1-5, to=3-5]
      \end{tikzcd}
    \]
    The universal property of coequalizers gives a unique section $s$ with $e = sr$.
  \end{node}
  \begin{node}
    (\ref{prop:splitting-of-idempotents-equiv-2}) is equivalent to (\ref{prop:splitting-of-idempotents-equiv-3}) by duality.
  \end{node}
\end{proof}

\section{Cauchy complete categories}
\label{sec:cauchy-complete-categories}

\begin{defn}
  A category $\iC$ is \emph{Cauchy complete} when all idempotents of $\iC$ split.
\end{defn}

\section{Canonical algebraic theory}
\label{sec:canonical-algebraic-theory}



\section{Limits and Colimits in Algebraic Categories}
\label{sec:limits-and-colimits-in-algebraic-categories}

\begin{lem}
  Let $\cT$ be an algebraic theory.
  The category $\mathsf{Mod}_{\cT}$ is complete and limits are computed pointwise.
  The forgetful functor $U : \mathsf{Mod}_{\cT} \to \mathsf{Set}$ preserves and reflects limits.
\end{lem}

\begin{lem}
  Let $\cT$ be an algebraic theory.
  The category $\mathsf{Mod}_{\cT}$ has filtered colimits and these are computed pointwise.
  The forgetful functor $U : \mathsf{Mod}_{\cT} \to \mathsf{Set}$ preserves and reflects filtered colimits.
\end{lem}

\begin{lem}
  Let $\cT$ be an algebraic theory.
  In $\mathsf{\cT}$, finite limits commute with filtered colimits.
\end{lem}

\begin{lem}\label{lem:model-category-complete-cocomplete}
  Let $\cT$ be an algebraic theory.
  $\mathsf{Mod}_{\cT}$ is complete and cocomplete because it is reflective in the category $\mathsf{Set}^{\cT}$.
\end{lem}

\section{Freely Generated Models}
\label{sec:freely-generated-models}

\section{Characterization of Algebraic Categories}
\label{sec:characterization-of-algebraic-categories}

\begin{thm}
  Let $\iC$ be a category and $U : \iC \to \mathsf{Set}$ be a functor.
  The following conditions are equivalent:
  \begin{enumerate}
  \item $\iC$ is equivalent to the category of models of some algebraic theory $\cT$, with $U$ the corresponding forgetful functor.
  \item the following conditions are satisfied:
    \begin{enumerate}
    \item $\iC$ has coequalizers and kernel pairs;
    \item $U$ has a left adjoint $F$;
    \item $U$ reflects isomorphisms;
    \item $U$ preserves regular epimorphisms;
    \item $UF$ preserves filtered colimits.
    \end{enumerate}
  \end{enumerate}
\end{thm}

\section{Tensor Products of Theories}
\label{sec:tensor-products-of-theories}

\cref{lem:model-category-complete-cocomplete} showed that the category of models of any algebraic theory is complete and cocomplete.
In fact,

\begin{lem}
  The category of algebraic theories $\mathsf{Th}$ is complete and cocomplete.
\end{lem}


\bibliographystyle{alpha}
\bibliography{all}

\end{document}
